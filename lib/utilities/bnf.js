'use strict';

var lexers = require('occam-lexers');

var ruleNames = require('../bnf/ruleNames'),
    arrayUtilities = require('../utilities/array');

var BNFLexer = lexers.BNFLexer,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    specialSymbols = BNFLexer.specialSymbols,
    plus = specialSymbols.plus,
    asterisk = specialSymbols.asterisk,
    questionMark = specialSymbols.questionMark,
    NO_WHITESPACE = specialSymbols.NO_WHITESPACE,
    RuleNameRuleName = ruleNames.RuleNameRuleName,
    RightRecursivePartRuleName = ruleNames.RightRecursivePartRuleName;


function isNodeChoiceNode(node) {
  var nodeNoChoiceNode = false;

  var nodeTerminalNode = node.isTerminalNode();

  if (nodeTerminalNode) {
    var terminalNode = node,
        terminalNodeContent = terminalNode.getContent();

    nodeNoChoiceNode = terminalNodeContent === '|';
  }

  return nodeNoChoiceNode;
}

function isNodeRuleNameNode(node) {
  var nodeRuleNameNode = false;

  var nodeTerminalNode = node.isTerminalNode(),
      nodeNonTerminalNode = !nodeTerminalNode;

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node,
        ///
    nonTerminalNodeRuleName = nonTerminalNode.getRuleName();

    nodeRuleNameNode = nonTerminalNodeRuleName === RuleNameRuleName;
  }

  return nodeRuleNameNode;
}

function isNodeQuantifiersNode(node) {
  var nodeQuantifiersNode = false;

  var nodeTerminalNode = node.isTerminalNode(),
      nodeNonTerminalNode = !nodeTerminalNode;

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node,
        ///
    childNodes = nonTerminalNode.getChildNodes(),
        firstChildNode = first(childNodes),
        firstChildNodeTerminalNode = firstChildNode.isTerminalNode();

    if (firstChildNodeTerminalNode) {
      var terminalNode = firstChildNode,
          ///
      terminalNodeContent = terminalNode.getContent();

      nodeQuantifiersNode = terminalNodeContent === plus || terminalNodeContent === asterisk || terminalNodeContent === questionMark;
    }
  }

  return nodeQuantifiersNode;
}

function isNodeNoWhitespaceNode(node) {
  var nodeNoWhitespaceNode = false;

  var nodeTerminalNode = node.isTerminalNode();

  if (nodeTerminalNode) {
    var terminalNode = node,
        terminalNodeContent = terminalNode.getContent();

    nodeNoWhitespaceNode = terminalNodeContent === NO_WHITESPACE;
  }

  return nodeNoWhitespaceNode;
}

function isNodeRightRecursivePartNode(node) {
  var nodeRightRecursivePartNode = false;

  var nodeTerminalNode = node.isTerminalNode(),
      nodeNonTerminalNode = !nodeTerminalNode;

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node,
        ///
    nonTerminalNodeRuleName = nonTerminalNode.getRuleName();

    nodeRightRecursivePartNode = nonTerminalNodeRuleName === RightRecursivePartRuleName;
  }

  return nodeRightRecursivePartNode;
}

function quantifiersFromQuantifiersNode(quantifiersNode) {
  var quantifiers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

  var quantifier = quantifierFromQuantifiersNode(quantifiersNode);

  quantifiers.push(quantifier);

  var quantifiersNodeChildNodes = quantifiersNode.getChildNodes(),
      quantifiersNodeChildNodesLength = quantifiersNodeChildNodes.length;

  if (quantifiersNodeChildNodesLength === 2) {
    var secondQuantifiersNodeChildNode = second(quantifiersNodeChildNodes),
        secondQuantifiersNodeChildNodeQuantifiersNode = isNodeQuantifiersNode(secondQuantifiersNodeChildNode);

    if (secondQuantifiersNodeChildNodeQuantifiersNode) {
      quantifiersNode = secondQuantifiersNodeChildNode; ///

      quantifiers = quantifiersFromQuantifiersNode(quantifiersNode, quantifiers);
    }
  }

  return quantifiers;
}

module.exports = {
  isNodeChoiceNode: isNodeChoiceNode,
  isNodeRuleNameNode: isNodeRuleNameNode,
  isNodeQuantifiersNode: isNodeQuantifiersNode,
  isNodeNoWhitespaceNode: isNodeNoWhitespaceNode,
  isNodeRightRecursivePartNode: isNodeRightRecursivePartNode,
  quantifiersFromQuantifiersNode: quantifiersFromQuantifiersNode
};

function quantifierFromQuantifiersNode(quantifiersNode) {
  var quantifiersNodeChildNodes = quantifiersNode.getChildNodes(),
      firstQuantifiersNodeChildNode = first(quantifiersNodeChildNodes),
      firstQuantifiersNodeChildNodeContent = firstQuantifiersNodeChildNode.getContent(),
      quantifier = firstQuantifiersNodeChildNodeContent;

  return quantifier;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvYm5mLmpzIl0sIm5hbWVzIjpbImxleGVycyIsInJlcXVpcmUiLCJydWxlTmFtZXMiLCJhcnJheVV0aWxpdGllcyIsIkJORkxleGVyIiwiZmlyc3QiLCJzZWNvbmQiLCJzcGVjaWFsU3ltYm9scyIsInBsdXMiLCJhc3RlcmlzayIsInF1ZXN0aW9uTWFyayIsIk5PX1dISVRFU1BBQ0UiLCJSdWxlTmFtZVJ1bGVOYW1lIiwiUmlnaHRSZWN1cnNpdmVQYXJ0UnVsZU5hbWUiLCJpc05vZGVDaG9pY2VOb2RlIiwibm9kZSIsIm5vZGVOb0Nob2ljZU5vZGUiLCJub2RlVGVybWluYWxOb2RlIiwiaXNUZXJtaW5hbE5vZGUiLCJ0ZXJtaW5hbE5vZGUiLCJ0ZXJtaW5hbE5vZGVDb250ZW50IiwiZ2V0Q29udGVudCIsImlzTm9kZVJ1bGVOYW1lTm9kZSIsIm5vZGVSdWxlTmFtZU5vZGUiLCJub2RlTm9uVGVybWluYWxOb2RlIiwibm9uVGVybWluYWxOb2RlIiwibm9uVGVybWluYWxOb2RlUnVsZU5hbWUiLCJnZXRSdWxlTmFtZSIsImlzTm9kZVF1YW50aWZpZXJzTm9kZSIsIm5vZGVRdWFudGlmaWVyc05vZGUiLCJjaGlsZE5vZGVzIiwiZ2V0Q2hpbGROb2RlcyIsImZpcnN0Q2hpbGROb2RlIiwiZmlyc3RDaGlsZE5vZGVUZXJtaW5hbE5vZGUiLCJpc05vZGVOb1doaXRlc3BhY2VOb2RlIiwibm9kZU5vV2hpdGVzcGFjZU5vZGUiLCJpc05vZGVSaWdodFJlY3Vyc2l2ZVBhcnROb2RlIiwibm9kZVJpZ2h0UmVjdXJzaXZlUGFydE5vZGUiLCJxdWFudGlmaWVyc0Zyb21RdWFudGlmaWVyc05vZGUiLCJxdWFudGlmaWVyc05vZGUiLCJxdWFudGlmaWVycyIsInF1YW50aWZpZXIiLCJxdWFudGlmaWVyRnJvbVF1YW50aWZpZXJzTm9kZSIsInB1c2giLCJxdWFudGlmaWVyc05vZGVDaGlsZE5vZGVzIiwicXVhbnRpZmllcnNOb2RlQ2hpbGROb2Rlc0xlbmd0aCIsImxlbmd0aCIsInNlY29uZFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZSIsInNlY29uZFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZVF1YW50aWZpZXJzTm9kZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJmaXJzdFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZSIsImZpcnN0UXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlQ29udGVudCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsU0FBU0MsUUFBUSxjQUFSLENBQWY7O0FBRUEsSUFBTUMsWUFBWUQsUUFBUSxrQkFBUixDQUFsQjtBQUFBLElBQ01FLGlCQUFpQkYsUUFBUSxvQkFBUixDQUR2Qjs7QUFHTSxJQUFFRyxRQUFGLEdBQWVKLE1BQWYsQ0FBRUksUUFBRjtBQUFBLElBQ0VDLEtBREYsR0FDb0JGLGNBRHBCLENBQ0VFLEtBREY7QUFBQSxJQUNTQyxNQURULEdBQ29CSCxjQURwQixDQUNTRyxNQURUO0FBQUEsSUFFRUMsY0FGRixHQUVxQkgsUUFGckIsQ0FFRUcsY0FGRjtBQUFBLElBR0VDLElBSEYsR0FHa0RELGNBSGxELENBR0VDLElBSEY7QUFBQSxJQUdRQyxRQUhSLEdBR2tERixjQUhsRCxDQUdRRSxRQUhSO0FBQUEsSUFHa0JDLFlBSGxCLEdBR2tESCxjQUhsRCxDQUdrQkcsWUFIbEI7QUFBQSxJQUdnQ0MsYUFIaEMsR0FHa0RKLGNBSGxELENBR2dDSSxhQUhoQztBQUFBLElBSUVDLGdCQUpGLEdBSW1EVixTQUpuRCxDQUlFVSxnQkFKRjtBQUFBLElBSW9CQywwQkFKcEIsR0FJbURYLFNBSm5ELENBSW9CVywwQkFKcEI7OztBQU1OLFNBQVNDLGdCQUFULENBQTBCQyxJQUExQixFQUFnQztBQUM5QixNQUFJQyxtQkFBbUIsS0FBdkI7O0FBRUEsTUFBTUMsbUJBQW1CRixLQUFLRyxjQUFMLEVBQXpCOztBQUVBLE1BQUlELGdCQUFKLEVBQXNCO0FBQ3BCLFFBQU1FLGVBQWVKLElBQXJCO0FBQUEsUUFDTUssc0JBQXNCRCxhQUFh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QUFkO0FBQ0Q7QUFDRjs7QUFFRCxTQUFPQSxXQUFQO0FBQ0Q7O0FBRURTLE9BQU9DLE9BQVAsR0FBaUI7QUFDZnBDLG9DQURlO0FBRWZRLHdDQUZlO0FBR2ZNLDhDQUhlO0FBSWZNLGdEQUplO0FBS2ZFLDREQUxlO0FBTWZFO0FBTmUsQ0FBakI7O0FBU0EsU0FBU0ksNkJBQVQsQ0FBdUNILGVBQXZDLEVBQXdEO0FBQ3RELE1BQU1LLDRCQUE0QkwsZ0JBQWdCUixhQUFoQixFQUFsQztBQUFBLE1BQ01vQixnQ0FBZ0M5QyxNQUFNdUMseUJBQU4sQ0FEdEM7QUFBQSxNQUVNUSx1Q0FBdUNELDhCQUE4QjlCLFVBQTlCLEVBRjdDO0FBQUEsTUFHTW9CLGFBQWFXLG9DQUhuQjs7QUFLQSxTQUFPWCxVQUFQO0FBQ0QiLCJmaWxlIjoiYm5mLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBsZXhlcnMgPSByZXF1aXJlKCdvY2NhbS1sZXhlcnMnKTtcblxuY29uc3QgcnVsZU5hbWVzID0gcmVxdWlyZSgnLi4vYm5mL3J1bGVOYW1lcycpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKTtcblxuY29uc3QgeyBCTkZMZXhlciB9ID0gbGV4ZXJzLFxuICAgICAgeyBmaXJzdCwgc2Vjb25kIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgc3BlY2lhbFN5bWJvbHMgfSA9IEJORkxleGVyLFxuICAgICAgeyBwbHVzLCBhc3RlcmlzaywgcXVlc3Rpb25NYXJrLCBOT19XSElURVNQQUNFIH0gPSBzcGVjaWFsU3ltYm9scyxcbiAgICAgIHsgUnVsZU5hbWVSdWxlTmFtZSwgUmlnaHRSZWN1cnNpdmVQYXJ0UnVsZU5hbWUgfSA9IHJ1bGVOYW1lcztcblxuZnVuY3Rpb24gaXNOb2RlQ2hvaWNlTm9kZShub2RlKSB7XG4gIGxldCBub2RlTm9DaG9pY2VOb2RlID0gZmFsc2U7XG5cbiAgY29uc3Qgbm9kZVRlcm1pbmFsTm9kZSA9IG5vZGUuaXNUZXJtaW5hbE5vZGUoKTtcblxuICBpZiAobm9kZVRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IHRlcm1pbmFsTm9kZSA9IG5vZGUsXG4gICAgICAgICAgdGVybWluYWxOb2RlQ29udGVudCA9IHRlcm1pbmFsTm9kZS5nZXRDb250ZW50KCk7XG5cbiAgICBub2RlTm9DaG9pY2VOb2RlID0gKHRlcm1pbmFsTm9kZUNvbnRlbnQgPT09ICd8Jyk7XG4gIH1cblxuICByZXR1cm4gbm9kZU5vQ2hvaWNlTm9kZTtcbn1cblxuZnVuY3Rpb24gaXNOb2RlUnVsZU5hbWVOb2RlKG5vZGUpIHtcbiAgbGV0IG5vZGVSdWxlTmFtZU5vZGUgPSBmYWxzZTtcblxuICBjb25zdCBub2RlVGVybWluYWxOb2RlID0gbm9kZS5pc1Rlcm1pbmFsTm9kZSgpLFxuICAgICAgICBub2RlTm9uVGVybWluYWxOb2RlID0gIW5vZGVUZXJtaW5hbE5vZGU7XG5cbiAgaWYgKG5vZGVOb25UZXJtaW5hbE5vZGUpIHtcbiAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBub2RlLCAvLy9cbiAgICAgICAgICBub25UZXJtaW5hbE5vZGVSdWxlTmFtZSA9IG5vblRlcm1pbmFsTm9kZS5nZXRSdWxlTmFtZSgpO1xuXG4gICAgbm9kZVJ1bGVOYW1lTm9kZSA9IChub25UZXJtaW5hbE5vZGVSdWxlTmFtZSA9PT0gUnVsZU5hbWVSdWxlTmFtZSk7XG4gIH1cblxuICByZXR1cm4gbm9kZVJ1bGVOYW1lTm9kZTtcbn1cblxuZnVuY3Rpb24gaXNOb2RlUXVhbnRpZmllcnNOb2RlKG5vZGUpIHtcbiAgbGV0IG5vZGVRdWFudGlmaWVyc05vZGUgPSBmYWxzZTtcblxuICBjb25zdCBub2RlVGVybWluYWxOb2RlID0gbm9kZS5pc1Rlcm1pbmFsTm9kZSgpLFxuICAgICAgICBub2RlTm9uVGVybWluYWxOb2RlID0gIW5vZGVUZXJtaW5hbE5vZGU7XG5cbiAgaWYgKG5vZGVOb25UZXJtaW5hbE5vZGUpIHtcbiAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBub2RlLCAvLy9cbiAgICAgICAgICBjaGlsZE5vZGVzID0gbm9uVGVybWluYWxOb2RlLmdldENoaWxkTm9kZXMoKSxcbiAgICAgICAgICBmaXJzdENoaWxkTm9kZSA9IGZpcnN0KGNoaWxkTm9kZXMpLFxuICAgICAgICAgIGZpcnN0Q2hpbGROb2RlVGVybWluYWxOb2RlID0gZmlyc3RDaGlsZE5vZGUuaXNUZXJtaW5hbE5vZGUoKTtcblxuICAgIGlmIChmaXJzdENoaWxkTm9kZVRlcm1pbmFsTm9kZSkge1xuICAgICAgY29uc3QgdGVybWluYWxOb2RlID0gZmlyc3RDaGlsZE5vZGUsICAvLy9cbiAgICAgICAgICAgIHRlcm1pbmFsTm9kZUNvbnRlbnQgPSB0ZXJtaW5hbE5vZGUuZ2V0Q29udGVudCgpO1xuXG4gICAgICBub2RlUXVhbnRpZmllcnNOb2RlID0gKHRlcm1pbmFsTm9kZUNvbnRlbnQgPT09IHBsdXMpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRlcm1pbmFsTm9kZUNvbnRlbnQgPT09IGFzdGVyaXNrKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0ZXJtaW5hbE5vZGVDb250ZW50ID09PSBxdWVzdGlvbk1hcmspO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBub2RlUXVhbnRpZmllcnNOb2RlO1xufVxuXG5mdW5jdGlvbiBpc05vZGVOb1doaXRlc3BhY2VOb2RlKG5vZGUpIHtcbiAgbGV0IG5vZGVOb1doaXRlc3BhY2VOb2RlID0gZmFsc2U7XG5cbiAgY29uc3Qgbm9kZVRlcm1pbmFsTm9kZSA9IG5vZGUuaXNUZXJtaW5hbE5vZGUoKTtcblxuICBpZiAobm9kZVRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IHRlcm1pbmFsTm9kZSA9IG5vZGUsXG4gICAgICAgICAgdGVybWluYWxOb2RlQ29udGVudCA9IHRlcm1pbmFsTm9kZS5nZXRDb250ZW50KCk7XG5cbiAgICBub2RlTm9XaGl0ZXNwYWNlTm9kZSA9ICh0ZXJtaW5hbE5vZGVDb250ZW50ID09PSBOT19XSElURVNQQUNFKTtcbiAgfVxuXG4gIHJldHVybiBub2RlTm9XaGl0ZXNwYWNlTm9kZTtcbn1cblxuZnVuY3Rpb24gaXNOb2RlUmlnaHRSZWN1cnNpdmVQYXJ0Tm9kZShub2RlKSB7XG4gIGxldCBub2RlUmlnaHRSZWN1cnNpdmVQYXJ0Tm9kZSA9IGZhbHNlO1xuXG4gIGNvbnN0IG5vZGVUZXJtaW5hbE5vZGUgPSBub2RlLmlzVGVybWluYWxOb2RlKCksXG4gICAgICAgIG5vZGVOb25UZXJtaW5hbE5vZGUgPSAhbm9kZVRlcm1pbmFsTm9kZTtcblxuICBpZiAobm9kZU5vblRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IG5vblRlcm1pbmFsTm9kZSA9IG5vZGUsIC8vL1xuICAgICAgICBub25UZXJtaW5hbE5vZGVSdWxlTmFtZSA9IG5vblRlcm1pbmFsTm9kZS5nZXRSdWxlTmFtZSgpO1xuXG4gICAgbm9kZVJpZ2h0UmVjdXJzaXZlUGFydE5vZGUgPSAobm9uVGVybWluYWxOb2RlUnVsZU5hbWUgPT09IFJpZ2h0UmVjdXJzaXZlUGFydFJ1bGVOYW1lKTtcbiAgfVxuXG4gIHJldHVybiBub2RlUmlnaHRSZWN1cnNpdmVQYXJ0Tm9kZTtcbn1cblxuZnVuY3Rpb24gcXVhbnRpZmllcnNGcm9tUXVhbnRpZmllcnNOb2RlKHF1YW50aWZpZXJzTm9kZSwgcXVhbnRpZmllcnMgPSBbXSkge1xuICBjb25zdCBxdWFudGlmaWVyID0gcXVhbnRpZmllckZyb21RdWFudGlmaWVyc05vZGUocXVhbnRpZmllcnNOb2RlKTtcblxuICBxdWFudGlmaWVycy5wdXNoKHF1YW50aWZpZXIpO1xuXG4gIGNvbnN0IHF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZXMgPSBxdWFudGlmaWVyc05vZGUuZ2V0Q2hpbGROb2RlcygpLFxuICAgICAgICBxdWFudGlmaWVyc05vZGVDaGlsZE5vZGVzTGVuZ3RoID0gIHF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZXMubGVuZ3RoO1xuXG4gIGlmIChxdWFudGlmaWVyc05vZGVDaGlsZE5vZGVzTGVuZ3RoID09PSAyKSB7XG4gICAgY29uc3Qgc2Vjb25kUXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlID0gc2Vjb25kKHF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZXMpLFxuICAgICAgICAgIHNlY29uZFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZVF1YW50aWZpZXJzTm9kZSA9IGlzTm9kZVF1YW50aWZpZXJzTm9kZShzZWNvbmRRdWFudGlmaWVyc05vZGVDaGlsZE5vZGUpO1xuXG4gICAgaWYgKHNlY29uZFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZVF1YW50aWZpZXJzTm9kZSkge1xuICAgICAgcXVhbnRpZmllcnNOb2RlID0gc2Vjb25kUXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlOyAvLy9cblxuICAgICAgcXVhbnRpZmllcnMgPSBxdWFudGlmaWVyc0Zyb21RdWFudGlmaWVyc05vZGUocXVhbnRpZmllcnNOb2RlLCBxdWFudGlmaWVycyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHF1YW50aWZpZXJzO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgaXNOb2RlQ2hvaWNlTm9kZSxcbiAgaXNOb2RlUnVsZU5hbWVOb2RlLFxuICBpc05vZGVRdWFudGlmaWVyc05vZGUsXG4gIGlzTm9kZU5vV2hpdGVzcGFjZU5vZGUsXG4gIGlzTm9kZVJpZ2h0UmVjdXJzaXZlUGFydE5vZGUsXG4gIHF1YW50aWZpZXJzRnJvbVF1YW50aWZpZXJzTm9kZVxufTtcblxuZnVuY3Rpb24gcXVhbnRpZmllckZyb21RdWFudGlmaWVyc05vZGUocXVhbnRpZmllcnNOb2RlKSB7XG4gIGNvbnN0IHF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZXMgPSBxdWFudGlmaWVyc05vZGUuZ2V0Q2hpbGROb2RlcygpLFxuICAgICAgICBmaXJzdFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZSA9IGZpcnN0KHF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZXMpLFxuICAgICAgICBmaXJzdFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZUNvbnRlbnQgPSBmaXJzdFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZS5nZXRDb250ZW50KCksXG4gICAgICAgIHF1YW50aWZpZXIgPSBmaXJzdFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZUNvbnRlbnQ7XG5cbiAgcmV0dXJuIHF1YW50aWZpZXI7XG59XG4iXX0=