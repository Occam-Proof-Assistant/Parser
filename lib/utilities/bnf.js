'use strict';

var lexers = require('occam-lexers');

var arrayUtilities = require('../utilities/array');

var BNFLexer = lexers.BNFLexer,
    first = arrayUtilities.first,
    second = arrayUtilities.second,
    specialSymbols = BNFLexer.specialSymbols,
    NO_WHITESPACE = specialSymbols.NO_WHITESPACE;


function isNodeNoWhitespaceNode(node) {
  var nodeNoWhitespaceNode = false;

  var nodeTerminalNode = node.isTerminalNode();

  if (nodeTerminalNode) {
    var terminalNode = node,
        terminalNodeContent = terminalNode.getContent();

    nodeNoWhitespaceNode = terminalNodeContent === NO_WHITESPACE;
  }

  return nodeNoWhitespaceNode;
}

function isNodeChoiceNode(node) {
  var nodeNoChoiceNode = false;

  var nodeTerminalNode = node.isTerminalNode();

  if (nodeTerminalNode) {
    var terminalNode = node,
        terminalNodeContent = terminalNode.getContent();

    nodeNoChoiceNode = terminalNodeContent === '|';
  }

  return nodeNoChoiceNode;
}

function isNodeQuantifiersNode(node) {
  var nodeQuantifiersNode = false;

  var nodeTerminalNode = node.isTerminalNode(),
      nodeNonTerminalNode = !nodeTerminalNode;

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node,
        ///
    childNodes = nonTerminalNode.getChildNodes(),
        firstChildNode = first(childNodes),
        firstChildNodeTerminalNode = firstChildNode.isTerminalNode();

    if (firstChildNodeTerminalNode) {
      var terminalNode = firstChildNode,
          ///
      terminalNodeContent = terminalNode.getContent();

      nodeQuantifiersNode = terminalNodeContent === '?' || terminalNodeContent === '*' || terminalNodeContent === '+';
    }
  }

  return nodeQuantifiersNode;
}

function quantifiersFromQuantifiersNode(quantifiersNode) {
  var quantifiers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

  var quantifier = quantifierFromQuantifiersNode(quantifiersNode);

  quantifiers.push(quantifier);

  var quantifiersNodeChildNodes = quantifiersNode.getChildNodes(),
      quantifiersNodeChildNodesLength = quantifiersNodeChildNodes.length;

  if (quantifiersNodeChildNodesLength === 2) {
    var secondQuantifiersNodeChildNode = second(quantifiersNodeChildNodes),
        secondQuantifiersNodeChildNodeQuantifiersNode = isNodeQuantifiersNode(secondQuantifiersNodeChildNode);

    if (secondQuantifiersNodeChildNodeQuantifiersNode) {
      quantifiersNode = secondQuantifiersNodeChildNode; ///

      quantifiers = quantifiersFromQuantifiersNode(quantifiersNode, quantifiers);
    }
  }

  return quantifiers;
}

module.exports = {
  isNodeNoWhitespaceNode: isNodeNoWhitespaceNode,
  isNodeChoiceNode: isNodeChoiceNode,
  isNodeQuantifiersNode: isNodeQuantifiersNode,
  quantifiersFromQuantifiersNode: quantifiersFromQuantifiersNode
};

function quantifierFromQuantifiersNode(quantifiersNode) {
  var quantifiersNodeChildNodes = quantifiersNode.getChildNodes(),
      firstQuantifiersNodeChildNode = first(quantifiersNodeChildNodes),
      firstQuantifiersNodeChildNodeContent = firstQuantifiersNodeChildNode.getContent(),
      quantifier = firstQuantifiersNodeChildNodeContent;

  return quantifier;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvYm5mLmpzIl0sIm5hbWVzIjpbImxleGVycyIsInJlcXVpcmUiLCJhcnJheVV0aWxpdGllcyIsIkJORkxleGVyIiwiZmlyc3QiLCJzZWNvbmQiLCJzcGVjaWFsU3ltYm9scyIsIk5PX1dISVRFU1BBQ0UiLCJpc05vZGVOb1doaXRlc3BhY2VOb2RlIiwibm9kZSIsIm5vZGVOb1doaXRlc3BhY2VOb2RlIiwibm9kZVRlcm1pbmFsTm9kZSIsImlzVGVybWluYWxOb2RlIiwidGVybWluYWxOb2RlIiwidGVybWluYWxOb2RlQ29udGVudCIsImdldENvbnRlbnQiLCJpc05vZGVDaG9pY2VOb2RlIiwibm9kZU5vQ2hvaWNlTm9kZSIsImlzTm9kZVF1YW50aWZpZXJzTm9kZSIsIm5vZGVRdWFudGlmaWVyc05vZGUiLCJub2RlTm9uVGVybWluYWxOb2RlIiwibm9uVGVybWluYWxOb2RlIiwiY2hpbGROb2RlcyIsImdldENoaWxkTm9kZXMiLCJmaXJzdENoaWxkTm9kZSIsImZpcnN0Q2hpbGROb2RlVGVybWluYWxOb2RlIiwicXVhbnRpZmllcnNGcm9tUXVhbnRpZmllcnNOb2RlIiwicXVhbnRpZmllcnNOb2RlIiwicXVhbnRpZmllcnMiLCJxdWFudGlmaWVyIiwicXVhbnRpZmllckZyb21RdWFudGlmaWVyc05vZGUiLCJwdXNoIiwicXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlcyIsInF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZXNMZW5ndGgiLCJsZW5ndGgiLCJzZWNvbmRRdWFudGlmaWVyc05vZGVDaGlsZE5vZGUiLCJzZWNvbmRRdWFudGlmaWVyc05vZGVDaGlsZE5vZGVRdWFudGlmaWVyc05vZGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZmlyc3RRdWFudGlmaWVyc05vZGVDaGlsZE5vZGUiLCJmaXJzdFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZUNvbnRlbnQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLFNBQVNDLFFBQVEs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NEJBQTRCTCxnQkFBZ0JKLGFBQWhCLEVBQWxDO0FBQUEsTUFDTWdCLGdDQUFnQ25DLE1BQU00Qix5QkFBTixDQUR0QztBQUFBLE1BRU1RLHVDQUF1Q0QsOEJBQThCeEIsVUFBOUIsRUFGN0M7QUFBQSxNQUdNYyxhQUFhVyxvQ0FIbkI7O0FBS0EsU0FBT1gsVUFBUDtBQUNEIiwiZmlsZSI6ImJuZi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbGV4ZXJzID0gcmVxdWlyZSgnb2NjYW0tbGV4ZXJzJyk7XG5cbmNvbnN0IGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FycmF5Jyk7XG5cbmNvbnN0IHsgQk5GTGV4ZXIgfSA9IGxleGVycyxcbiAgICAgIHsgZmlyc3QsIHNlY29uZCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IHNwZWNpYWxTeW1ib2xzIH0gPSBCTkZMZXhlcixcbiAgICAgIHsgTk9fV0hJVEVTUEFDRSB9ID0gc3BlY2lhbFN5bWJvbHM7XG5cbmZ1bmN0aW9uIGlzTm9kZU5vV2hpdGVzcGFjZU5vZGUobm9kZSkge1xuICBsZXQgbm9kZU5vV2hpdGVzcGFjZU5vZGUgPSBmYWxzZTtcblxuICBjb25zdCBub2RlVGVybWluYWxOb2RlID0gbm9kZS5pc1Rlcm1pbmFsTm9kZSgpO1xuXG4gIGlmIChub2RlVGVybWluYWxOb2RlKSB7XG4gICAgY29uc3QgdGVybWluYWxOb2RlID0gbm9kZSxcbiAgICAgICAgICB0ZXJtaW5hbE5vZGVDb250ZW50ID0gdGVybWluYWxOb2RlLmdldENvbnRlbnQoKTtcblxuICAgIG5vZGVOb1doaXRlc3BhY2VOb2RlID0gKHRlcm1pbmFsTm9kZUNvbnRlbnQgPT09IE5PX1dISVRFU1BBQ0UpO1xuICB9XG5cbiAgcmV0dXJuIG5vZGVOb1doaXRlc3BhY2VOb2RlO1xufVxuXG5mdW5jdGlvbiBpc05vZGVDaG9pY2VOb2RlKG5vZGUpIHtcbiAgbGV0IG5vZGVOb0Nob2ljZU5vZGUgPSBmYWxzZTtcblxuICBjb25zdCBub2RlVGVybWluYWxOb2RlID0gbm9kZS5pc1Rlcm1pbmFsTm9kZSgpO1xuXG4gIGlmIChub2RlVGVybWluYWxOb2RlKSB7XG4gICAgY29uc3QgdGVybWluYWxOb2RlID0gbm9kZSxcbiAgICAgICAgICB0ZXJtaW5hbE5vZGVDb250ZW50ID0gdGVybWluYWxOb2RlLmdldENvbnRlbnQoKTtcblxuICAgIG5vZGVOb0Nob2ljZU5vZGUgPSAodGVybWluYWxOb2RlQ29udGVudCA9PT0gJ3wnKTtcbiAgfVxuXG4gIHJldHVybiBub2RlTm9DaG9pY2VOb2RlO1xufVxuXG5mdW5jdGlvbiBpc05vZGVRdWFudGlmaWVyc05vZGUobm9kZSkge1xuICBsZXQgbm9kZVF1YW50aWZpZXJzTm9kZSA9IGZhbHNlO1xuXG4gIGNvbnN0IG5vZGVUZXJtaW5hbE5vZGUgPSBub2RlLmlzVGVybWluYWxOb2RlKCksXG4gICAgICAgIG5vZGVOb25UZXJtaW5hbE5vZGUgPSAhbm9kZVRlcm1pbmFsTm9kZTtcblxuICBpZiAobm9kZU5vblRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IG5vblRlcm1pbmFsTm9kZSA9IG5vZGUsIC8vL1xuICAgICAgICAgIGNoaWxkTm9kZXMgPSBub25UZXJtaW5hbE5vZGUuZ2V0Q2hpbGROb2RlcygpLFxuICAgICAgICAgIGZpcnN0Q2hpbGROb2RlID0gZmlyc3QoY2hpbGROb2RlcyksXG4gICAgICAgICAgZmlyc3RDaGlsZE5vZGVUZXJtaW5hbE5vZGUgPSBmaXJzdENoaWxkTm9kZS5pc1Rlcm1pbmFsTm9kZSgpO1xuXG4gICAgaWYgKGZpcnN0Q2hpbGROb2RlVGVybWluYWxOb2RlKSB7XG4gICAgICBjb25zdCB0ZXJtaW5hbE5vZGUgPSBmaXJzdENoaWxkTm9kZSwgIC8vL1xuICAgICAgICAgICAgdGVybWluYWxOb2RlQ29udGVudCA9IHRlcm1pbmFsTm9kZS5nZXRDb250ZW50KCk7XG5cbiAgICAgIG5vZGVRdWFudGlmaWVyc05vZGUgPSAodGVybWluYWxOb2RlQ29udGVudCA9PT0gJz8nKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0ZXJtaW5hbE5vZGVDb250ZW50ID09PSAnKicpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRlcm1pbmFsTm9kZUNvbnRlbnQgPT09ICcrJyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5vZGVRdWFudGlmaWVyc05vZGU7XG59XG5cbmZ1bmN0aW9uIHF1YW50aWZpZXJzRnJvbVF1YW50aWZpZXJzTm9kZShxdWFudGlmaWVyc05vZGUsIHF1YW50aWZpZXJzID0gW10pIHtcbiAgY29uc3QgcXVhbnRpZmllciA9IHF1YW50aWZpZXJGcm9tUXVhbnRpZmllcnNOb2RlKHF1YW50aWZpZXJzTm9kZSk7XG5cbiAgcXVhbnRpZmllcnMucHVzaChxdWFudGlmaWVyKTtcblxuICBjb25zdCBxdWFudGlmaWVyc05vZGVDaGlsZE5vZGVzID0gcXVhbnRpZmllcnNOb2RlLmdldENoaWxkTm9kZXMoKSxcbiAgICAgICAgcXVhbnRpZmllcnNOb2RlQ2hpbGROb2Rlc0xlbmd0aCA9ICBxdWFudGlmaWVyc05vZGVDaGlsZE5vZGVzLmxlbmd0aDtcblxuICBpZiAocXVhbnRpZmllcnNOb2RlQ2hpbGROb2Rlc0xlbmd0aCA9PT0gMikge1xuICAgIGNvbnN0IHNlY29uZFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZSA9IHNlY29uZChxdWFudGlmaWVyc05vZGVDaGlsZE5vZGVzKSxcbiAgICAgICAgICBzZWNvbmRRdWFudGlmaWVyc05vZGVDaGlsZE5vZGVRdWFudGlmaWVyc05vZGUgPSBpc05vZGVRdWFudGlmaWVyc05vZGUoc2Vjb25kUXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlKTtcblxuICAgIGlmIChzZWNvbmRRdWFudGlmaWVyc05vZGVDaGlsZE5vZGVRdWFudGlmaWVyc05vZGUpIHtcbiAgICAgIHF1YW50aWZpZXJzTm9kZSA9IHNlY29uZFF1YW50aWZpZXJzTm9kZUNoaWxkTm9kZTsgLy8vXG5cbiAgICAgIHF1YW50aWZpZXJzID0gcXVhbnRpZmllcnNGcm9tUXVhbnRpZmllcnNOb2RlKHF1YW50aWZpZXJzTm9kZSwgcXVhbnRpZmllcnMpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBxdWFudGlmaWVycztcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGlzTm9kZU5vV2hpdGVzcGFjZU5vZGUsXG4gIGlzTm9kZUNob2ljZU5vZGUsXG4gIGlzTm9kZVF1YW50aWZpZXJzTm9kZSxcbiAgcXVhbnRpZmllcnNGcm9tUXVhbnRpZmllcnNOb2RlXG59O1xuXG5mdW5jdGlvbiBxdWFudGlmaWVyRnJvbVF1YW50aWZpZXJzTm9kZShxdWFudGlmaWVyc05vZGUpIHtcbiAgY29uc3QgcXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlcyA9IHF1YW50aWZpZXJzTm9kZS5nZXRDaGlsZE5vZGVzKCksXG4gICAgICAgIGZpcnN0UXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlID0gZmlyc3QocXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlcyksXG4gICAgICAgIGZpcnN0UXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlQ29udGVudCA9IGZpcnN0UXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlLmdldENvbnRlbnQoKSxcbiAgICAgICAgcXVhbnRpZmllciA9IGZpcnN0UXVhbnRpZmllcnNOb2RlQ2hpbGROb2RlQ29udGVudDtcblxuICByZXR1cm4gcXVhbnRpZmllcjtcbn1cbiJdfQ==