'use strict';

var lexers = require('occam-lexers'),
    necessary = require('necessary');

var BNFParser = require('../bnf/parser'),
    arrayUtilities = require('../utilities/array'),
    parserUtilities = require('../utilities/parser'),
    QualifiedCustomGrammarRule = require('../florence/rule/customGrammar/qualified'),
    UnqualifiedCustomGrammarRule = require('../florence/rule/customGrammar/unqualified');

var BNFLexer = lexers.BNFLexer,
    push = arrayUtilities.push,
    findRuleByName = parserUtilities.findRuleByName,
    add = push; ///

var bnfLexer = BNFLexer.fromNothing(),
    bnfParser = BNFParser.fromNothing(),
    statementRuleName = 'statement',
    metastatementRuleName = 'metastatement',
    qualifiedStatementRuleName = 'qualifiedStatement',
    qualifiedMetastatementRuleName = 'qualifiedMetastatement',
    unqualifiedStatementRuleName = 'unqualifiedStatement',
    unqualifiedMetastatementRuleName = 'unqualifiedMetastatement';

function rulesFromBNFMap(bnfMap) {
      var ruleNames = Object.keys(bnfMap),
          bnf = ruleNames.reduce(function (bnf, ruleName) {
            var ruleBNF = bnfMap[ruleName];

            bnf = '' + bnf + ruleBNF;

            return bnf;
      }, ''),
          lines = bnfLexer.linesFromBNF(bnf),
          rulesNode = bnfParser.rulesNodeFromLines(lines),
          rules = BNFParser.generateRules(rulesNode);

      return rules;
}

function addQualifiedAndUnqualifiedStatementAndMetastatementRules(combinedCustomGrammarsRules) {
      combinedCustomGrammarsRules = combinedCustomGrammarsRules.slice(); ///

      var statementCustomGrammarRule = findRuleByName(statementRuleName, combinedCustomGrammarsRules),
          metastatementCustomGrammarRule = findRuleByName(metastatementRuleName, combinedCustomGrammarsRules),
          qualifiedStatementCustomGrammarRule = new QualifiedCustomGrammarRule.fromRuleNameAndCustomGrammarRule(qualifiedStatementRuleName, statementCustomGrammarRule),
          unqualifiedStatementCustomGrammarRule = new UnqualifiedCustomGrammarRule.fromRuleNameAndCustomGrammarRule(unqualifiedStatementRuleName, statementCustomGrammarRule),
          qualifiedMetastatementCustomGrammarRule = new QualifiedCustomGrammarRule.fromRuleNameAndCustomGrammarRule(qualifiedMetastatementRuleName, metastatementCustomGrammarRule),
          unqualifiedMetastatementCustomGrammarRule = new UnqualifiedCustomGrammarRule.fromRuleNameAndCustomGrammarRule(unqualifiedMetastatementRuleName, metastatementCustomGrammarRule),
          qualifiedAndUnqualifiedStatementAndMetastatementRules = [qualifiedStatementCustomGrammarRule, unqualifiedStatementCustomGrammarRule, qualifiedMetastatementCustomGrammarRule, unqualifiedMetastatementCustomGrammarRule];

      add(combinedCustomGrammarsRules, qualifiedAndUnqualifiedStatementAndMetastatementRules);

      return combinedCustomGrammarsRules;
}

module.exports = {
      rulesFromBNFMap: rulesFromBNFMap,
      addQualifiedAndUnqualifiedStatementAndMetastatementRules: addQualifiedAndUnqualifiedStatementAndMetastatementRules
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvY3VzdG9tR3JhbW1hci5qcyJdLCJuYW1lcyI6WyJsZXhlcnMiLCJyZXF1aXJlIiwibmVjZXNzYXJ5IiwiQk5GUGFyc2VyIiwiYXJyYXlVdGlsaXRpZXMiLCJwYXJzZXJVdGlsaXRpZXMiLCJRdWFsaWZpZWRDdXN0b21HcmFtbWFyUnVsZSIsIlVucXVhbGlmaWVkQ3VzdG9tR3JhbW1hclJ1bGUiLCJCTkZMZXhlciIsInB1c2giLCJmaW5kUnVsZUJ5TmFtZSIsImFkZCIsImJuZkxleGVyIiwiZnJvbU5vdGhpbmciLCJibmZQYXJzZXIiLCJzdGF0ZW1lbnRSdWxlTmFtZSIsIm1ldGFzdGF0ZW1lbnRSdWxlTmFtZSIsInF1YWxpZmllZFN0YXRlbWVudFJ1bGVOYW1lIiwicXVhbGlmaWVkTWV0YXN0YXRlbWVudFJ1bGVOYW1lIiwidW5xdWFsaWZpZWRTdGF0ZW1lbnRSdWxlTmFtZSIsInVucXVhbGlmaWVkTWV0YXN0YXRlbWVudFJ1bGVOYW1lIiwicnVsZXNGcm9tQk5GTWFwIiwiYm5mTWFwIiwicnVsZU5hbWVzIiwiT2JqZWN0Iiwia2V5cyIsImJuZiIsInJlZHVjZSIsInJ1bGVOYW1lIiwicnVsZUJORiIsImxpbmVzIiwibGluZXNGcm9tQk5GIiwicnVsZXNOb2RlIiwicnVsZXNOb2RlRnJvbUxpbmVzIiwicnVsZXMiLCJnZW5lcmF0ZVJ1bGVzIiwiYWRkUXVhbGlmaWVkQW5kVW5xdWFsaWZpZWRTdGF0ZW1lbnRBbmRNZXRhc3RhdGVtZW50UnVsZXMiLCJjb21iaW5lZEN1c3RvbUdyYW1tYXJzUnVsZXMiLCJzbGljZSIsInN0YXRlbWVudEN1c3RvbUdyYW1tYXJSdWxlIiwibWV0YXN0YXRlbWVudEN1c3RvbUdyYW1tYXJSdWxlIiwicXVhbGlmaWVkU3RhdGVtZW50Q3VzdG9tR3JhbW1hclJ1bGUiLCJmcm9tUnVsZU5hbWVBbmRDdXN0b21HcmFtbWFyUnVsZSIsInVucXVhbGlmaWVkU3RhdGVtZW50Q3VzdG9tR3JhbW1hclJ1bGUiLCJxdWFsaWZpZWRNZXRhc3RhdGVtZW50Q3VzdG9tR3JhbW1hclJ1bGUiLCJ1bnF1YWxpZmllZE1ldGFzdGF0ZW1lbnRDdXN0b21HcmFtbWFyUnVsZSIsInF1YWxpZmllZEFuZFVucXVhbGlmaWVkU3RhdGVtZW50QW5kTWV0YXN0YXRlbWVudFJ1bGVzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsU0FBU0MsUUFBUSxjQUFSLENBQWY7QUFBQSxJQUNNQyxZQUFZRCxRQUFRLFdBQVIsQ0FEbEI7O0FBR0EsSUFBTUUsWUFBWUYsUUFBUSxlQUFSLENBQWxCO0FBQUEsSUFDTUcsaUJBQWlCSCxRQUFRLG9CQUFSLENBRHZCO0FBQUEsSUFFTUksa0JBQWtCSixRQUFRLHFCQUFSLENBRnhCO0FBQUEsSUFHTUssNkJBQTZCTCxRQUFRLDBDQUFSLENBSG5DO0FBQUEsSUFJTU0sK0JBQStCTixRQUFRLDRDQUFSLENBSnJDOztBQU1NLElBQUVPLFFBQUYsR0FBZVIsTUFBZixDQUFFUSxRQUFGO0FBQUEsSUFDRUMsSUFERixHQUNXTCxjQURYLENBQ0VLLElBREY7QUFBQSxJQUVFQyxjQUZGLEdBRXFCTCxlQUZyQixDQUVFSyxjQUZGO0FBQUEsSUFHQUMsR0FIQSxHQUdNRixJQUhOLEMsQ0FHWTs7QUFFbEIsSUFBTUcsV0FBV0osU0FBU0ssV0FBVCxFQUFqQjtBQUFBLElBQ01DLFlBQVlYLFVBQVVVLFdBQVYsRUFEbEI7QUFBQSxJQUVNRSxvQkFBb0IsV0FGMUI7QUFBQSxJQUdNQyx3QkFBd0IsZUFIOUI7QUFBQSxJQUlNQyw2QkFBNkIsb0JBSm5DO0FBQUEsSUFLTUMsaUNBQWlDLHdCQUx2QztBQUFBLElBTU1DLCtCQUErQixzQkFOckM7QUFBQSxJQU9NQyxtQ0FBbUMsMEJBUHpDOztBQVNBLFNBQVNDLGVBQVQsQ0FBeUJDLE1BQXpCLEVBQWlDO0FBQy9CLFVBQU1DLFlBQVlDLE9BQU9DLElBQVAsQ0FBWUgsTUFBWixDQUFsQjtBQUFBLFVBQ01JLE1BQU1ILFVBQVVJLE1BQVYsQ0FBaUIsVUFBU0QsR0FBVCxFQUFjRSxRQUFkLEVBQXdCO0FBQzdDLGdCQUFNQyxVQUFVUCxPQUFPTSxRQUFQLENBQWhCOztBQUVBRix1QkFBU0EsR0FBVCxHQUFlRyxPQUFmOztBQUVBLG1CQUFPSCxHQUFQO0FBQ0QsT0FOSyxFQU1ILEVBTkcsQ0FEWjtBQUFBLFVBUU1JLFFBQVFsQixTQUFTbUIsWUFBVCxDQUFzQkwsR0FBdEIsQ0FSZDtBQUFBLFVBU01NLFlBQVlsQixVQUFVbUIsa0JBQVYsQ0FBNkJILEtBQTdCLENBVGxCO0FBQUEsVUFVTUksUUFBUS9CLFVBQVVnQyxhQUFWLENBQXdCSCxTQUF4QixDQVZkOztBQVlBLGFBQU9FLEtBQVA7QUFDRDs7QUFFRCxTQUFTRSx3REFBVCxDQUFrRUMsMkJBQWxFLEVBQStGO0FBQzdGQSxvQ0FBOEJBLDRCQUE0QkMsS0FBNUIsRUFBOUIsQ0FENkYsQ0FDekI7O0FBRXBFLFVBQU1DLDZCQUE2QjdCLGVBQWVLLGlCQUFmLEVBQWtDc0IsMkJBQWxDLENBQW5DO0FBQUEsVUFDTUcsaUNBQWlDOUIsZUFBZU0scUJBQWYsRUFBc0NxQiwyQkFBdEMsQ0FEdkM7QUFBQSxVQUVNSSxzQ0FBc0MsSUFBSW5DLDJCQUEyQm9DLGdDQUEvQixDQUFnRXpCLDBCQUFoRSxFQUE0RnNCLDBCQUE1RixDQUY1QztBQUFBLFVBR01JLHdDQUF3QyxJQUFJcEMsNkJBQTZCbUMsZ0NBQWpDLENBQWtFdkIsNEJBQWxFLEVBQWdHb0IsMEJBQWhHLENBSDlDO0FBQUEsVUFJTUssMENBQTBDLElBQUl0QywyQkFBMkJvQyxnQ0FBL0IsQ0FBZ0V4Qiw4QkFBaEUsRUFBZ0dzQiw4QkFBaEcsQ0FKaEQ7QUFBQSxVQUtNSyw0Q0FBNEMsSUFBSXRDLDZCQUE2Qm1DLGdDQUFqQyxDQUFrRXRCLGdDQUFsRSxFQUFvR29CLDhCQUFwRyxDQUxsRDtBQUFBLFVBTU1NLHdEQUF3RCxDQUN0REwsbUNBRHNELEVBRXRERSxxQ0FGc0QsRUFHdERDLHVDQUhzRCxFQUl0REMseUNBSnNELENBTjlEOztBQWFBbEMsVUFBSTBCLDJCQUFKLEVBQWlDUyxxREFBakM7O0FBRUEsYUFBT1QsMkJBQVA7QUFDRDs7QUFFRFUsT0FBT0MsT0FBUCxHQUFpQjtBQUNmM0IsdUJBQWlCQSxlQURGO0FBRWZlLGdFQUEwREE7QUFGM0MsQ0FBakIiLCJmaWxlIjoiY3VzdG9tR3JhbW1hci5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbGV4ZXJzID0gcmVxdWlyZSgnb2NjYW0tbGV4ZXJzJyksXG4gICAgICBuZWNlc3NhcnkgPSByZXF1aXJlKCduZWNlc3NhcnknKTtcblxuY29uc3QgQk5GUGFyc2VyID0gcmVxdWlyZSgnLi4vYm5mL3BhcnNlcicpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKSxcbiAgICAgIHBhcnNlclV0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9wYXJzZXInKSxcbiAgICAgIFF1YWxpZmllZEN1c3RvbUdyYW1tYXJSdWxlID0gcmVxdWlyZSgnLi4vZmxvcmVuY2UvcnVsZS9jdXN0b21HcmFtbWFyL3F1YWxpZmllZCcpLFxuICAgICAgVW5xdWFsaWZpZWRDdXN0b21HcmFtbWFyUnVsZSA9IHJlcXVpcmUoJy4uL2Zsb3JlbmNlL3J1bGUvY3VzdG9tR3JhbW1hci91bnF1YWxpZmllZCcpO1xuXG5jb25zdCB7IEJORkxleGVyIH0gPSBsZXhlcnMsXG4gICAgICB7IHB1c2ggfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBmaW5kUnVsZUJ5TmFtZSB9ID0gcGFyc2VyVXRpbGl0aWVzLFxuICAgICAgYWRkID0gcHVzaDsgLy8vXG5cbmNvbnN0IGJuZkxleGVyID0gQk5GTGV4ZXIuZnJvbU5vdGhpbmcoKSxcbiAgICAgIGJuZlBhcnNlciA9IEJORlBhcnNlci5mcm9tTm90aGluZygpLFxuICAgICAgc3RhdGVtZW50UnVsZU5hbWUgPSAnc3RhdGVtZW50JyxcbiAgICAgIG1ldGFzdGF0ZW1lbnRSdWxlTmFtZSA9ICdtZXRhc3RhdGVtZW50JyxcbiAgICAgIHF1YWxpZmllZFN0YXRlbWVudFJ1bGVOYW1lID0gJ3F1YWxpZmllZFN0YXRlbWVudCcsXG4gICAgICBxdWFsaWZpZWRNZXRhc3RhdGVtZW50UnVsZU5hbWUgPSAncXVhbGlmaWVkTWV0YXN0YXRlbWVudCcsXG4gICAgICB1bnF1YWxpZmllZFN0YXRlbWVudFJ1bGVOYW1lID0gJ3VucXVhbGlmaWVkU3RhdGVtZW50JyxcbiAgICAgIHVucXVhbGlmaWVkTWV0YXN0YXRlbWVudFJ1bGVOYW1lID0gJ3VucXVhbGlmaWVkTWV0YXN0YXRlbWVudCc7XG5cbmZ1bmN0aW9uIHJ1bGVzRnJvbUJORk1hcChibmZNYXApIHtcbiAgY29uc3QgcnVsZU5hbWVzID0gT2JqZWN0LmtleXMoYm5mTWFwKSxcbiAgICAgICAgYm5mID0gcnVsZU5hbWVzLnJlZHVjZShmdW5jdGlvbihibmYsIHJ1bGVOYW1lKSB7XG4gICAgICAgICAgY29uc3QgcnVsZUJORiA9IGJuZk1hcFtydWxlTmFtZV07XG5cbiAgICAgICAgICBibmYgPSBgJHtibmZ9JHtydWxlQk5GfWA7XG5cbiAgICAgICAgICByZXR1cm4gYm5mO1xuICAgICAgICB9LCAnJyksXG4gICAgICAgIGxpbmVzID0gYm5mTGV4ZXIubGluZXNGcm9tQk5GKGJuZiksXG4gICAgICAgIHJ1bGVzTm9kZSA9IGJuZlBhcnNlci5ydWxlc05vZGVGcm9tTGluZXMobGluZXMpLFxuICAgICAgICBydWxlcyA9IEJORlBhcnNlci5nZW5lcmF0ZVJ1bGVzKHJ1bGVzTm9kZSk7XG5cbiAgcmV0dXJuIHJ1bGVzO1xufVxuXG5mdW5jdGlvbiBhZGRRdWFsaWZpZWRBbmRVbnF1YWxpZmllZFN0YXRlbWVudEFuZE1ldGFzdGF0ZW1lbnRSdWxlcyhjb21iaW5lZEN1c3RvbUdyYW1tYXJzUnVsZXMpIHtcbiAgY29tYmluZWRDdXN0b21HcmFtbWFyc1J1bGVzID0gY29tYmluZWRDdXN0b21HcmFtbWFyc1J1bGVzLnNsaWNlKCk7ICAvLy9cbiAgXG4gIGNvbnN0IHN0YXRlbWVudEN1c3RvbUdyYW1tYXJSdWxlID0gZmluZFJ1bGVCeU5hbWUoc3RhdGVtZW50UnVsZU5hbWUsIGNvbWJpbmVkQ3VzdG9tR3JhbW1hcnNSdWxlcyksXG4gICAgICAgIG1ldGFzdGF0ZW1lbnRDdXN0b21HcmFtbWFyUnVsZSA9IGZpbmRSdWxlQnlOYW1lKG1ldGFzdGF0ZW1lbnRSdWxlTmFtZSwgY29tYmluZWRDdXN0b21HcmFtbWFyc1J1bGVzKSxcbiAgICAgICAgcXVhbGlmaWVkU3RhdGVtZW50Q3VzdG9tR3JhbW1hclJ1bGUgPSBuZXcgUXVhbGlmaWVkQ3VzdG9tR3JhbW1hclJ1bGUuZnJvbVJ1bGVOYW1lQW5kQ3VzdG9tR3JhbW1hclJ1bGUocXVhbGlmaWVkU3RhdGVtZW50UnVsZU5hbWUsIHN0YXRlbWVudEN1c3RvbUdyYW1tYXJSdWxlKSxcbiAgICAgICAgdW5xdWFsaWZpZWRTdGF0ZW1lbnRDdXN0b21HcmFtbWFyUnVsZSA9IG5ldyBVbnF1YWxpZmllZEN1c3RvbUdyYW1tYXJSdWxlLmZyb21SdWxlTmFtZUFuZEN1c3RvbUdyYW1tYXJSdWxlKHVucXVhbGlmaWVkU3RhdGVtZW50UnVsZU5hbWUsIHN0YXRlbWVudEN1c3RvbUdyYW1tYXJSdWxlKSxcbiAgICAgICAgcXVhbGlmaWVkTWV0YXN0YXRlbWVudEN1c3RvbUdyYW1tYXJSdWxlID0gbmV3IFF1YWxpZmllZEN1c3RvbUdyYW1tYXJSdWxlLmZyb21SdWxlTmFtZUFuZEN1c3RvbUdyYW1tYXJSdWxlKHF1YWxpZmllZE1ldGFzdGF0ZW1lbnRSdWxlTmFtZSwgbWV0YXN0YXRlbWVudEN1c3RvbUdyYW1tYXJSdWxlKSxcbiAgICAgICAgdW5xdWFsaWZpZWRNZXRhc3RhdGVtZW50Q3VzdG9tR3JhbW1hclJ1bGUgPSBuZXcgVW5xdWFsaWZpZWRDdXN0b21HcmFtbWFyUnVsZS5mcm9tUnVsZU5hbWVBbmRDdXN0b21HcmFtbWFyUnVsZSh1bnF1YWxpZmllZE1ldGFzdGF0ZW1lbnRSdWxlTmFtZSwgbWV0YXN0YXRlbWVudEN1c3RvbUdyYW1tYXJSdWxlKSxcbiAgICAgICAgcXVhbGlmaWVkQW5kVW5xdWFsaWZpZWRTdGF0ZW1lbnRBbmRNZXRhc3RhdGVtZW50UnVsZXMgPSBbXG4gICAgICAgICAgcXVhbGlmaWVkU3RhdGVtZW50Q3VzdG9tR3JhbW1hclJ1bGUsXG4gICAgICAgICAgdW5xdWFsaWZpZWRTdGF0ZW1lbnRDdXN0b21HcmFtbWFyUnVsZSxcbiAgICAgICAgICBxdWFsaWZpZWRNZXRhc3RhdGVtZW50Q3VzdG9tR3JhbW1hclJ1bGUsXG4gICAgICAgICAgdW5xdWFsaWZpZWRNZXRhc3RhdGVtZW50Q3VzdG9tR3JhbW1hclJ1bGVcbiAgICAgICAgXTtcblxuICBhZGQoY29tYmluZWRDdXN0b21HcmFtbWFyc1J1bGVzLCBxdWFsaWZpZWRBbmRVbnF1YWxpZmllZFN0YXRlbWVudEFuZE1ldGFzdGF0ZW1lbnRSdWxlcyk7XG5cbiAgcmV0dXJuIGNvbWJpbmVkQ3VzdG9tR3JhbW1hcnNSdWxlcztcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHJ1bGVzRnJvbUJORk1hcDogcnVsZXNGcm9tQk5GTWFwLFxuICBhZGRRdWFsaWZpZWRBbmRVbnF1YWxpZmllZFN0YXRlbWVudEFuZE1ldGFzdGF0ZW1lbnRSdWxlczogYWRkUXVhbGlmaWVkQW5kVW5xdWFsaWZpZWRTdGF0ZW1lbnRBbmRNZXRhc3RhdGVtZW50UnVsZXNcbn07XG4iXX0=