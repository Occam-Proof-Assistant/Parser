'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Graph = require('./graph'),
    parserUtil = require('../util/parser'),
    Production = require('../common/production'),
    UnitRuleProduction = require('./production/unitRule'),
    UnitRulesProduction = require('./production/unitRules'),
    NonUnitRulesProduction = require('./production/nonUnitRules'),
    RightRecursiveProduction = require('./production/rightRecursive'),
    NonLeftRecursiveProduction = require('./production/nonLeftRecursive'),
    NonImplicitlyLeftRecursiveProduction = require('./production/nonImplicitlyLeftRecursive');

var grammarUtil = function () {
  function grammarUtil() {
    _classCallCheck(this, grammarUtil);
  }

  _createClass(grammarUtil, null, [{
    key: 'eliminateCycles',
    value: function eliminateCycles(productions) {
      var unitRulesProductions = unitRulesProductionsFromProductions(productions),
          graph = graphFromUnitRulesProductions(unitRulesProductions),
          nonCyclicProductions = nonCyclicProductionsFromGraph(graph, productions);

      productions = nonCyclicProductions; ///

      return productions;
    }
  }, {
    key: 'eliminateLeftRecursion',
    value: function eliminateLeftRecursion(productions) {
      var nonLeftRecursiveProductions = [],
          rightRecursiveProductions = [];

      productions.forEach(function (production, index) {
        var begin = 0,
            end = index,
            ///
        previousNonLeftRecursiveProductions = nonLeftRecursiveProductions.slice(begin, end),
            previousProductions = previousNonLeftRecursiveProductions,
            ///
        productionImplicitlyLeftRecursive = production.isImplicitlyLeftRecursive(previousProductions);

        if (productionImplicitlyLeftRecursive) {
          var nonImplicitlyLeftRecursiveProduction = NonImplicitlyLeftRecursiveProduction.fromProductionAndPreviousProductions(production, previousProductions);

          production = nonImplicitlyLeftRecursiveProduction; ///
        }

        var productionLeftRecursive = production.isLeftRecursive();

        if (productionLeftRecursive) {
          var nonLeftRecursiveProduction = NonLeftRecursiveProduction.fromProduction(production),
              rightRecursiveProduction = RightRecursiveProduction.fromProduction(production);

          nonLeftRecursiveProductions.push(nonLeftRecursiveProduction);

          rightRecursiveProductions.push(rightRecursiveProduction);
        } else {
          var _nonLeftRecursiveProduction = production; ///

          nonLeftRecursiveProductions.push(_nonLeftRecursiveProduction);
        }
      });

      productions = [].concat(nonLeftRecursiveProductions).concat(rightRecursiveProductions);

      return productions;
    }
  }]);

  return grammarUtil;
}();

module.exports = grammarUtil;

function unitRulesProductionsFromProductions(productions) {
  var unitRulesProductions = productions.reduce(function (unitRulesProductions, production) {
    var unitRulesProduction = UnitRulesProduction.fromProduction(production);

    if (unitRulesProduction !== null) {
      unitRulesProductions.push(unitRulesProduction);
    }

    return unitRulesProductions;
  }, []);

  return unitRulesProductions;
}

function graphFromUnitRulesProductions(unitRulesProductions) {
  var graph = new Graph();

  unitRulesProductions.forEach(function (unitRulesProduction) {
    var productionName = unitRulesProduction.getName(),
        productionNames = unitRulesProduction.getProductionNames(),
        vertexName = productionName,
        ///
    descendantVertexNames = productionNames; ///

    graph.addVertex(vertexName, descendantVertexNames);
  });

  return graph;
}

function nonCyclicProductionsFromGraph(graph, productions) {
  var components = graph.getComponents(),
      nonCyclicProductions = components.reduce(function (nonCyclicProductions, component) {
    var componentNonCyclic = component.isNonCyclic();

    if (componentNonCyclic) {
      var nonCyclicComponent = component,
          ///
      nonCyclicComponentNonCyclicProduction = nonCyclicProductionFromNonCyclicComponent(nonCyclicComponent, productions);

      nonCyclicProductions.push(nonCyclicComponentNonCyclicProduction);
    } else {
      var cyclicComponent = component,
          ///
      cyclicComponentNonCyclicProductions = nonCyclicProductionsFromCyclicComponent(cyclicComponent, productions);

      nonCyclicProductions = nonCyclicProductions.concat(cyclicComponentNonCyclicProductions);
    }

    return nonCyclicProductions;
  }, []);

  return nonCyclicProductions;
}

function nonCyclicProductionFromNonCyclicComponent(nonCyclicComponent, productions) {
  var firstVertex = nonCyclicComponent.getFirstVertex(),
      firstVertexName = firstVertex.getName(),
      nonCyclicProductionName = firstVertexName,
      ///
  nonCyclicProduction = parserUtil.findProduction(nonCyclicProductionName, productions);

  return nonCyclicProduction;
}

function nonCyclicProductionsFromCyclicComponent(cyclicComponent, productions) {
  productions = productionsFromCyclicComponent(cyclicComponent, productions); ///

  var unitRuleProductions = unitRuleProductionsFromProductions(productions),
      nonUnitRulesProductions = nonUnitRulesProductionsFromProductions(productions),
      removedUnitRuleProductions = [],
      addedNonUnitRulesProductions = [];

  var unitRuleProductionsLength = unitRuleProductions.length;

  while (unitRuleProductionsLength > 0) {
    var removedUnitRuleProduction = unitRuleProductions.shift();

    removedUnitRuleProductions.push(removedUnitRuleProduction);

    var removedUnitRuleProductionName = removedUnitRuleProduction.getName(),
        removedUnitRuleProductionUnitRuleProductionName = removedUnitRuleProduction.getUnitRuleProductionName(),
        nonUnitRulesProductionName = removedUnitRuleProductionUnitRuleProductionName,
        ///
    nonUnitRulesProduction = parserUtil.findProduction(nonUnitRulesProductionName, nonUnitRulesProductions),
        nonUnitRulesProductionRules = nonUnitRulesProduction.getRules(),
        addedNonUnitRulesProductionName = removedUnitRuleProductionName,
        ///
    addedNonUnitRulesProductionRules = nonUnitRulesProductionRules; ///

    var addedNonUnitRulesProduction = parserUtil.findProduction(addedNonUnitRulesProductionName, addedNonUnitRulesProductions);

    if (addedNonUnitRulesProduction === null) {
      var removedUnitRuleProductionNode = removedUnitRuleProduction.getNode(),
          addedNonUnitRulesProductionNode = removedUnitRuleProductionNode;

      addedNonUnitRulesProduction = new Production(addedNonUnitRulesProductionName, addedNonUnitRulesProductionRules, addedNonUnitRulesProductionNode);

      addedNonUnitRulesProductions.push(addedNonUnitRulesProduction);
    } else {
      addedNonUnitRulesProduction.concatRules(nonUnitRulesProductionRules);
    }

    var unitRuleProductionName = removedUnitRuleProductionUnitRuleProductionName,
        ///
    unitRuleProduction = parserUtil.findProduction(unitRuleProductionName, unitRuleProductions);

    if (unitRuleProduction !== null) {
      var unitRuleProductionUnitRuleProductionName = unitRuleProduction.getUnitRuleProductionName();

      unitRuleProductionName = removedUnitRuleProductionName; ///

      if (unitRuleProductionName !== unitRuleProductionUnitRuleProductionName) {
        unitRuleProduction = findUnitRuleProduction(unitRuleProductionName, unitRuleProductionUnitRuleProductionName, removedUnitRuleProductions);

        if (unitRuleProduction === null) {
          unitRuleProduction = UnitRuleProduction.fromNameAndUnitRuleProductionName(unitRuleProductionName, unitRuleProductionUnitRuleProductionName);

          unitRuleProductions.unshift(unitRuleProduction);
        }
      }
    }

    unitRuleProductionsLength = unitRuleProductions.length;
  }

  nonUnitRulesProductions.forEach(function (nonUnitRulesProduction) {
    var nonUnitRulesProductionName = nonUnitRulesProduction.getName(),
        addedNonUnitRulesProductionName = nonUnitRulesProductionName,
        addedNonUnitRulesProduction = parserUtil.findProduction(addedNonUnitRulesProductionName, addedNonUnitRulesProductions);

    if (addedNonUnitRulesProduction !== null) {
      var _addedNonUnitRulesProductionRules = addedNonUnitRulesProduction.getRules();

      nonUnitRulesProduction.concatRules(_addedNonUnitRulesProductionRules);
    }
  });

  productions = nonUnitRulesProductions; ///

  return productions;
}

function productionsFromCyclicComponent(cyclicComponent, productions) {
  productions = cyclicComponent.mapVertices(function (vertex) {
    var vertexName = vertex.getName(),
        productionName = vertexName,
        ///
    production = parserUtil.findProduction(productionName, productions);

    return production;
  });

  return productions;
}

function unitRuleProductionsFromProductions(productions) {
  var unitRuleProductions = productions.reduce(function (unitRuleProductions, production) {
    var name = production.getName(),
        unitRulesProduction = UnitRulesProduction.fromProduction(production),
        unitRulesProductionUnitRuleProductions = unitRulesProduction.mapUnitRules(function (unitRule) {
      var unitRulesProductionUnitRuleProduction = UnitRuleProduction.fromNameAndUnitRule(name, unitRule);

      return unitRulesProductionUnitRuleProduction;
    });

    unitRuleProductions = unitRuleProductions.concat(unitRulesProductionUnitRuleProductions);

    return unitRuleProductions;
  }, []);

  return unitRuleProductions;
}

function nonUnitRulesProductionsFromProductions(productions) {
  var nonUnitProductions = productions.map(function (production) {
    var nonUnitProduction = NonUnitRulesProduction.fromProduction(production);

    return nonUnitProduction;
  });

  return nonUnitProductions;
}

function findUnitRuleProduction(productionName, unitRuleProductionName, unitRuleProductions) {
  var firstProductionName = productionName,
      ///
  secondProductionName = unitRuleProductionName; ///

  var foundUnitRuleProduction = null;

  unitRuleProductions.some(function (unitRuleProduction) {
    var unitRuleProductionFound = unitRuleProduction.isFoundByProductionNames(firstProductionName, secondProductionName);

    if (unitRuleProductionFound) {
      foundUnitRuleProduction = unitRuleProduction;

      return true;
    }
  });

  var unitRuleProduction = foundUnitRuleProduction; ///

  return unitRuleProduction;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9ncmFtbWFyL3V0aWwuanMiXSwibmFtZXMiOlsiR3JhcGgiLCJyZXF1aXJlIiwicGFyc2VyVXRpbCIsIlByb2R1Y3Rpb24iLCJVbml0UnVsZVByb2R1Y3Rpb24iLCJVbml0UnVsZXNQcm9kdWN0aW9uIiwiTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbiIsIlJpZ2h0UmVjdXJzaXZlUHJvZHVjdGlvbiIsIk5vbkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uIiwiTm9uSW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uIiwiZ3JhbW1hclV0aWwiLCJwcm9kdWN0aW9ucyIsInVuaXRSdWxlc1Byb2R1Y3Rpb25zIiwidW5pdFJ1bGVzUHJvZHVjdGlvbnNGcm9tUHJvZHVjdGlvbnMiLCJncmFwaCIsImdyYXBoRnJvbVVuaXRSdWxlc1Byb2R1Y3Rpb25zIiwibm9uQ3ljbGljUHJvZHVjdGlvbnMiLCJub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21HcmFwaCIsIm5vbkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9ucyIsInJpZ2h0UmVjdXJzaXZlUHJvZHVjdGlvbnMiLCJmb3JFYWNoIiwicHJvZHVjdGlvbiIsImluZGV4IiwiYmVnaW4iLCJlbmQiLCJwcmV2aW91c05vbkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9ucyIsInNsaWNlIiwicHJldmlvdXNQcm9kdWN0aW9ucyIsInByb2R1Y3Rpb25JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZSIsImlzSW1wbGljaXRseUxlZnRSZWN1cnNpdmUiLCJub25JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24iLCJmcm9tUHJvZHVjdGlvbkFuZFByZXZpb3VzUHJvZHVjdGlvbnMiLCJwcm9kdWN0aW9uTGVmdFJlY3Vyc2l2ZSIsImlzTGVmdFJlY3Vyc2l2ZSIsIm5vbkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uIiwiZnJvbVByb2R1Y3Rpb24iLCJyaWdodFJlY3Vyc2l2ZVByb2R1Y3Rpb24iLCJwdXNoIiwiY29uY2F0IiwibW9kdWxlIiwiZXhwb3J0cyIsInJlZHVjZSIsInVuaXRSdWxlc1Byb2R1Y3Rpb24iLCJwcm9kdWN0aW9uTmFtZSIsImdldE5hbWUiLCJwcm9kdWN0aW9uTmFtZXMiLCJnZXRQcm9kdWN0aW9uTmFtZXMiLCJ2ZXJ0ZXhOYW1lIiwiZGVzY2VuZGFudFZlcnRleE5hbWVzIiwiYWRkVmVydGV4IiwiY29tcG9uZW50cyIsImdldENvbXBvbmVudHMiLCJjb21wb25lbnQiLCJjb21wb25lbnROb25DeWNsaWMiLCJpc05vbkN5Y2xpYyIsIm5vbkN5Y2xpY0NvbXBvbmVudCIsIm5vbkN5Y2xpY0NvbXBvbmVudE5vbkN5Y2xpY1Byb2R1Y3Rpb24iLCJub25DeWNsaWNQcm9kdWN0aW9uRnJvbU5vbkN5Y2xpY0NvbXBvbmVudCIsImN5Y2xpY0NvbXBvbmVudCIsImN5Y2xpY0NvbXBvbmVudE5vbkN5Y2xpY1Byb2R1Y3Rpb25zIiwibm9uQ3ljbGljUHJvZHVjdGlvbnNGcm9tQ3ljbGljQ29tcG9uZW50IiwiZmlyc3RWZXJ0ZXgiLCJnZXRGaXJzdFZlcnRleCIsImZpcnN0VmVydGV4TmFtZSIsIm5vbkN5Y2xpY1Byb2R1Y3Rpb25OYW1lIiwibm9uQ3ljbGljUHJvZHVjdGlvbiIsImZpbmRQcm9kdWN0aW9uIiwicHJvZHVjdGlvbnNGcm9tQ3ljbGljQ29tcG9uZW50IiwidW5pdFJ1bGVQcm9kdWN0aW9ucyIsInVuaXRSdWxlUHJvZHVjdGlvbnNGcm9tUHJvZHVjdGlvbnMiLCJub25Vbml0UnVsZXNQcm9kdWN0aW9ucyIsIm5vblVuaXRSdWxlc1Byb2R1Y3Rpb25zRnJvbVByb2R1Y3Rpb25zIiwicmVtb3ZlZFVuaXRSdWxlUHJvZHVjdGlvbnMiLCJhZGRlZE5vblVuaXRSdWxlc1Byb2R1Y3Rpb25zIiwidW5pdFJ1bGVQcm9kdWN0aW9uc0xlbmd0aCIsImxlbmd0aCIsInJlbW92ZWRVbml0UnVsZVByb2R1Y3Rpb24iLCJzaGlmdCIsInJlbW92ZWRVbml0UnVsZVByb2R1Y3Rpb25OYW1lIiwicmVtb3ZlZFVuaXRSdWxlUHJvZHVjdGlvblVuaXRSdWxlUHJvZHVjdGlvbk5hbWUiLCJnZXRVbml0UnVsZVByb2R1Y3Rpb25OYW1lIiwibm9uVW5pdFJ1bGVzUHJvZHVjdGlvbk5hbWUiLCJub25Vbml0UnVsZXNQcm9kdWN0aW9uIiwibm9uVW5pdFJ1bGVzUHJvZHVjdGlvblJ1bGVzIiwiZ2V0UnVsZXMiLCJhZGRlZE5vblVuaXRSdWxlc1Byb2R1Y3Rpb25OYW1lIiwiYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9uUnVsZXMiLCJhZGRlZE5vblVuaXRSdWxlc1Byb2R1Y3Rpb24iLCJyZW1vdmVkVW5pdFJ1bGVQcm9kdWN0aW9uTm9kZSIsImdldE5vZGUiLCJhZGRlZE5vblVuaXRSdWxlc1Byb2R1Y3Rpb25Ob2RlIiwiY29uY2F0UnVsZXMiLCJ1bml0UnVsZVByb2R1Y3Rpb25OYW1lIiwidW5pdFJ1bGVQcm9kdWN0aW9uIiwidW5pdFJ1bGVQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSIsImZpbmRVbml0UnVsZVByb2R1Y3Rpb24iLCJmcm9tTmFtZUFuZFVuaXRSdWxlUHJvZHVjdGlvbk5hbWUiLCJ1bnNoaWZ0IiwibWFwVmVydGljZXMiLCJ2ZXJ0ZXgiLCJuYW1lIiwidW5pdFJ1bGVzUHJvZHVjdGlvblVuaXRSdWxlUHJvZHVjdGlvbnMiLCJtYXBVbml0UnVsZXMiLCJ1bml0UnVsZSIsInVuaXRSdWxlc1Byb2R1Y3Rpb25Vbml0UnVsZVByb2R1Y3Rpb24iLCJmcm9tTmFtZUFuZFVuaXRSdWxlIiwibm9uVW5pdFByb2R1Y3Rpb25zIiwibWFwIiwibm9uVW5pdFByb2R1Y3Rpb24iLCJmaXJzdFByb2R1Y3Rpb25OYW1lIiwic2Vjb25kUHJvZHVjdGlvbk5hbWUiLCJmb3VuZFVuaXRSdWxlUHJvZHVjdGlvbiIsInNvbWUiLCJ1bml0UnVsZVByb2R1Y3Rpb25Gb3VuZCIsImlzRm91bmRCeVByb2R1Y3Rpb25OYW1lcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLFFBQVFDLFFBQVEsU0FBUixDQUFkO0FBQUEs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QyxxQ0FBUDtBQUNELEtBSndDLENBRi9DOztBQVFBcEMsMEJBQXNCQSxvQkFBb0I5QixNQUFwQixDQUEyQitELHNDQUEzQixDQUF0Qjs7QUFFQSxXQUFPakMsbUJBQVA7QUFDRCxHQVoyQixFQVl6QixFQVp5QixDQUE1Qjs7QUFjQSxTQUFPQSxtQkFBUDtBQUNEOztBQUVELFNBQVNHLHNDQUFULENBQWdENUQsV0FBaEQsRUFBNkQ7QUFDM0QsTUFBTStGLHFCQUFxQi9GLFlBQVlnRyxHQUFaLENBQWdCLFVBQVN0RixVQUFULEVBQXFCO0FBQzlELFFBQU11RixvQkFBb0J0Ryx1QkFBdUI2QixjQUF2QixDQUFzQ2QsVUFBdEMsQ0FBMUI7O0FBRUEsV0FBT3VGLGlCQUFQO0FBQ0QsR0FKMEIsQ0FBM0I7O0FBTUEsU0FBT0Ysa0JBQVA7QUFDRDs7QUFFRCxTQUFTWCxzQkFBVCxDQUFnQ3BELGNBQWhDLEVBQWdEaUQsc0JBQWhELEVBQXdFeEIsbUJBQXhFLEVBQTZGO0FBQzNGLE1BQU15QyxzQkFBc0JsRSxjQUE1QjtBQUFBLE1BQTRDO0FBQ3RDbUUseUJBQXVCbEIsc0JBRDdCLENBRDJGLENBRXJDOztBQUV0RCxNQUFJbUIsMEJBQTBCLElBQTlCOztBQUVBM0Msc0JBQW9CNEMsSUFBcEIsQ0FBeUIsVUFBU25CLGtCQUFULEVBQTZCO0FBQ3BELFFBQU1vQiwwQkFBMEJwQixtQkFBbUJxQix3QkFBbkIsQ0FBNENMLG1CQUE1QyxFQUFpRUMsb0JBQWpFLENBQWhDOztBQUVBLFFBQUlHLHVCQUFKLEVBQTZCO0FBQzNCRixnQ0FBMEJsQixrQkFBMUI7O0FBRUEsYUFBTyxJQUFQO0FBQ0Q7QUFDRixHQVJEOztBQVVBLE1BQU1BLHFCQUFxQmtCLHVCQUEzQixDQWhCMkYsQ0FnQnZDOztBQUVwRCxTQUFPbEIsa0JBQVA7QUFDRCIsImZpbGUiOiJ1dGlsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBHcmFwaCA9IHJlcXVpcmUoJy4vZ3JhcGgnKSxcbiAgICAgIHBhcnNlclV0aWwgPSByZXF1aXJlKCcuLi91dGlsL3BhcnNlcicpLFxuICAgICAgUHJvZHVjdGlvbiA9IHJlcXVpcmUoJy4uL2NvbW1vbi9wcm9kdWN0aW9uJyksXG4gICAgICBVbml0UnVsZVByb2R1Y3Rpb24gPSByZXF1aXJlKCcuL3Byb2R1Y3Rpb24vdW5pdFJ1bGUnKSxcbiAgICAgIFVuaXRSdWxlc1Byb2R1Y3Rpb24gPSByZXF1aXJlKCcuL3Byb2R1Y3Rpb24vdW5pdFJ1bGVzJyksXG4gICAgICBOb25Vbml0UnVsZXNQcm9kdWN0aW9uID0gcmVxdWlyZSgnLi9wcm9kdWN0aW9uL25vblVuaXRSdWxlcycpLFxuICAgICAgUmlnaHRSZWN1cnNpdmVQcm9kdWN0aW9uID0gcmVxdWlyZSgnLi9wcm9kdWN0aW9uL3JpZ2h0UmVjdXJzaXZlJyksXG4gICAgICBOb25MZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiA9IHJlcXVpcmUoJy4vcHJvZHVjdGlvbi9ub25MZWZ0UmVjdXJzaXZlJyksXG4gICAgICBOb25JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24gPSByZXF1aXJlKCcuL3Byb2R1Y3Rpb24vbm9uSW1wbGljaXRseUxlZnRSZWN1cnNpdmUnKTtcblxuY2xhc3MgZ3JhbW1hclV0aWwge1xuICBzdGF0aWMgZWxpbWluYXRlQ3ljbGVzKHByb2R1Y3Rpb25zKSB7XG4gICAgY29uc3QgdW5pdFJ1bGVzUHJvZHVjdGlvbnMgPSB1bml0UnVsZXNQcm9kdWN0aW9uc0Zyb21Qcm9kdWN0aW9ucyhwcm9kdWN0aW9ucyksXG4gICAgICAgICAgZ3JhcGggPSBncmFwaEZyb21Vbml0UnVsZXNQcm9kdWN0aW9ucyh1bml0UnVsZXNQcm9kdWN0aW9ucyksXG4gICAgICAgICAgbm9uQ3ljbGljUHJvZHVjdGlvbnMgPSBub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21HcmFwaChncmFwaCwgcHJvZHVjdGlvbnMpO1xuXG4gICAgcHJvZHVjdGlvbnMgPSBub25DeWNsaWNQcm9kdWN0aW9uczsgLy8vXG5cbiAgICByZXR1cm4gcHJvZHVjdGlvbnM7XG4gIH1cblxuICBzdGF0aWMgZWxpbWluYXRlTGVmdFJlY3Vyc2lvbihwcm9kdWN0aW9ucykge1xuICAgIGNvbnN0IG5vbkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9ucyA9IFtdLFxuICAgICAgICAgIHJpZ2h0UmVjdXJzaXZlUHJvZHVjdGlvbnMgPSBbXTtcblxuICAgIHByb2R1Y3Rpb25zLmZvckVhY2goZnVuY3Rpb24ocHJvZHVjdGlvbiwgaW5kZXgpIHtcbiAgICAgIGNvbnN0IGJlZ2luID0gMCxcbiAgICAgICAgICAgIGVuZCA9IGluZGV4LCAgLy8vXG4gICAgICAgICAgICBwcmV2aW91c05vbkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9ucyA9IG5vbkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9ucy5zbGljZShiZWdpbiwgZW5kKSxcbiAgICAgICAgICAgIHByZXZpb3VzUHJvZHVjdGlvbnMgPSBwcmV2aW91c05vbkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9ucywgIC8vL1xuICAgICAgICAgICAgcHJvZHVjdGlvbkltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlID0gcHJvZHVjdGlvbi5pc0ltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlKHByZXZpb3VzUHJvZHVjdGlvbnMpO1xuXG4gICAgICBpZiAocHJvZHVjdGlvbkltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlKSB7XG4gICAgICAgIGNvbnN0IG5vbkltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiA9IE5vbkltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbi5mcm9tUHJvZHVjdGlvbkFuZFByZXZpb3VzUHJvZHVjdGlvbnMocHJvZHVjdGlvbiwgcHJldmlvdXNQcm9kdWN0aW9ucyk7XG5cbiAgICAgICAgcHJvZHVjdGlvbiA9IG5vbkltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbjsgIC8vL1xuICAgICAgfVxuXG4gICAgICBjb25zdCBwcm9kdWN0aW9uTGVmdFJlY3Vyc2l2ZSA9IHByb2R1Y3Rpb24uaXNMZWZ0UmVjdXJzaXZlKCk7XG5cbiAgICAgIGlmIChwcm9kdWN0aW9uTGVmdFJlY3Vyc2l2ZSkge1xuICAgICAgICBjb25zdCBub25MZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiA9IE5vbkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uLmZyb21Qcm9kdWN0aW9uKHByb2R1Y3Rpb24pLFxuICAgICAgICAgICAgICByaWdodFJlY3Vyc2l2ZVByb2R1Y3Rpb24gPSBSaWdodFJlY3Vyc2l2ZVByb2R1Y3Rpb24uZnJvbVByb2R1Y3Rpb24ocHJvZHVjdGlvbik7XG5cbiAgICAgICAgbm9uTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb25zLnB1c2gobm9uTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24pO1xuXG4gICAgICAgIHJpZ2h0UmVjdXJzaXZlUHJvZHVjdGlvbnMucHVzaChyaWdodFJlY3Vyc2l2ZVByb2R1Y3Rpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3Qgbm9uTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24gPSBwcm9kdWN0aW9uOyAgLy8vXG5cbiAgICAgICAgbm9uTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb25zLnB1c2gobm9uTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcHJvZHVjdGlvbnMgPSBbXS5jb25jYXQobm9uTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb25zKS5jb25jYXQocmlnaHRSZWN1cnNpdmVQcm9kdWN0aW9ucyk7XG5cbiAgICByZXR1cm4gcHJvZHVjdGlvbnM7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBncmFtbWFyVXRpbDtcblxuZnVuY3Rpb24gdW5pdFJ1bGVzUHJvZHVjdGlvbnNGcm9tUHJvZHVjdGlvbnMocHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgdW5pdFJ1bGVzUHJvZHVjdGlvbnMgPSBwcm9kdWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24odW5pdFJ1bGVzUHJvZHVjdGlvbnMsIHByb2R1Y3Rpb24pIHtcbiAgICBjb25zdCB1bml0UnVsZXNQcm9kdWN0aW9uID0gVW5pdFJ1bGVzUHJvZHVjdGlvbi5mcm9tUHJvZHVjdGlvbihwcm9kdWN0aW9uKTtcblxuICAgIGlmICh1bml0UnVsZXNQcm9kdWN0aW9uICE9PSBudWxsKSB7XG4gICAgICB1bml0UnVsZXNQcm9kdWN0aW9ucy5wdXNoKHVuaXRSdWxlc1Byb2R1Y3Rpb24pO1xuICAgIH1cblxuICAgIHJldHVybiB1bml0UnVsZXNQcm9kdWN0aW9ucztcbiAgfSwgW10pO1xuXG4gIHJldHVybiB1bml0UnVsZXNQcm9kdWN0aW9ucztcbn1cblxuZnVuY3Rpb24gZ3JhcGhGcm9tVW5pdFJ1bGVzUHJvZHVjdGlvbnModW5pdFJ1bGVzUHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgZ3JhcGggPSBuZXcgR3JhcGgoKTtcblxuICB1bml0UnVsZXNQcm9kdWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHVuaXRSdWxlc1Byb2R1Y3Rpb24pIHtcbiAgICBjb25zdCBwcm9kdWN0aW9uTmFtZSA9IHVuaXRSdWxlc1Byb2R1Y3Rpb24uZ2V0TmFtZSgpLFxuICAgICAgICAgIHByb2R1Y3Rpb25OYW1lcyA9IHVuaXRSdWxlc1Byb2R1Y3Rpb24uZ2V0UHJvZHVjdGlvbk5hbWVzKCksXG4gICAgICAgICAgdmVydGV4TmFtZSA9IHByb2R1Y3Rpb25OYW1lLCAgLy8vXG4gICAgICAgICAgZGVzY2VuZGFudFZlcnRleE5hbWVzID0gcHJvZHVjdGlvbk5hbWVzOyAvLy9cblxuICAgIGdyYXBoLmFkZFZlcnRleCh2ZXJ0ZXhOYW1lLCBkZXNjZW5kYW50VmVydGV4TmFtZXMpO1xuICB9KTtcblxuICByZXR1cm4gZ3JhcGg7XG59XG5cbmZ1bmN0aW9uIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zRnJvbUdyYXBoKGdyYXBoLCBwcm9kdWN0aW9ucykge1xuICBjb25zdCBjb21wb25lbnRzID0gZ3JhcGguZ2V0Q29tcG9uZW50cygpLFxuICAgICAgICBub25DeWNsaWNQcm9kdWN0aW9ucyA9IGNvbXBvbmVudHMucmVkdWNlKGZ1bmN0aW9uKG5vbkN5Y2xpY1Byb2R1Y3Rpb25zLCBjb21wb25lbnQpIHtcbiAgICAgICAgICBjb25zdCBjb21wb25lbnROb25DeWNsaWMgPSBjb21wb25lbnQuaXNOb25DeWNsaWMoKTtcblxuICAgICAgICAgIGlmIChjb21wb25lbnROb25DeWNsaWMpIHtcbiAgICAgICAgICAgIGNvbnN0IG5vbkN5Y2xpY0NvbXBvbmVudCA9IGNvbXBvbmVudCwgLy8vXG4gICAgICAgICAgICAgICAgICBub25DeWNsaWNDb21wb25lbnROb25DeWNsaWNQcm9kdWN0aW9uID0gbm9uQ3ljbGljUHJvZHVjdGlvbkZyb21Ob25DeWNsaWNDb21wb25lbnQobm9uQ3ljbGljQ29tcG9uZW50LCBwcm9kdWN0aW9ucyk7XG5cbiAgICAgICAgICAgIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zLnB1c2gobm9uQ3ljbGljQ29tcG9uZW50Tm9uQ3ljbGljUHJvZHVjdGlvbik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGN5Y2xpY0NvbXBvbmVudCA9IGNvbXBvbmVudCwgIC8vL1xuICAgICAgICAgICAgICAgICAgY3ljbGljQ29tcG9uZW50Tm9uQ3ljbGljUHJvZHVjdGlvbnMgPSBub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21DeWNsaWNDb21wb25lbnQoY3ljbGljQ29tcG9uZW50LCBwcm9kdWN0aW9ucyk7XG5cbiAgICAgICAgICAgIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zID0gbm9uQ3ljbGljUHJvZHVjdGlvbnMuY29uY2F0KGN5Y2xpY0NvbXBvbmVudE5vbkN5Y2xpY1Byb2R1Y3Rpb25zKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gbm9uQ3ljbGljUHJvZHVjdGlvbnM7XG4gICAgICAgIH0sIFtdKTtcblxuICByZXR1cm4gbm9uQ3ljbGljUHJvZHVjdGlvbnM7XG59XG5cbmZ1bmN0aW9uIG5vbkN5Y2xpY1Byb2R1Y3Rpb25Gcm9tTm9uQ3ljbGljQ29tcG9uZW50KG5vbkN5Y2xpY0NvbXBvbmVudCwgcHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgZmlyc3RWZXJ0ZXggPSBub25DeWNsaWNDb21wb25lbnQuZ2V0Rmlyc3RWZXJ0ZXgoKSxcbiAgICAgICAgZmlyc3RWZXJ0ZXhOYW1lID0gZmlyc3RWZXJ0ZXguZ2V0TmFtZSgpLFxuICAgICAgICBub25DeWNsaWNQcm9kdWN0aW9uTmFtZSA9IGZpcnN0VmVydGV4TmFtZSwgIC8vL1xuICAgICAgICBub25DeWNsaWNQcm9kdWN0aW9uID0gcGFyc2VyVXRpbC5maW5kUHJvZHVjdGlvbihub25DeWNsaWNQcm9kdWN0aW9uTmFtZSwgcHJvZHVjdGlvbnMpO1xuXG4gIHJldHVybiBub25DeWNsaWNQcm9kdWN0aW9uO1xufVxuXG5mdW5jdGlvbiBub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21DeWNsaWNDb21wb25lbnQoY3ljbGljQ29tcG9uZW50LCBwcm9kdWN0aW9ucykge1xuICBwcm9kdWN0aW9ucyA9IHByb2R1Y3Rpb25zRnJvbUN5Y2xpY0NvbXBvbmVudChjeWNsaWNDb21wb25lbnQsIHByb2R1Y3Rpb25zKTsgLy8vXG5cbiAgY29uc3QgdW5pdFJ1bGVQcm9kdWN0aW9ucyA9IHVuaXRSdWxlUHJvZHVjdGlvbnNGcm9tUHJvZHVjdGlvbnMocHJvZHVjdGlvbnMpLFxuICAgICAgICBub25Vbml0UnVsZXNQcm9kdWN0aW9ucyA9IG5vblVuaXRSdWxlc1Byb2R1Y3Rpb25zRnJvbVByb2R1Y3Rpb25zKHByb2R1Y3Rpb25zKSxcbiAgICAgICAgcmVtb3ZlZFVuaXRSdWxlUHJvZHVjdGlvbnMgPSBbXSxcbiAgICAgICAgYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9ucyA9IFtdO1xuXG4gIGxldCB1bml0UnVsZVByb2R1Y3Rpb25zTGVuZ3RoID0gdW5pdFJ1bGVQcm9kdWN0aW9ucy5sZW5ndGg7XG5cbiAgd2hpbGUgKHVuaXRSdWxlUHJvZHVjdGlvbnNMZW5ndGggPiAwKSB7XG4gICAgY29uc3QgcmVtb3ZlZFVuaXRSdWxlUHJvZHVjdGlvbiA9IHVuaXRSdWxlUHJvZHVjdGlvbnMuc2hpZnQoKTtcblxuICAgIHJlbW92ZWRVbml0UnVsZVByb2R1Y3Rpb25zLnB1c2gocmVtb3ZlZFVuaXRSdWxlUHJvZHVjdGlvbik7XG5cbiAgICBjb25zdCByZW1vdmVkVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSA9IHJlbW92ZWRVbml0UnVsZVByb2R1Y3Rpb24uZ2V0TmFtZSgpLFxuICAgICAgICAgIHJlbW92ZWRVbml0UnVsZVByb2R1Y3Rpb25Vbml0UnVsZVByb2R1Y3Rpb25OYW1lID0gcmVtb3ZlZFVuaXRSdWxlUHJvZHVjdGlvbi5nZXRVbml0UnVsZVByb2R1Y3Rpb25OYW1lKCksXG4gICAgICAgICAgbm9uVW5pdFJ1bGVzUHJvZHVjdGlvbk5hbWUgPSByZW1vdmVkVW5pdFJ1bGVQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgIC8vL1xuICAgICAgICAgIG5vblVuaXRSdWxlc1Byb2R1Y3Rpb24gPSBwYXJzZXJVdGlsLmZpbmRQcm9kdWN0aW9uKG5vblVuaXRSdWxlc1Byb2R1Y3Rpb25OYW1lLCBub25Vbml0UnVsZXNQcm9kdWN0aW9ucyksXG4gICAgICAgICAgbm9uVW5pdFJ1bGVzUHJvZHVjdGlvblJ1bGVzID0gbm9uVW5pdFJ1bGVzUHJvZHVjdGlvbi5nZXRSdWxlcygpLFxuICAgICAgICAgIGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbk5hbWUgPSByZW1vdmVkVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgIC8vL1xuICAgICAgICAgIGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvblJ1bGVzID0gbm9uVW5pdFJ1bGVzUHJvZHVjdGlvblJ1bGVzOyAvLy9cblxuICAgIGxldCBhZGRlZE5vblVuaXRSdWxlc1Byb2R1Y3Rpb24gPSBwYXJzZXJVdGlsLmZpbmRQcm9kdWN0aW9uKGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbk5hbWUsIGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbnMpO1xuXG4gICAgaWYgKGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbiA9PT0gbnVsbCkge1xuICAgICAgY29uc3QgcmVtb3ZlZFVuaXRSdWxlUHJvZHVjdGlvbk5vZGUgPSByZW1vdmVkVW5pdFJ1bGVQcm9kdWN0aW9uLmdldE5vZGUoKSxcbiAgICAgICAgICAgIGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbk5vZGUgPSByZW1vdmVkVW5pdFJ1bGVQcm9kdWN0aW9uTm9kZTtcblxuICAgICAgYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9uID0gbmV3IFByb2R1Y3Rpb24oYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9uTmFtZSwgYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9uUnVsZXMsIGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbk5vZGUpO1xuXG4gICAgICBhZGRlZE5vblVuaXRSdWxlc1Byb2R1Y3Rpb25zLnB1c2goYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9uLmNvbmNhdFJ1bGVzKG5vblVuaXRSdWxlc1Byb2R1Y3Rpb25SdWxlcyk7XG4gICAgfVxuXG4gICAgbGV0IHVuaXRSdWxlUHJvZHVjdGlvbk5hbWUgPSByZW1vdmVkVW5pdFJ1bGVQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgLy8vXG4gICAgICAgIHVuaXRSdWxlUHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24odW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgdW5pdFJ1bGVQcm9kdWN0aW9ucyk7XG5cbiAgICBpZiAodW5pdFJ1bGVQcm9kdWN0aW9uICE9PSBudWxsKSB7XG4gICAgICBjb25zdCB1bml0UnVsZVByb2R1Y3Rpb25Vbml0UnVsZVByb2R1Y3Rpb25OYW1lID0gdW5pdFJ1bGVQcm9kdWN0aW9uLmdldFVuaXRSdWxlUHJvZHVjdGlvbk5hbWUoKTtcblxuICAgICAgdW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSA9IHJlbW92ZWRVbml0UnVsZVByb2R1Y3Rpb25OYW1lOyAvLy9cblxuICAgICAgaWYgKHVuaXRSdWxlUHJvZHVjdGlvbk5hbWUgIT09IHVuaXRSdWxlUHJvZHVjdGlvblVuaXRSdWxlUHJvZHVjdGlvbk5hbWUpIHtcbiAgICAgICAgdW5pdFJ1bGVQcm9kdWN0aW9uID0gZmluZFVuaXRSdWxlUHJvZHVjdGlvbih1bml0UnVsZVByb2R1Y3Rpb25OYW1lLCB1bml0UnVsZVByb2R1Y3Rpb25Vbml0UnVsZVByb2R1Y3Rpb25OYW1lLCByZW1vdmVkVW5pdFJ1bGVQcm9kdWN0aW9ucyk7XG5cbiAgICAgICAgaWYgKHVuaXRSdWxlUHJvZHVjdGlvbiA9PT0gbnVsbCkge1xuICAgICAgICAgIHVuaXRSdWxlUHJvZHVjdGlvbiA9IFVuaXRSdWxlUHJvZHVjdGlvbi5mcm9tTmFtZUFuZFVuaXRSdWxlUHJvZHVjdGlvbk5hbWUodW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgdW5pdFJ1bGVQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSk7XG5cbiAgICAgICAgICB1bml0UnVsZVByb2R1Y3Rpb25zLnVuc2hpZnQodW5pdFJ1bGVQcm9kdWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHVuaXRSdWxlUHJvZHVjdGlvbnNMZW5ndGggPSB1bml0UnVsZVByb2R1Y3Rpb25zLmxlbmd0aDtcbiAgfVxuXG4gIG5vblVuaXRSdWxlc1Byb2R1Y3Rpb25zLmZvckVhY2goZnVuY3Rpb24obm9uVW5pdFJ1bGVzUHJvZHVjdGlvbikge1xuICAgIGNvbnN0IG5vblVuaXRSdWxlc1Byb2R1Y3Rpb25OYW1lID0gbm9uVW5pdFJ1bGVzUHJvZHVjdGlvbi5nZXROYW1lKCksXG4gICAgICAgICAgYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9uTmFtZSA9IG5vblVuaXRSdWxlc1Byb2R1Y3Rpb25OYW1lLFxuICAgICAgICAgIGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24oYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9uTmFtZSwgYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9ucyk7XG5cbiAgICBpZiAoYWRkZWROb25Vbml0UnVsZXNQcm9kdWN0aW9uICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBhZGRlZE5vblVuaXRSdWxlc1Byb2R1Y3Rpb25SdWxlcyA9IGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbi5nZXRSdWxlcygpO1xuXG4gICAgICBub25Vbml0UnVsZXNQcm9kdWN0aW9uLmNvbmNhdFJ1bGVzKGFkZGVkTm9uVW5pdFJ1bGVzUHJvZHVjdGlvblJ1bGVzKTtcbiAgICB9XG4gIH0pO1xuXG4gIHByb2R1Y3Rpb25zID0gbm9uVW5pdFJ1bGVzUHJvZHVjdGlvbnM7ICAvLy9cblxuICByZXR1cm4gcHJvZHVjdGlvbnM7XG59XG5cbmZ1bmN0aW9uIHByb2R1Y3Rpb25zRnJvbUN5Y2xpY0NvbXBvbmVudChjeWNsaWNDb21wb25lbnQsIHByb2R1Y3Rpb25zKSB7XG4gIHByb2R1Y3Rpb25zID0gY3ljbGljQ29tcG9uZW50Lm1hcFZlcnRpY2VzKGZ1bmN0aW9uKHZlcnRleCkge1xuICAgIGNvbnN0IHZlcnRleE5hbWUgPSB2ZXJ0ZXguZ2V0TmFtZSgpLFxuICAgICAgICAgIHByb2R1Y3Rpb25OYW1lID0gdmVydGV4TmFtZSwgIC8vL1xuICAgICAgICAgIHByb2R1Y3Rpb24gPSBwYXJzZXJVdGlsLmZpbmRQcm9kdWN0aW9uKHByb2R1Y3Rpb25OYW1lLCBwcm9kdWN0aW9ucyk7XG5cbiAgICByZXR1cm4gcHJvZHVjdGlvbjtcbiAgfSk7XG5cbiAgcmV0dXJuIHByb2R1Y3Rpb25zO1xufVxuXG5mdW5jdGlvbiB1bml0UnVsZVByb2R1Y3Rpb25zRnJvbVByb2R1Y3Rpb25zKHByb2R1Y3Rpb25zKSB7XG4gIGNvbnN0IHVuaXRSdWxlUHJvZHVjdGlvbnMgPSBwcm9kdWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24odW5pdFJ1bGVQcm9kdWN0aW9ucywgcHJvZHVjdGlvbikge1xuICAgIGNvbnN0IG5hbWUgPSBwcm9kdWN0aW9uLmdldE5hbWUoKSxcbiAgICAgICAgICB1bml0UnVsZXNQcm9kdWN0aW9uID0gVW5pdFJ1bGVzUHJvZHVjdGlvbi5mcm9tUHJvZHVjdGlvbihwcm9kdWN0aW9uKSxcbiAgICAgICAgICB1bml0UnVsZXNQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9ucyA9IHVuaXRSdWxlc1Byb2R1Y3Rpb24ubWFwVW5pdFJ1bGVzKGZ1bmN0aW9uKHVuaXRSdWxlKSB7XG4gICAgICAgICAgICBjb25zdCB1bml0UnVsZXNQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9uID0gVW5pdFJ1bGVQcm9kdWN0aW9uLmZyb21OYW1lQW5kVW5pdFJ1bGUobmFtZSwgdW5pdFJ1bGUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gdW5pdFJ1bGVzUHJvZHVjdGlvblVuaXRSdWxlUHJvZHVjdGlvbjtcbiAgICAgICAgICB9KTtcblxuICAgIHVuaXRSdWxlUHJvZHVjdGlvbnMgPSB1bml0UnVsZVByb2R1Y3Rpb25zLmNvbmNhdCh1bml0UnVsZXNQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9ucyk7XG5cbiAgICByZXR1cm4gdW5pdFJ1bGVQcm9kdWN0aW9ucztcbiAgfSwgW10pO1xuXG4gIHJldHVybiB1bml0UnVsZVByb2R1Y3Rpb25zO1xufVxuXG5mdW5jdGlvbiBub25Vbml0UnVsZXNQcm9kdWN0aW9uc0Zyb21Qcm9kdWN0aW9ucyhwcm9kdWN0aW9ucykge1xuICBjb25zdCBub25Vbml0UHJvZHVjdGlvbnMgPSBwcm9kdWN0aW9ucy5tYXAoZnVuY3Rpb24ocHJvZHVjdGlvbikge1xuICAgIGNvbnN0IG5vblVuaXRQcm9kdWN0aW9uID0gTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbi5mcm9tUHJvZHVjdGlvbihwcm9kdWN0aW9uKTtcbiAgICBcbiAgICByZXR1cm4gbm9uVW5pdFByb2R1Y3Rpb247XG4gIH0pO1xuICBcbiAgcmV0dXJuIG5vblVuaXRQcm9kdWN0aW9ucztcbn1cblxuZnVuY3Rpb24gZmluZFVuaXRSdWxlUHJvZHVjdGlvbihwcm9kdWN0aW9uTmFtZSwgdW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgdW5pdFJ1bGVQcm9kdWN0aW9ucykge1xuICBjb25zdCBmaXJzdFByb2R1Y3Rpb25OYW1lID0gcHJvZHVjdGlvbk5hbWUsIC8vL1xuICAgICAgICBzZWNvbmRQcm9kdWN0aW9uTmFtZSA9IHVuaXRSdWxlUHJvZHVjdGlvbk5hbWU7ICAvLy9cblxuICBsZXQgZm91bmRVbml0UnVsZVByb2R1Y3Rpb24gPSBudWxsO1xuXG4gIHVuaXRSdWxlUHJvZHVjdGlvbnMuc29tZShmdW5jdGlvbih1bml0UnVsZVByb2R1Y3Rpb24pIHtcbiAgICBjb25zdCB1bml0UnVsZVByb2R1Y3Rpb25Gb3VuZCA9IHVuaXRSdWxlUHJvZHVjdGlvbi5pc0ZvdW5kQnlQcm9kdWN0aW9uTmFtZXMoZmlyc3RQcm9kdWN0aW9uTmFtZSwgc2Vjb25kUHJvZHVjdGlvbk5hbWUpO1xuXG4gICAgaWYgKHVuaXRSdWxlUHJvZHVjdGlvbkZvdW5kKSB7XG4gICAgICBmb3VuZFVuaXRSdWxlUHJvZHVjdGlvbiA9IHVuaXRSdWxlUHJvZHVjdGlvbjtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCB1bml0UnVsZVByb2R1Y3Rpb24gPSBmb3VuZFVuaXRSdWxlUHJvZHVjdGlvbjsgLy8vXG5cbiAgcmV0dXJuIHVuaXRSdWxlUHJvZHVjdGlvbjtcbn0iXX0=