'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var parserUtil = require('../../util/parser'),
    Production = require('../../common/production'),
    LeftRecursiveRule = require('../rule/leftRecursive'),
    ImplicitlyLeftRecursiveRule = require('../rule/implicitlyLeftRecursive');

var LeftRecursiveProduction = function (_Production) {
  _inherits(LeftRecursiveProduction, _Production);

  function LeftRecursiveProduction() {
    _classCallCheck(this, LeftRecursiveProduction);

    return _possibleConstructorReturn(this, (LeftRecursiveProduction.__proto__ || Object.getPrototypeOf(LeftRecursiveProduction)).apply(this, arguments));
  }

  _createClass(LeftRecursiveProduction, [{
    key: 'getLeftRecursiveRules',
    value: function getLeftRecursiveRules() {
      var name = this.getName(),
          rules = this.getRules(),
          productionName = name,
          ///
      leftRecursiveRules = rules.filter(function (rule) {
        var leftRecursiveRule = LeftRecursiveRule.fromRuleAndProductionName(rule, productionName),
            ruleLeftRecursive = leftRecursiveRule !== null;

        return ruleLeftRecursive;
      });

      return leftRecursiveRules;
    }
  }, {
    key: 'getNonLeftRecursiveRules',
    value: function getNonLeftRecursiveRules() {
      var name = this.getName(),
          rules = this.getRules(),
          productionName = name,
          ///
      nonLeftRecursiveRules = rules.filter(function (rule) {
        var leftRecursiveRule = LeftRecursiveRule.fromRuleAndProductionName(rule, productionName),
            ruleNonLeftRecursive = leftRecursiveRule === null;

        return ruleNonLeftRecursive;
      });

      return nonLeftRecursiveRules;
    }
  }], [{
    key: 'fromProduction',
    value: function fromProduction(production) {
      var leftRecursiveProduction = null;

      var productionName = production.getName(),
          productionRules = production.getRules(),
          someProductionRuleLeftRecursive = productionRules.some(function (productionRule) {
        var rule = productionRule,
            ///
        leftRecursiveRule = LeftRecursiveRule.fromRuleAndProductionName(rule, productionName),
            productionRuleLeftRecursive = leftRecursiveRule !== null;

        return productionRuleLeftRecursive;
      });

      if (someProductionRuleLeftRecursive) {
        leftRecursiveProduction = Production.fromProduction(production, LeftRecursiveProduction);
      }

      return leftRecursiveProduction;
    }
  }, {
    key: 'fromImplicitlyLeftRecursiveProductionAndPreviousProductions',
    value: function fromImplicitlyLeftRecursiveProductionAndPreviousProductions(implicitlyLeftRecursiveProduction, previousProductions) {
      var name = implicitlyLeftRecursiveProduction.getName(),
          rules = rulesFromImplicitlyLeftRecursiveProductionAndPreviousProductions(implicitlyLeftRecursiveProduction, previousProductions),
          Node = implicitlyLeftRecursiveProduction.getNode(),
          leftRecursiveProduction = new LeftRecursiveProduction(name, rules, Node);

      return leftRecursiveProduction;
    }
  }]);

  return LeftRecursiveProduction;
}(Production);

module.exports = LeftRecursiveProduction;

function rulesFromImplicitlyLeftRecursiveProductionAndPreviousProductions(implicitlyLeftRecursiveProduction, previousProductions) {
  var rules = [];

  var implicitlyLeftRecursiveProductionRules = implicitlyLeftRecursiveProduction.getRules();

  implicitlyLeftRecursiveProductionRules.forEach(function (implicitlyLeftRecursiveProductionRule) {
    var rule = implicitlyLeftRecursiveProductionRule; ///

    var implicitlyLeftRecursiveRule = ImplicitlyLeftRecursiveRule.fromRuleAndPreviousProductions(rule, previousProductions);

    if (implicitlyLeftRecursiveRule === null) {
      rules.push(rule);
    } else {
      var leftRecursiveRules = leftRecursiveRulesFromImplicitlyLeftRecursiveRuleAndPreviousProductions(implicitlyLeftRecursiveRule, previousProductions);

      rules = rules.concat(leftRecursiveRules);
    }
  });

  return rules;
}

function leftRecursiveRulesFromImplicitlyLeftRecursiveRuleAndPreviousProductions(implicitlyLeftRecursiveRule, previousProductions) {
  var previousProductionName = implicitlyLeftRecursiveRule.getPreviousProductionName(),
      previousProduction = parserUtil.findProduction(previousProductionName, previousProductions),
      previousProductionRules = previousProduction.getRules(),
      implicitlyLeftRecursiveRuleAllButFirstParts = implicitlyLeftRecursiveRule.getAllButFirstParts(),
      leftRecursiveRules = previousProductionRules.map(function (previousProductionRule) {
    var previousProductionRuleParts = previousProductionRule.getParts(),
        leftRecursiveRuleParts = [].concat(previousProductionRuleParts).concat(implicitlyLeftRecursiveRuleAllButFirstParts),
        leftRecursiveRule = new LeftRecursiveRule(leftRecursiveRuleParts);

    return leftRecursiveRule;
  });

  return leftRecursiveRules;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9ncmFtbWFyL3Byb2R1Y3Rpb24vbGVmdFJlY3Vyc2l2ZS5qcyJdLCJuYW1lcyI6WyJwYXJzZXJVdGlsIiwicmVxdWlyZSIsIlByb2R1Y3Rpb24iLCJMZWZ0UmVjdXJzaXZlUnVsZSIsIkltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZSIsIkxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uIiwibmFtZSIsImdldE5hbWUiLCJydWxlcyIsImdldFJ1bGVzIiwicHJvZHVjdGlvbk5hbWUiLCJsZWZ0UmVjdXJzaXZlUnVsZXMiLCJmaWx0ZXIiLCJydWxlIiwibGVmdFJlY3Vyc2l2ZVJ1bGUiLCJmcm9tUnVsZUFuZFByb2R1Y3Rpb25OYW1lIiwicnVsZUxlZnRSZWN1cnNpdmUiLCJub25MZWZ0UmVjdXJzaXZlUnVsZXMiLCJydWxlTm9uTGVmdFJlY3Vyc2l2ZSIsInByb2R1Y3Rpb24iLCJsZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiIsInByb2R1Y3Rpb25SdWxlcyIsInNvbWVQcm9kdWN0aW9uUnVsZUxlZnRSZWN1cnNpdmUiLCJzb21lIiwicHJvZHVjdGlvblJ1bGUiLCJwcm9kdWN0aW9uUnVsZUxlZnRSZWN1cnNpdmUiLCJmcm9tUHJvZHVjdGlvbiIsImltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiIsInByZXZpb3VzUHJvZHVjdGlvbnMiLCJydWxlc0Zyb21JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb25BbmRQcmV2aW91c1Byb2R1Y3Rpb25zIiwiTm9kZSIsImdldE5vZGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uUnVsZXMiLCJmb3JFYWNoIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uUnVsZSIsImltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZSIsImZyb21SdWxlQW5kUHJldmlvdXNQcm9kdWN0aW9ucyIsInB1c2giLCJsZWZ0UmVjdXJzaXZlUnVsZXNGcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlQW5kUHJldmlvdXNQcm9kdWN0aW9ucyIsImNvbmNhdCIsInByZXZpb3VzUHJvZHVjdGlvbk5hbWUiLCJnZXRQcmV2aW91c1Byb2R1Y3Rpb25OYW1lIiwicHJldmlvdXNQcm9kdWN0aW9uIiwiZmluZFByb2R1Y3Rpb24iLCJwcmV2aW91c1Byb2R1Y3Rpb25SdWxlcyIsImltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZUFsbEJ1dEZpcnN0UGFydHMiLCJnZXRBbGxCdXRGaXJzdFBhcnRzIiwibWFwIiwicHJldmlvdXNQcm9kdWN0aW9uUnVsZSIsInByZXZpb3VzUHJvZHVjdGlvblJ1bGVQYXJ0cyIsImdldFBhcnRzIiwibGVmdFJlY3Vyc2l2ZVJ1bGVQYXJ0cyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxhQUFhQyxRQUFRLG1CQUFSLENBQW5CO0FBQUEsSUFDTUMsYUFBYUQsUUFBUSx5QkFBUixDQURuQjtBQUFBLElBRU1FLG9CQUFvQkYsUUFBUSx1QkFBUixDQUYxQjtBQUFBLElBR01HLDhCQUE4QkgsUUFBUSxpQ0FBUixDQUhwQzs7SUFLTUksdUI7Ozs7Ozs7Ozs7OzRDQUNvQjtBQUN0QixVQUFNQyxPQUFPLEtBQUtDLE9BQUwsRUFBYjtBQUFBLFVBQ01DLFFBQVEsS0FBS0MsUUFBTCxFQURkO0FBQUEsVUFFTUMsaUJBQWlCSixJQUZ2QjtBQUFBLFVBRThCO0FBQ3hCSywyQkFBcUJILE1BQU1JLE1BQU4sQ0FBYSxVQUFTQyxJQUFULEVBQWU7QUFDL0MsWUFBTUMsb0JBQW9CWCxrQkFBa0JZLHlCQUFsQixDQUE0Q0YsSUFBNUMsRUFBa0RILGNBQWxELENBQTFCO0FBQUEsWUFDTU0sb0JBQXFCRixzQkFBc0IsSUFEakQ7O0FBR0EsZUFBT0UsaUJBQVA7QUFDRCxPQUxvQixDQUgzQjs7QUFVQSxhQUFPTCxrQkFBUDtBQUNEOzs7K0NBRTBCO0FBQ3pCLFVBQU1MLE9BQU8sS0FBS0MsT0FBTCxFQUFiO0FBQUEsVUFD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RUFBaUM7QUFDaEYsUUFBTUMsOEJBQThCRCx1QkFBdUJFLFFBQXZCLEVBQXBDO0FBQUEsUUFDTUMseUJBQXlCLEdBQUdaLE1BQUgsQ0FBVVUsMkJBQVYsRUFBdUNWLE1BQXZDLENBQThDTSwyQ0FBOUMsQ0FEL0I7QUFBQSxRQUVNakMsb0JBQW9CLElBQUlYLGlCQUFKLENBQXNCa0Qsc0JBQXRCLENBRjFCOztBQUlBLFdBQU92QyxpQkFBUDtBQUNELEdBTm9CLENBSjNCOztBQVlBLFNBQU9ILGtCQUFQO0FBQ0QiLCJmaWxlIjoibGVmdFJlY3Vyc2l2ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgcGFyc2VyVXRpbCA9IHJlcXVpcmUoJy4uLy4uL3V0aWwvcGFyc2VyJyksXG4gICAgICBQcm9kdWN0aW9uID0gcmVxdWlyZSgnLi4vLi4vY29tbW9uL3Byb2R1Y3Rpb24nKSxcbiAgICAgIExlZnRSZWN1cnNpdmVSdWxlID0gcmVxdWlyZSgnLi4vcnVsZS9sZWZ0UmVjdXJzaXZlJyksXG4gICAgICBJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUgPSByZXF1aXJlKCcuLi9ydWxlL2ltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlJyk7XG5cbmNsYXNzIExlZnRSZWN1cnNpdmVQcm9kdWN0aW9uIGV4dGVuZHMgUHJvZHVjdGlvbiB7XG4gIGdldExlZnRSZWN1cnNpdmVSdWxlcygpIHtcbiAgICBjb25zdCBuYW1lID0gdGhpcy5nZXROYW1lKCksXG4gICAgICAgICAgcnVsZXMgPSB0aGlzLmdldFJ1bGVzKCksXG4gICAgICAgICAgcHJvZHVjdGlvbk5hbWUgPSBuYW1lLCAgLy8vXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVzID0gcnVsZXMuZmlsdGVyKGZ1bmN0aW9uKHJ1bGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGxlZnRSZWN1cnNpdmVSdWxlID0gTGVmdFJlY3Vyc2l2ZVJ1bGUuZnJvbVJ1bGVBbmRQcm9kdWN0aW9uTmFtZShydWxlLCBwcm9kdWN0aW9uTmFtZSksXG4gICAgICAgICAgICAgICAgICBydWxlTGVmdFJlY3Vyc2l2ZSA9IChsZWZ0UmVjdXJzaXZlUnVsZSAhPT0gbnVsbCk7XG4gIFxuICAgICAgICAgICAgcmV0dXJuIHJ1bGVMZWZ0UmVjdXJzaXZlO1xuICAgICAgICAgIH0pO1xuXG4gICAgcmV0dXJuIGxlZnRSZWN1cnNpdmVSdWxlcztcbiAgfVxuXG4gIGdldE5vbkxlZnRSZWN1cnNpdmVSdWxlcygpIHtcbiAgICBjb25zdCBuYW1lID0gdGhpcy5nZXROYW1lKCksXG4gICAgICAgICAgcnVsZXMgPSB0aGlzLmdldFJ1bGVzKCksXG4gICAgICAgICAgcHJvZHVjdGlvbk5hbWUgPSBuYW1lLCAgLy8vXG4gICAgICAgICAgbm9uTGVmdFJlY3Vyc2l2ZVJ1bGVzID0gcnVsZXMuZmlsdGVyKGZ1bmN0aW9uKHJ1bGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGxlZnRSZWN1cnNpdmVSdWxlID0gTGVmdFJlY3Vyc2l2ZVJ1bGUuZnJvbVJ1bGVBbmRQcm9kdWN0aW9uTmFtZShydWxlLCBwcm9kdWN0aW9uTmFtZSksXG4gICAgICAgICAgICAgICAgICBydWxlTm9uTGVmdFJlY3Vyc2l2ZSA9IChsZWZ0UmVjdXJzaXZlUnVsZSA9PT0gbnVsbCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBydWxlTm9uTGVmdFJlY3Vyc2l2ZTtcbiAgICAgICAgICB9KTtcblxuICAgIHJldHVybiBub25MZWZ0UmVjdXJzaXZlUnVsZXM7XG4gIH1cblxuICBzdGF0aWMgZnJvbVByb2R1Y3Rpb24ocHJvZHVjdGlvbikge1xuICAgIGxldCBsZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiA9IG51bGw7XG4gICAgXG4gICAgY29uc3QgcHJvZHVjdGlvbk5hbWUgPSBwcm9kdWN0aW9uLmdldE5hbWUoKSxcbiAgICAgICAgICBwcm9kdWN0aW9uUnVsZXMgPSBwcm9kdWN0aW9uLmdldFJ1bGVzKCksXG4gICAgICAgICAgc29tZVByb2R1Y3Rpb25SdWxlTGVmdFJlY3Vyc2l2ZSA9IHByb2R1Y3Rpb25SdWxlcy5zb21lKGZ1bmN0aW9uKHByb2R1Y3Rpb25SdWxlKSB7XG4gICAgICAgICAgICBjb25zdCBydWxlID0gcHJvZHVjdGlvblJ1bGUsIC8vL1xuICAgICAgICAgICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGUgPSBMZWZ0UmVjdXJzaXZlUnVsZS5mcm9tUnVsZUFuZFByb2R1Y3Rpb25OYW1lKHJ1bGUsIHByb2R1Y3Rpb25OYW1lKSxcbiAgICAgICAgICAgICAgICAgIHByb2R1Y3Rpb25SdWxlTGVmdFJlY3Vyc2l2ZSA9IChsZWZ0UmVjdXJzaXZlUnVsZSAhPT0gbnVsbCk7XG5cbiAgICAgICAgICAgIHJldHVybiBwcm9kdWN0aW9uUnVsZUxlZnRSZWN1cnNpdmU7XG4gICAgICAgICAgfSk7XG5cbiAgICBpZiAoc29tZVByb2R1Y3Rpb25SdWxlTGVmdFJlY3Vyc2l2ZSkge1xuICAgICAgbGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24gPSBQcm9kdWN0aW9uLmZyb21Qcm9kdWN0aW9uKHByb2R1Y3Rpb24sIExlZnRSZWN1cnNpdmVQcm9kdWN0aW9uKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uO1xuICB9XG4gIFxuICBzdGF0aWMgZnJvbUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbkFuZFByZXZpb3VzUHJvZHVjdGlvbnMoaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uLCBwcmV2aW91c1Byb2R1Y3Rpb25zKSB7XG4gICAgY29uc3QgbmFtZSA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbi5nZXROYW1lKCksXG4gICAgICAgICAgcnVsZXMgPSBydWxlc0Zyb21JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb25BbmRQcmV2aW91c1Byb2R1Y3Rpb25zKGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiwgcHJldmlvdXNQcm9kdWN0aW9ucyksXG4gICAgICAgICAgTm9kZSA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbi5nZXROb2RlKCksXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24gPSBuZXcgTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24obmFtZSwgcnVsZXMsIE5vZGUpO1xuXG4gICAgcmV0dXJuIGxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb247XG5cbmZ1bmN0aW9uIHJ1bGVzRnJvbUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbkFuZFByZXZpb3VzUHJvZHVjdGlvbnMoaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uLCBwcmV2aW91c1Byb2R1Y3Rpb25zKSB7XG4gIGxldCBydWxlcyA9IFtdO1xuXG4gIGNvbnN0IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvblJ1bGVzID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uLmdldFJ1bGVzKCk7XG5cbiAgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uUnVsZXMuZm9yRWFjaChmdW5jdGlvbihpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb25SdWxlKSB7XG4gICAgbGV0IHJ1bGUgPSBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb25SdWxlOyAvLy9cblxuICAgIGNvbnN0IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZSA9IEltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZS5mcm9tUnVsZUFuZFByZXZpb3VzUHJvZHVjdGlvbnMocnVsZSwgcHJldmlvdXNQcm9kdWN0aW9ucyk7XG5cbiAgICBpZiAoaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlID09PSBudWxsKSB7XG4gICAgICBydWxlcy5wdXNoKHJ1bGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlUnVsZXMgPSBsZWZ0UmVjdXJzaXZlUnVsZXNGcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlQW5kUHJldmlvdXNQcm9kdWN0aW9ucyhpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIHByZXZpb3VzUHJvZHVjdGlvbnMpO1xuXG4gICAgICBydWxlcyA9IHJ1bGVzLmNvbmNhdChsZWZ0UmVjdXJzaXZlUnVsZXMpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHJ1bGVzO1xufVxuXG5mdW5jdGlvbiBsZWZ0UmVjdXJzaXZlUnVsZXNGcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlQW5kUHJldmlvdXNQcm9kdWN0aW9ucyhpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIHByZXZpb3VzUHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgcHJldmlvdXNQcm9kdWN0aW9uTmFtZSA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZS5nZXRQcmV2aW91c1Byb2R1Y3Rpb25OYW1lKCksXG4gICAgICAgIHByZXZpb3VzUHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24ocHJldmlvdXNQcm9kdWN0aW9uTmFtZSwgcHJldmlvdXNQcm9kdWN0aW9ucyksXG4gICAgICAgIHByZXZpb3VzUHJvZHVjdGlvblJ1bGVzID0gcHJldmlvdXNQcm9kdWN0aW9uLmdldFJ1bGVzKCksXG4gICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZUFsbEJ1dEZpcnN0UGFydHMgPSBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUuZ2V0QWxsQnV0Rmlyc3RQYXJ0cygpLFxuICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZXMgPSBwcmV2aW91c1Byb2R1Y3Rpb25SdWxlcy5tYXAoZnVuY3Rpb24ocHJldmlvdXNQcm9kdWN0aW9uUnVsZSkge1xuICAgICAgICAgIGNvbnN0IHByZXZpb3VzUHJvZHVjdGlvblJ1bGVQYXJ0cyA9IHByZXZpb3VzUHJvZHVjdGlvblJ1bGUuZ2V0UGFydHMoKSxcbiAgICAgICAgICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZVBhcnRzID0gW10uY29uY2F0KHByZXZpb3VzUHJvZHVjdGlvblJ1bGVQYXJ0cykuY29uY2F0KGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZUFsbEJ1dEZpcnN0UGFydHMpLFxuICAgICAgICAgICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlID0gbmV3IExlZnRSZWN1cnNpdmVSdWxlKGxlZnRSZWN1cnNpdmVSdWxlUGFydHMpO1xuXG4gICAgICAgICAgcmV0dXJuIGxlZnRSZWN1cnNpdmVSdWxlO1xuICAgICAgICB9KTtcblxuICByZXR1cm4gbGVmdFJlY3Vyc2l2ZVJ1bGVzO1xufVxuIl19