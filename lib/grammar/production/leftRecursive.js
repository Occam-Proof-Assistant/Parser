'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Production = require('../../extendedBNF/production'),
    LeftRecursiveDefinition = require('../definition/leftRecursive'),
    ImplicitlyLeftRecursiveDefinition = require('../definition/implicitlyLeftRecursive');

var LeftRecursiveProduction = function (_Production) {
  _inherits(LeftRecursiveProduction, _Production);

  function LeftRecursiveProduction() {
    _classCallCheck(this, LeftRecursiveProduction);

    return _possibleConstructorReturn(this, (LeftRecursiveProduction.__proto__ || Object.getPrototypeOf(LeftRecursiveProduction)).apply(this, arguments));
  }

  _createClass(LeftRecursiveProduction, [{
    key: 'getLeftRecursiveDefinitions',
    value: function getLeftRecursiveDefinitions() {
      var name = this.getName(),
          definitions = this.getDefinitions(),
          productionName = name,
          ///
      leftRecursiveDefinitions = definitions.filter(function (definition) {
        var leftRecursiveDefinition = LeftRecursiveDefinition.fromDefinitionAndProductionName(definition, productionName),
            definitionLeftRecursive = leftRecursiveDefinition !== null;

        return definitionLeftRecursive;
      });

      return leftRecursiveDefinitions;
    }
  }, {
    key: 'getNonLeftRecursiveDefinitions',
    value: function getNonLeftRecursiveDefinitions() {
      var name = this.getName(),
          definitions = this.getDefinitions(),
          productionName = name,
          ///
      nonLeftRecursiveDefinitions = definitions.filter(function (definition) {
        var leftRecursiveDefinition = LeftRecursiveDefinition.fromDefinitionAndProductionName(definition, productionName),
            definitionNonLeftRecursive = leftRecursiveDefinition === null;

        return definitionNonLeftRecursive;
      });

      return nonLeftRecursiveDefinitions;
    }
  }], [{
    key: 'fromProduction',
    value: function fromProduction(production) {
      var leftRecursiveProduction = null;

      var productionName = production.getName(),
          productionDefinitions = production.getDefinitions(),
          someProductionDefinitionLeftRecursive = productionDefinitions.some(function (productionDefinition) {
        var definition = productionDefinition,
            ///
        leftRecursiveDefinition = LeftRecursiveDefinition.fromDefinitionAndProductionName(definition, productionName),
            productionDefinitionLeftRecursive = leftRecursiveDefinition !== null;

        return productionDefinitionLeftRecursive;
      });

      if (someProductionDefinitionLeftRecursive) {
        leftRecursiveProduction = Production.fromProduction(production, LeftRecursiveProduction);
      }

      return leftRecursiveProduction;
    }
  }, {
    key: 'fromImplicitlyLeftRecursiveProductionAndPreviousProductions',
    value: function fromImplicitlyLeftRecursiveProductionAndPreviousProductions(implicitlyLeftRecursiveProduction, previousProductions) {
      var name = implicitlyLeftRecursiveProduction.getName(),
          Node = implicitlyLeftRecursiveProduction.getNode();

      var definitions = implicitlyLeftRecursiveProduction.getDefinitions();

      previousProductions.forEach(function (previousProduction) {
        var leftRecursiveDefinitions = leftRecursiveDefinitionsFromDefinitionsAndPreviousProduction(definitions, previousProduction);

        definitions = leftRecursiveDefinitions;
      });

      var leftRecursiveProduction = new LeftRecursiveProduction(name, definitions, Node);

      return leftRecursiveProduction;
    }
  }]);

  return LeftRecursiveProduction;
}(Production);

module.exports = LeftRecursiveProduction;

function leftRecursiveDefinitionsFromDefinitionsAndPreviousProduction(definitions, previousProduction) {
  var leftRecursiveDefinitions = [];

  definitions.forEach(function (definition) {
    var implicitlyLeftRecursiveDefinition = ImplicitlyLeftRecursiveDefinition.fromDefinitionAndPreviousProduction(definition, previousProduction);

    if (implicitlyLeftRecursiveDefinition === null) {
      var leftRecursiveDefinition = definition; ///

      leftRecursiveDefinitions.push(leftRecursiveDefinition);
    } else {
      leftRecursiveDefinitions = leftRecursiveDefinitions.concat(leftRecursiveDefinitionsFromImplicitlyLeftRecursiveDefinitionAndPreviousProduction(implicitlyLeftRecursiveDefinition, previousProduction)); ///
    }
  });

  return leftRecursiveDefinitions;
}

function leftRecursiveDefinitionsFromImplicitlyLeftRecursiveDefinitionAndPreviousProduction(implicitlyLeftRecursiveDefinition, previousProduction) {
  var previousProductionDefinitions = previousProduction.getDefinitions(),
      implicitlyLeftRecursiveDefinitionAllButFirstParts = implicitlyLeftRecursiveDefinition.getAllButFirstParts(),
      leftRecursiveDefinitions = previousProductionDefinitions.map(function (previousProductionDefinition) {
    var previousProductionDefinitionParts = previousProductionDefinition.getParts(),
        leftRecursiveDefinitionParts = [].concat(previousProductionDefinitionParts).concat(implicitlyLeftRecursiveDefinitionAllButFirstParts),
        leftRecursiveDefinition = new LeftRecursiveDefinition(leftRecursiveDefinitionParts);

    return leftRecursiveDefinition;
  });

  return leftRecursiveDefinitions;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9ncmFtbWFyL3Byb2R1Y3Rpb24vbGVmdFJlY3Vyc2l2ZS5qcyJdLCJuYW1lcyI6WyJQcm9kdWN0aW9uIiwicmVxdWlyZSIsIkxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24iLCJuYW1lIiwiZ2V0TmFtZSIsImRlZmluaXRpb25zIiwiZ2V0RGVmaW5pdGlvbnMiLCJwcm9kdWN0aW9uTmFtZSIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImZpbHRlciIsImRlZmluaXRpb24iLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImZyb21EZWZpbml0aW9uQW5kUHJvZHVjdGlvbk5hbWUiLCJkZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZSIsIm5vbkxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImRlZmluaXRpb25Ob25MZWZ0UmVjdXJzaXZlIiwicHJvZHVjdGlvbiIsImxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uIiwicHJvZHVjdGlvbkRlZmluaXRpb25zIiwic29tZVByb2R1Y3Rpb25EZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZSIsInNvbWUiLCJwcm9kdWN0aW9uRGVmaW5pdGlvbiIsInByb2R1Y3Rpb25EZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZSIsImZyb21Qcm9kdWN0aW9uIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uIiwicHJldmlvdXNQcm9kdWN0aW9ucyIsIk5vZGUiLCJnZXROb2RlIiwiZm9yRWFjaCIsInByZXZpb3VzUHJvZHVjdGlvbiIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0Zyb21EZWZpbml0aW9uc0FuZFByZXZpb3VzUHJvZHVjdGlvbiIsIm1vZHVsZSIsImV4cG9ydHMiLCJpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tRGVmaW5pdGlvbkFuZFByZXZpb3VzUHJvZHVjdGlvbiIsInB1c2giLCJjb25jYXQiLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNGcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kUHJldmlvdXNQcm9kdWN0aW9uIiwicHJldmlvdXNQcm9kdWN0aW9uRGVmaW5pdGlvbnMiLCJpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbGxCdXRGaXJzdFBhcnRzIiwiZ2V0QWxsQnV0Rmlyc3RQYXJ0cyIsIm1hcCIsInByZXZpb3VzUHJvZHVjdGlvbkRlZmluaXRpb24iLCJwcmV2aW91c1Byb2R1Y3Rpb25EZWZpbml0aW9uUGFydHMiLCJnZXRQYXJ0cyIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uUGFydHMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7O0FBRUEsSUFBTUEsYUFBYUMsUUFBUSw4QkFBUixDQUFuQjtBQUFBLElBQ01DLDBCQUEwQkQsUUFBUSw2QkFBUixDQURoQztBQUFBLElBRU1FLG9DQUFvQ0YsUUFBUSx1Q0FBUixDQUYxQzs7SUFJTUcsdUI7Ozs7Ozs7Ozs7O2tEQUMwQjtBQUM1QixVQUFNQyxPQUFPLEtBQUtDLE9BQUwsRUFBYjtBQUFBLFVBQ01DLGNBQWMsS0FBS0MsY0FBTCxFQURwQjtBQUFBLFVBRU1DLGlCQUFpQkosSUFGdkI7QUFBQSxVQUU4QjtBQUN4QkssaUNBQTJCSCxZQUFZSSxNQUFaLENBQW1CLFVBQVNDLFVBQVQsRUFBcUI7QUFDakUsWUFBTUMsMEJBQTBCWCx3QkFBd0JZLCtCQUF4QixDQUF3REYsVUFBeEQsRUFBb0VILGNBQXBFLENBQWhDO0FBQUEsWUFDTU0sMEJBQTJCRiw0QkFBNEIsSUFEN0Q7O0FBR0EsZUFBT0UsdUJBQVA7QUFDRCxPQUwwQixDQUhqQzs7QUFVQSxhQUFPTCx3QkFBUDtBQUNEOzs7cURBRWdDO0FBQy9CLFVBQU1MLE9BQU8sS0FBS0MsT0FBTCxFQUFiO0FBQUEsVUFDTUMsY0FBYyxLQUFLQyxjQUFMLEVBRHBCO0FBQUEsVUFFTUMsaUJBQWlCSixJQUZ2QjtBQUFBLFVB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LENBQVVPLGlDQUFWLEVBQTZDUCxNQUE3QyxDQUFvREcsaURBQXBELENBRHJDO0FBQUEsUUFFTTVCLDBCQUEwQixJQUFJWCx1QkFBSixDQUE0QjZDLDRCQUE1QixDQUZoQzs7QUFJQSxXQUFPbEMsdUJBQVA7QUFDRCxHQU4wQixDQUZqQzs7QUFVQSxTQUFPSCx3QkFBUDtBQUNEIiwiZmlsZSI6ImxlZnRSZWN1cnNpdmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IFByb2R1Y3Rpb24gPSByZXF1aXJlKCcuLi8uLi9leHRlbmRlZEJORi9wcm9kdWN0aW9uJyksXG4gICAgICBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IHJlcXVpcmUoJy4uL2RlZmluaXRpb24vbGVmdFJlY3Vyc2l2ZScpLFxuICAgICAgSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gcmVxdWlyZSgnLi4vZGVmaW5pdGlvbi9pbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZScpO1xuXG5jbGFzcyBMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiBleHRlbmRzIFByb2R1Y3Rpb24ge1xuICBnZXRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoKSB7XG4gICAgY29uc3QgbmFtZSA9IHRoaXMuZ2V0TmFtZSgpLFxuICAgICAgICAgIGRlZmluaXRpb25zID0gdGhpcy5nZXREZWZpbml0aW9ucygpLFxuICAgICAgICAgIHByb2R1Y3Rpb25OYW1lID0gbmFtZSwgIC8vL1xuICAgICAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IGRlZmluaXRpb25zLmZpbHRlcihmdW5jdGlvbihkZWZpbml0aW9uKSB7XG4gICAgICAgICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IExlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21EZWZpbml0aW9uQW5kUHJvZHVjdGlvbk5hbWUoZGVmaW5pdGlvbiwgcHJvZHVjdGlvbk5hbWUpLFxuICAgICAgICAgICAgICAgICAgZGVmaW5pdGlvbkxlZnRSZWN1cnNpdmUgPSAobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gIT09IG51bGwpO1xuICBcbiAgICAgICAgICAgIHJldHVybiBkZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZTtcbiAgICAgICAgICB9KTtcblxuICAgIHJldHVybiBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnM7XG4gIH1cblxuICBnZXROb25MZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoKSB7XG4gICAgY29uc3QgbmFtZSA9IHRoaXMuZ2V0TmFtZSgpLFxuICAgICAgICAgIGRlZmluaXRpb25zID0gdGhpcy5nZXREZWZpbml0aW9ucygpLFxuICAgICAgICAgIHByb2R1Y3Rpb25OYW1lID0gbmFtZSwgIC8vL1xuICAgICAgICAgIG5vbkxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IGRlZmluaXRpb25zLmZpbHRlcihmdW5jdGlvbihkZWZpbml0aW9uKSB7XG4gICAgICAgICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IExlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21EZWZpbml0aW9uQW5kUHJvZHVjdGlvbk5hbWUoZGVmaW5pdGlvbiwgcHJvZHVjdGlvbk5hbWUpLFxuICAgICAgICAgICAgICAgICAgZGVmaW5pdGlvbk5vbkxlZnRSZWN1cnNpdmUgPSAobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPT09IG51bGwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gZGVmaW5pdGlvbk5vbkxlZnRSZWN1cnNpdmU7XG4gICAgICAgICAgfSk7XG5cbiAgICByZXR1cm4gbm9uTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zO1xuICB9XG5cbiAgc3RhdGljIGZyb21Qcm9kdWN0aW9uKHByb2R1Y3Rpb24pIHtcbiAgICBsZXQgbGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24gPSBudWxsO1xuICAgIFxuICAgIGNvbnN0IHByb2R1Y3Rpb25OYW1lID0gcHJvZHVjdGlvbi5nZXROYW1lKCksXG4gICAgICAgICAgcHJvZHVjdGlvbkRlZmluaXRpb25zID0gcHJvZHVjdGlvbi5nZXREZWZpbml0aW9ucygpLFxuICAgICAgICAgIHNvbWVQcm9kdWN0aW9uRGVmaW5pdGlvbkxlZnRSZWN1cnNpdmUgPSBwcm9kdWN0aW9uRGVmaW5pdGlvbnMuc29tZShmdW5jdGlvbihwcm9kdWN0aW9uRGVmaW5pdGlvbikge1xuICAgICAgICAgICAgY29uc3QgZGVmaW5pdGlvbiA9IHByb2R1Y3Rpb25EZWZpbml0aW9uLCAvLy9cbiAgICAgICAgICAgICAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbURlZmluaXRpb25BbmRQcm9kdWN0aW9uTmFtZShkZWZpbml0aW9uLCBwcm9kdWN0aW9uTmFtZSksXG4gICAgICAgICAgICAgICAgICBwcm9kdWN0aW9uRGVmaW5pdGlvbkxlZnRSZWN1cnNpdmUgPSAobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gIT09IG51bGwpO1xuXG4gICAgICAgICAgICByZXR1cm4gcHJvZHVjdGlvbkRlZmluaXRpb25MZWZ0UmVjdXJzaXZlO1xuICAgICAgICAgIH0pO1xuXG4gICAgaWYgKHNvbWVQcm9kdWN0aW9uRGVmaW5pdGlvbkxlZnRSZWN1cnNpdmUpIHtcbiAgICAgIGxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uID0gUHJvZHVjdGlvbi5mcm9tUHJvZHVjdGlvbihwcm9kdWN0aW9uLCBMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbik7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBsZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbjtcbiAgfVxuICBcbiAgc3RhdGljIGZyb21JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb25BbmRQcmV2aW91c1Byb2R1Y3Rpb25zKGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiwgcHJldmlvdXNQcm9kdWN0aW9ucykge1xuICAgIGNvbnN0IG5hbWUgPSBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24uZ2V0TmFtZSgpLFxuICAgICAgICAgIE5vZGUgPSBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24uZ2V0Tm9kZSgpO1xuXG4gICAgbGV0IGRlZmluaXRpb25zID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uLmdldERlZmluaXRpb25zKCk7XG5cbiAgICBwcmV2aW91c1Byb2R1Y3Rpb25zLmZvckVhY2goZnVuY3Rpb24ocHJldmlvdXNQcm9kdWN0aW9uKSB7XG4gICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNGcm9tRGVmaW5pdGlvbnNBbmRQcmV2aW91c1Byb2R1Y3Rpb24oZGVmaW5pdGlvbnMsIHByZXZpb3VzUHJvZHVjdGlvbik7XG5cbiAgICAgIGRlZmluaXRpb25zID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zO1xuICAgIH0pO1xuXG4gICAgY29uc3QgbGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24gPSBuZXcgTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24obmFtZSwgZGVmaW5pdGlvbnMsIE5vZGUpO1xuXG4gICAgcmV0dXJuIGxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb247XG5cbmZ1bmN0aW9uIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0Zyb21EZWZpbml0aW9uc0FuZFByZXZpb3VzUHJvZHVjdGlvbihkZWZpbml0aW9ucywgcHJldmlvdXNQcm9kdWN0aW9uKSB7XG4gIGxldCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBbXTtcblxuICBkZWZpbml0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGRlZmluaXRpb24pIHtcbiAgICBjb25zdCBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbURlZmluaXRpb25BbmRQcmV2aW91c1Byb2R1Y3Rpb24oZGVmaW5pdGlvbiwgcHJldmlvdXNQcm9kdWN0aW9uKTtcblxuICAgIGlmIChpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gZGVmaW5pdGlvbjsgLy8vXG5cbiAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5wdXNoKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLmNvbmNhdChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNGcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kUHJldmlvdXNQcm9kdWN0aW9uKGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcHJldmlvdXNQcm9kdWN0aW9uKSk7ICAvLy9cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnM7XG59XG5cbmZ1bmN0aW9uIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0Zyb21JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbmRQcmV2aW91c1Byb2R1Y3Rpb24oaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBwcmV2aW91c1Byb2R1Y3Rpb24pIHtcbiAgY29uc3QgcHJldmlvdXNQcm9kdWN0aW9uRGVmaW5pdGlvbnMgPSBwcmV2aW91c1Byb2R1Y3Rpb24uZ2V0RGVmaW5pdGlvbnMoKSxcbiAgICAgICAgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQWxsQnV0Rmlyc3RQYXJ0cyA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRBbGxCdXRGaXJzdFBhcnRzKCksXG4gICAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IHByZXZpb3VzUHJvZHVjdGlvbkRlZmluaXRpb25zLm1hcChmdW5jdGlvbihwcmV2aW91c1Byb2R1Y3Rpb25EZWZpbml0aW9uKSB7XG4gICAgICAgICAgY29uc3QgcHJldmlvdXNQcm9kdWN0aW9uRGVmaW5pdGlvblBhcnRzID0gcHJldmlvdXNQcm9kdWN0aW9uRGVmaW5pdGlvbi5nZXRQYXJ0cygpLFxuICAgICAgICAgICAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uUGFydHMgPSBbXS5jb25jYXQocHJldmlvdXNQcm9kdWN0aW9uRGVmaW5pdGlvblBhcnRzKS5jb25jYXQoaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQWxsQnV0Rmlyc3RQYXJ0cyksXG4gICAgICAgICAgICAgICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBuZXcgTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24obGVmdFJlY3Vyc2l2ZURlZmluaXRpb25QYXJ0cyk7XG5cbiAgICAgICAgICByZXR1cm4gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG4gICAgICAgIH0pO1xuXG4gIHJldHVybiBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnM7XG59XG4iXX0=