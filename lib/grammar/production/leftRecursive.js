'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Production = require('../../common/production'),
    LeftRecursiveDefinition = require('../definition/leftRecursive'),
    ImplicitlyLeftRecursiveDefinition = require('../definition/implicitlyLeftRecursive');

var LeftRecursiveProduction = function (_Production) {
  _inherits(LeftRecursiveProduction, _Production);

  function LeftRecursiveProduction() {
    _classCallCheck(this, LeftRecursiveProduction);

    return _possibleConstructorReturn(this, (LeftRecursiveProduction.__proto__ || Object.getPrototypeOf(LeftRecursiveProduction)).apply(this, arguments));
  }

  _createClass(LeftRecursiveProduction, [{
    key: 'getLeftRecursiveDefinitions',
    value: function getLeftRecursiveDefinitions() {
      var name = this.getName(),
          definitions = this.getDefinitions(),
          productionName = name,
          ///
      leftRecursiveDefinitions = definitions.filter(function (definition) {
        var leftRecursiveDefinition = LeftRecursiveDefinition.fromDefinitionAndProductionName(definition, productionName),
            definitionLeftRecursive = leftRecursiveDefinition !== null;

        return definitionLeftRecursive;
      });

      return leftRecursiveDefinitions;
    }
  }, {
    key: 'getNonLeftRecursiveDefinitions',
    value: function getNonLeftRecursiveDefinitions() {
      var name = this.getName(),
          definitions = this.getDefinitions(),
          productionName = name,
          ///
      nonLeftRecursiveDefinitions = definitions.filter(function (definition) {
        var leftRecursiveDefinition = LeftRecursiveDefinition.fromDefinitionAndProductionName(definition, productionName),
            definitionNonLeftRecursive = leftRecursiveDefinition === null;

        return definitionNonLeftRecursive;
      });

      return nonLeftRecursiveDefinitions;
    }
  }], [{
    key: 'fromProduction',
    value: function fromProduction(production) {
      var leftRecursiveProduction = null;

      var productionName = production.getName(),
          productionDefinitions = production.getDefinitions(),
          someProductionDefinitionLeftRecursive = productionDefinitions.some(function (productionDefinition) {
        var definition = productionDefinition,
            ///
        leftRecursiveDefinition = LeftRecursiveDefinition.fromDefinitionAndProductionName(definition, productionName),
            productionDefinitionLeftRecursive = leftRecursiveDefinition !== null;

        return productionDefinitionLeftRecursive;
      });

      if (someProductionDefinitionLeftRecursive) {
        leftRecursiveProduction = Production.fromProduction(production, LeftRecursiveProduction);
      }

      return leftRecursiveProduction;
    }
  }, {
    key: 'fromImplicitlyLeftRecursiveProductionAndPreviousProductions',
    value: function fromImplicitlyLeftRecursiveProductionAndPreviousProductions(implicitlyLeftRecursiveProduction, previousProductions) {
      var name = implicitlyLeftRecursiveProduction.getName(),
          Node = implicitlyLeftRecursiveProduction.getNode();

      var definitions = implicitlyLeftRecursiveProduction.getDefinitions();

      previousProductions.forEach(function (previousProduction) {
        var leftRecursiveDefinitions = leftRecursiveDefinitionsFromDefinitionsAndPreviousProduction(definitions, previousProduction);

        definitions = leftRecursiveDefinitions;
      });

      var leftRecursiveProduction = new LeftRecursiveProduction(name, definitions, Node);

      return leftRecursiveProduction;
    }
  }]);

  return LeftRecursiveProduction;
}(Production);

module.exports = LeftRecursiveProduction;

function leftRecursiveDefinitionsFromDefinitionsAndPreviousProduction(definitions, previousProduction) {
  var leftRecursiveDefinitions = [];

  definitions.forEach(function (definition) {
    var implicitlyLeftRecursiveDefinition = ImplicitlyLeftRecursiveDefinition.fromDefinitionAndPreviousProduction(definition, previousProduction);

    if (implicitlyLeftRecursiveDefinition === null) {
      var leftRecursiveDefinition = definition; ///

      leftRecursiveDefinitions.push(leftRecursiveDefinition);
    } else {
      leftRecursiveDefinitions = leftRecursiveDefinitions.concat(leftRecursiveDefinitionsFromImplicitlyLeftRecursiveDefinitionAndPreviousProduction(implicitlyLeftRecursiveDefinition, previousProduction)); ///
    }
  });

  return leftRecursiveDefinitions;
}

function leftRecursiveDefinitionsFromImplicitlyLeftRecursiveDefinitionAndPreviousProduction(implicitlyLeftRecursiveDefinition, previousProduction) {
  var previousProductionDefinitions = previousProduction.getDefinitions(),
      implicitlyLeftRecursiveDefinitionAllButFirstParts = implicitlyLeftRecursiveDefinition.getAllButFirstParts(),
      leftRecursiveDefinitions = previousProductionDefinitions.map(function (previousProductionDefinition) {
    var previousProductionDefinitionParts = previousProductionDefinition.getParts(),
        leftRecursiveDefinitionParts = [].concat(previousProductionDefinitionParts).concat(implicitlyLeftRecursiveDefinitionAllButFirstParts),
        leftRecursiveDefinition = new LeftRecursiveDefinition(leftRecursiveDefinitionParts);

    return leftRecursiveDefinition;
  });

  return leftRecursiveDefinitions;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9ncmFtbWFyL3Byb2R1Y3Rpb24vbGVmdFJlY3Vyc2l2ZS5qcyJdLCJuYW1lcyI6WyJQcm9kdWN0aW9uIiwicmVxdWlyZSIsIkxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24iLCJuYW1lIiwiZ2V0TmFtZSIsImRlZmluaXRpb25zIiwiZ2V0RGVmaW5pdGlvbnMiLCJwcm9kdWN0aW9uTmFtZSIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImZpbHRlciIsImRlZmluaXRpb24iLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImZyb21EZWZpbml0aW9uQW5kUHJvZHVjdGlvbk5hbWUiLCJkZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZSIsIm5vbkxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImRlZmluaXRpb25Ob25MZWZ0UmVjdXJzaXZlIiwicHJvZHVjdGlvbiIsImxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uIiwicHJvZHVjdGlvbkRlZmluaXRpb25zIiwic29tZVByb2R1Y3Rpb25EZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZSIsInNvbWUiLCJwcm9kdWN0aW9uRGVmaW5pdGlvbiIsInByb2R1Y3Rpb25EZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZSIsImZyb21Qcm9kdWN0aW9uIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uIiwicHJldmlvdXNQcm9kdWN0aW9ucyIsIk5vZGUiLCJnZXROb2RlIiwiZm9yRWFjaCIsInByZXZpb3VzUHJvZHVjdGlvbiIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0Zyb21EZWZpbml0aW9uc0FuZFByZXZpb3VzUHJvZHVjdGlvbiIsIm1vZHVsZSIsImV4cG9ydHMiLCJpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tRGVmaW5pdGlvbkFuZFByZXZpb3VzUHJvZHVjdGlvbiIsInB1c2giLCJjb25jYXQiLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNGcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kUHJldmlvdXNQcm9kdWN0aW9uIiwicHJldmlvdXNQcm9kdWN0aW9uRGVmaW5pdGlvbnMiLCJpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbGxCdXRGaXJzdFBhcnRzIiwiZ2V0QWxsQnV0Rmlyc3RQYXJ0cyIsIm1hcCIsInByZXZpb3VzUHJvZHVjdGlvbkRlZmluaXRpb24iLCJwcmV2aW91c1Byb2R1Y3Rpb25EZWZpbml0aW9uUGFydHMiLCJnZXRQYXJ0cyIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uUGFydHMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7O0FBRUEsSUFBTUEsYUFBYUMsUUFBUSx5QkFBUixDQUFuQjtBQUFBLElBQ01DLDBCQUEwQkQsUUFBUSw2QkFBUixDQURoQztBQUFBLElBRU1FLG9DQUFvQ0YsUUFBUSx1Q0FBUixDQUYxQzs7SUFJTUcsdUI7Ozs7Ozs7Ozs7O2tEQUMwQjtBQUM1QixVQUFNQyxPQUFPLEtBQUtDLE9BQUwsRUFBYjtBQUFBLFVBQ01DLGNBQWMsS0FBS0MsY0FBTCxFQURwQjtBQUFBLFVBRU1DLGlCQUFpQkosSUFGdkI7QUFBQSxVQUU4QjtBQUN4QkssaUNBQTJCSCxZQUFZSSxNQUFaLENBQW1CLFVBQVNDLFVBQVQsRUFBcUI7QUFDakUsWUFBTUMsMEJBQTBCWCx3QkFBd0JZLCtCQUF4QixDQUF3REYsVUFBeEQsRUFBb0VILGNBQXBFLENBQWhDO0FBQUEsWUFDTU0sMEJBQTJCRiw0QkFBNEIsSUFEN0Q7O0FBR0EsZUFBT0UsdUJBQVA7QUFDRCxPQUwwQixDQUhqQzs7QUFVQSxhQUFPTCx3QkFBUDtBQUNEOzs7cURBRWdDO0FBQy9CLFVBQU1MLE9BQU8sS0FBS0MsT0FBTCxFQUFiO0FBQUEsVUFDTUMsY0FBYyxLQUFLQyxjQUFMLEVBRHBCO0FBQUEsVUFFTUMsaUJBQWlCSixJQUZ2QjtBQUFBLFVB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LENBQVVPLGlDQUFWLEVBQTZDUCxNQUE3QyxDQUFvREcsaURBQXBELENBRHJDO0FBQUEsUUFFTTVCLDBCQUEwQixJQUFJWCx1QkFBSixDQUE0QjZDLDRCQUE1QixDQUZoQzs7QUFJQSxXQUFPbEMsdUJBQVA7QUFDRCxHQU4wQixDQUZqQzs7QUFVQSxTQUFPSCx3QkFBUDtBQUNEIiwiZmlsZSI6ImxlZnRSZWN1cnNpdmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IFByb2R1Y3Rpb24gPSByZXF1aXJlKCcuLi8uLi9jb21tb24vcHJvZHVjdGlvbicpLFxuICAgICAgTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSByZXF1aXJlKCcuLi9kZWZpbml0aW9uL2xlZnRSZWN1cnNpdmUnKSxcbiAgICAgIEltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IHJlcXVpcmUoJy4uL2RlZmluaXRpb24vaW1wbGljaXRseUxlZnRSZWN1cnNpdmUnKTtcblxuY2xhc3MgTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24gZXh0ZW5kcyBQcm9kdWN0aW9uIHtcbiAgZ2V0TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKCkge1xuICAgIGNvbnN0IG5hbWUgPSB0aGlzLmdldE5hbWUoKSxcbiAgICAgICAgICBkZWZpbml0aW9ucyA9IHRoaXMuZ2V0RGVmaW5pdGlvbnMoKSxcbiAgICAgICAgICBwcm9kdWN0aW9uTmFtZSA9IG5hbWUsICAvLy9cbiAgICAgICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBkZWZpbml0aW9ucy5maWx0ZXIoZnVuY3Rpb24oZGVmaW5pdGlvbikge1xuICAgICAgICAgICAgY29uc3QgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tRGVmaW5pdGlvbkFuZFByb2R1Y3Rpb25OYW1lKGRlZmluaXRpb24sIHByb2R1Y3Rpb25OYW1lKSxcbiAgICAgICAgICAgICAgICAgIGRlZmluaXRpb25MZWZ0UmVjdXJzaXZlID0gKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uICE9PSBudWxsKTtcbiAgXG4gICAgICAgICAgICByZXR1cm4gZGVmaW5pdGlvbkxlZnRSZWN1cnNpdmU7XG4gICAgICAgICAgfSk7XG5cbiAgICByZXR1cm4gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zO1xuICB9XG5cbiAgZ2V0Tm9uTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKCkge1xuICAgIGNvbnN0IG5hbWUgPSB0aGlzLmdldE5hbWUoKSxcbiAgICAgICAgICBkZWZpbml0aW9ucyA9IHRoaXMuZ2V0RGVmaW5pdGlvbnMoKSxcbiAgICAgICAgICBwcm9kdWN0aW9uTmFtZSA9IG5hbWUsICAvLy9cbiAgICAgICAgICBub25MZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBkZWZpbml0aW9ucy5maWx0ZXIoZnVuY3Rpb24oZGVmaW5pdGlvbikge1xuICAgICAgICAgICAgY29uc3QgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tRGVmaW5pdGlvbkFuZFByb2R1Y3Rpb25OYW1lKGRlZmluaXRpb24sIHByb2R1Y3Rpb25OYW1lKSxcbiAgICAgICAgICAgICAgICAgIGRlZmluaXRpb25Ob25MZWZ0UmVjdXJzaXZlID0gKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID09PSBudWxsKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIGRlZmluaXRpb25Ob25MZWZ0UmVjdXJzaXZlO1xuICAgICAgICAgIH0pO1xuXG4gICAgcmV0dXJuIG5vbkxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucztcbiAgfVxuXG4gIHN0YXRpYyBmcm9tUHJvZHVjdGlvbihwcm9kdWN0aW9uKSB7XG4gICAgbGV0IGxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uID0gbnVsbDtcbiAgICBcbiAgICBjb25zdCBwcm9kdWN0aW9uTmFtZSA9IHByb2R1Y3Rpb24uZ2V0TmFtZSgpLFxuICAgICAgICAgIHByb2R1Y3Rpb25EZWZpbml0aW9ucyA9IHByb2R1Y3Rpb24uZ2V0RGVmaW5pdGlvbnMoKSxcbiAgICAgICAgICBzb21lUHJvZHVjdGlvbkRlZmluaXRpb25MZWZ0UmVjdXJzaXZlID0gcHJvZHVjdGlvbkRlZmluaXRpb25zLnNvbWUoZnVuY3Rpb24ocHJvZHVjdGlvbkRlZmluaXRpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IGRlZmluaXRpb24gPSBwcm9kdWN0aW9uRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgICAgICAgICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IExlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21EZWZpbml0aW9uQW5kUHJvZHVjdGlvbk5hbWUoZGVmaW5pdGlvbiwgcHJvZHVjdGlvbk5hbWUpLFxuICAgICAgICAgICAgICAgICAgcHJvZHVjdGlvbkRlZmluaXRpb25MZWZ0UmVjdXJzaXZlID0gKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uICE9PSBudWxsKTtcblxuICAgICAgICAgICAgcmV0dXJuIHByb2R1Y3Rpb25EZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZTtcbiAgICAgICAgICB9KTtcblxuICAgIGlmIChzb21lUHJvZHVjdGlvbkRlZmluaXRpb25MZWZ0UmVjdXJzaXZlKSB7XG4gICAgICBsZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbiA9IFByb2R1Y3Rpb24uZnJvbVByb2R1Y3Rpb24ocHJvZHVjdGlvbiwgTGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24pO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gbGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb247XG4gIH1cbiAgXG4gIHN0YXRpYyBmcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uQW5kUHJldmlvdXNQcm9kdWN0aW9ucyhpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVByb2R1Y3Rpb24sIHByZXZpb3VzUHJvZHVjdGlvbnMpIHtcbiAgICBjb25zdCBuYW1lID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uLmdldE5hbWUoKSxcbiAgICAgICAgICBOb2RlID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uLmdldE5vZGUoKTtcblxuICAgIGxldCBkZWZpbml0aW9ucyA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbi5nZXREZWZpbml0aW9ucygpO1xuXG4gICAgcHJldmlvdXNQcm9kdWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHByZXZpb3VzUHJvZHVjdGlvbikge1xuICAgICAgY29uc3QgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zRnJvbURlZmluaXRpb25zQW5kUHJldmlvdXNQcm9kdWN0aW9uKGRlZmluaXRpb25zLCBwcmV2aW91c1Byb2R1Y3Rpb24pO1xuXG4gICAgICBkZWZpbml0aW9ucyA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucztcbiAgICB9KTtcblxuICAgIGNvbnN0IGxlZnRSZWN1cnNpdmVQcm9kdWN0aW9uID0gbmV3IExlZnRSZWN1cnNpdmVQcm9kdWN0aW9uKG5hbWUsIGRlZmluaXRpb25zLCBOb2RlKTtcblxuICAgIHJldHVybiBsZWZ0UmVjdXJzaXZlUHJvZHVjdGlvbjtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IExlZnRSZWN1cnNpdmVQcm9kdWN0aW9uO1xuXG5mdW5jdGlvbiBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNGcm9tRGVmaW5pdGlvbnNBbmRQcmV2aW91c1Byb2R1Y3Rpb24oZGVmaW5pdGlvbnMsIHByZXZpb3VzUHJvZHVjdGlvbikge1xuICBsZXQgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zID0gW107XG5cbiAgZGVmaW5pdGlvbnMuZm9yRWFjaChmdW5jdGlvbihkZWZpbml0aW9uKSB7XG4gICAgY29uc3QgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21EZWZpbml0aW9uQW5kUHJldmlvdXNQcm9kdWN0aW9uKGRlZmluaXRpb24sIHByZXZpb3VzUHJvZHVjdGlvbik7XG5cbiAgICBpZiAoaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID09PSBudWxsKSB7XG4gICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGRlZmluaXRpb247IC8vL1xuXG4gICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMucHVzaChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5jb25jYXQobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zRnJvbUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkFuZFByZXZpb3VzUHJvZHVjdGlvbihpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHByZXZpb3VzUHJvZHVjdGlvbikpOyAgLy8vXG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zO1xufVxuXG5mdW5jdGlvbiBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNGcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kUHJldmlvdXNQcm9kdWN0aW9uKGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcHJldmlvdXNQcm9kdWN0aW9uKSB7XG4gIGNvbnN0IHByZXZpb3VzUHJvZHVjdGlvbkRlZmluaXRpb25zID0gcHJldmlvdXNQcm9kdWN0aW9uLmdldERlZmluaXRpb25zKCksXG4gICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkFsbEJ1dEZpcnN0UGFydHMgPSBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0QWxsQnV0Rmlyc3RQYXJ0cygpLFxuICAgICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBwcmV2aW91c1Byb2R1Y3Rpb25EZWZpbml0aW9ucy5tYXAoZnVuY3Rpb24ocHJldmlvdXNQcm9kdWN0aW9uRGVmaW5pdGlvbikge1xuICAgICAgICAgIGNvbnN0IHByZXZpb3VzUHJvZHVjdGlvbkRlZmluaXRpb25QYXJ0cyA9IHByZXZpb3VzUHJvZHVjdGlvbkRlZmluaXRpb24uZ2V0UGFydHMoKSxcbiAgICAgICAgICAgICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvblBhcnRzID0gW10uY29uY2F0KHByZXZpb3VzUHJvZHVjdGlvbkRlZmluaXRpb25QYXJ0cykuY29uY2F0KGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkFsbEJ1dEZpcnN0UGFydHMpLFxuICAgICAgICAgICAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gbmV3IExlZnRSZWN1cnNpdmVEZWZpbml0aW9uKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uUGFydHMpO1xuXG4gICAgICAgICAgcmV0dXJuIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uO1xuICAgICAgICB9KTtcblxuICByZXR1cm4gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zO1xufVxuIl19