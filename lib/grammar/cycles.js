'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var tarjan = require('occam-tarjan');

var parserUtil = require('../util/parser'),
    Production = require('../bnf/production'),
    NonCyclicProduction = require('./production/nonCyclic'),
    UnitDefinitionProduction = require('./production/unitDefinition'),
    UnitDefinitionsProduction = require('./production/unitDefinitions'),
    NonUnitDefinitionsProduction = require('./production/nonUnitDefinitions');

var Graph = tarjan.Graph;

var cycles = function () {
  function cycles() {
    _classCallCheck(this, cycles);
  }

  _createClass(cycles, null, [{
    key: 'eliminate',
    value: function eliminate(productions) {
      var graph = graphFromProductions(productions),
          components = graph.generateComponents(),
          nonCyclicProductions = nonCyclicProductionsFromComponents(components, productions);

      productions = productions.map(function (production) {
        var productionName = production.getName(),
            nonCyclicProductionName = productionName,
            ///
        alreadyNonCyclicProductionName = productionName,
            ///
        nonCyclicProduction = parserUtil.findProduction(nonCyclicProductionName, nonCyclicProductions),
            alreadyNonCyclicProduction = parserUtil.findProduction(alreadyNonCyclicProductionName, productions); ///

        production = nonCyclicProduction || alreadyNonCyclicProduction; ///

        return production;
      });

      return productions;
    }
  }]);

  return cycles;
}();

module.exports = cycles;

function graphFromProductions(productions) {
  var graph = new Graph(),
      unitDefinitionsProductions = unitDefinitionsProductionsFromProductions(productions);

  unitDefinitionsProductions.forEach(function (unitDefinitionsProduction) {
    var productionName = unitDefinitionsProduction.getName(),
        productionNames = unitDefinitionsProduction.getProductionNames(),
        unitDefinitionProductionNames = unitDefinitionProductionNamesFromProductionNames(productionNames, unitDefinitionsProductions),
        vertexName = productionName,
        ///
    descendantVertexNames = unitDefinitionProductionNames; ///

    graph.addVertex(vertexName, descendantVertexNames);
  });

  return graph;
}

function unitDefinitionsProductionsFromProductions(productions) {
  var unitDefinitionsProductions = productions.reduce(function (unitDefinitionsProductions, production) {
    var unitDefinitionsProduction = UnitDefinitionsProduction.fromProduction(production);

    if (unitDefinitionsProduction !== null) {
      unitDefinitionsProductions.push(unitDefinitionsProduction);
    }

    return unitDefinitionsProductions;
  }, []);

  return unitDefinitionsProductions;
}

function unitDefinitionProductionNamesFromProductionNames(productionNames, unitDefinitionProductions) {
  var unitDefinitionProductionNames = productionNames.reduce(function (unitDefinitionProductionNames, productionName) {
    var unitDefinitionProductionName = productionName,
        ///
    unitDefinitionProduction = parserUtil.findProduction(unitDefinitionProductionName, unitDefinitionProductions);

    if (unitDefinitionProduction !== null) {
      var _unitDefinitionProductionName = productionName; ///

      unitDefinitionProductionNames.push(_unitDefinitionProductionName);
    }

    return unitDefinitionProductionNames;
  }, []);

  return unitDefinitionProductionNames;
}

function nonCyclicProductionsFromComponents(components, productions) {
  var nonCyclicProductions = components.reduce(function (nonCyclicProductions, component) {
    var componentNonCyclic = component.isNonCyclic();

    if (componentNonCyclic) {
      nonCyclicProductionFromComponent(component, productions, nonCyclicProductions);
    } else {
      nonCyclicProductionsFromComponent(component, productions, nonCyclicProductions);
    }

    return nonCyclicProductions;
  }, []);

  return nonCyclicProductions;
}

function nonCyclicProductionFromComponent(component, productions, nonCyclicProductions) {
  var firstVertex = component.getFirstVertex(),
      firstVertexName = firstVertex.getName(),
      productionName = firstVertexName,
      ///
  production = parserUtil.findProduction(productionName, productions);

  if (production !== null) {
    var nonCyclicProduction = NonCyclicProduction.fromProduction(production);

    nonCyclicProductions.push(nonCyclicProduction);
  }
}

function nonCyclicProductionsFromComponent(component, productions, nonCyclicProductions) {
  var unitDefinitionProductions = unitDefinitionProductionsFromComponent(component, productions),
      fixedNonUnitDefinitionsProductions = fixedNonUnitDefinitionsProductionsFromProductions(productions),
      addedNonUnitDefinitionsProductions = [],
      removedUnitDefinitionProductions = [];

  var unitDefinitionProductionsLength = unitDefinitionProductions.length;

  while (unitDefinitionProductionsLength > 0) {
    var unitDefinitionProduction = unitDefinitionProductions.shift(),
        unitDefinitionProductionName = unitDefinitionProduction.getName();

    var removedUnitDefinitionProduction = unitDefinitionProduction; ///

    removedUnitDefinitionProductions.push(removedUnitDefinitionProduction);

    var unitDefinitionProductionUnitDefinitionProductionName = unitDefinitionProduction.getUnitDefinitionProductionName(),
        fixedNonUnitDefinitionsProductionName = unitDefinitionProductionUnitDefinitionProductionName,
        ///
    fixedNonUnitDefinitionsProduction = parserUtil.findProduction(fixedNonUnitDefinitionsProductionName, fixedNonUnitDefinitionsProductions),
        addedNonUnitDefinitionsProductionName = unitDefinitionProductionName; ///

    var addedNonUnitDefinitionsProduction = parserUtil.findProduction(addedNonUnitDefinitionsProductionName, addedNonUnitDefinitionsProductions);

    if (addedNonUnitDefinitionsProduction === null) {
      addedNonUnitDefinitionsProduction = Production.fromProduction(fixedNonUnitDefinitionsProduction);

      addedNonUnitDefinitionsProduction.setName(addedNonUnitDefinitionsProductionName);

      addedNonUnitDefinitionsProductions.push(addedNonUnitDefinitionsProduction);
    } else {
      var fixedNonUnitDefinitionsProductionDefinitions = fixedNonUnitDefinitionsProduction.getDefinitions();

      addedNonUnitDefinitionsProduction.addDefinitions(fixedNonUnitDefinitionsProductionDefinitions);
    }

    var intermediateUnitDefinitionProductionName = unitDefinitionProductionUnitDefinitionProductionName,
        ///
    intermediateUnitDefinitionProduction = parserUtil.findProduction(intermediateUnitDefinitionProductionName, unitDefinitionProductions);

    if (intermediateUnitDefinitionProduction !== null) {
      var intermediateUnitDefinitionProductionUnitDefinitionProductionName = intermediateUnitDefinitionProduction.getUnitDefinitionProductionName(),
          firstProductionName = unitDefinitionProductionName,
          ///
      secondProductionName = intermediateUnitDefinitionProductionUnitDefinitionProductionName,
          ///
      unitDefinitionProductionNonCyclic = firstProductionName !== secondProductionName;

      if (unitDefinitionProductionNonCyclic) {
        unitDefinitionProduction = findUnitDefinitionProduction(firstProductionName, secondProductionName, removedUnitDefinitionProductions);

        if (unitDefinitionProduction === null) {
          unitDefinitionProduction = UnitDefinitionProduction.fromProductionNames(firstProductionName, secondProductionName);

          unitDefinitionProductions.unshift(unitDefinitionProduction);
        }
      }
    }

    unitDefinitionProductionsLength = unitDefinitionProductions.length;
  }

  nonCyclicProductionsFromFixedAndAddedProductions(fixedNonUnitDefinitionsProductions, addedNonUnitDefinitionsProductions, nonCyclicProductions);
}

function nonCyclicProductionsFromFixedAndAddedProductions(fixedNonUnitDefinitionsProductions, addedNonUnitDefinitionsProductions, nonCyclicProductions) {
  fixedNonUnitDefinitionsProductions.forEach(function (fixedNonUnitDefinitionsProduction) {
    var nonCyclicProduction = fixedNonUnitDefinitionsProduction,
        ///
    nonCyclicProductionName = nonCyclicProduction.getName(),
        addedNonUnitDefinitionsProductionName = nonCyclicProductionName,
        ///
    addedNonUnitDefinitionsProduction = parserUtil.findProduction(addedNonUnitDefinitionsProductionName, addedNonUnitDefinitionsProductions);

    if (addedNonUnitDefinitionsProduction !== null) {
      var addedNonUnitDefinitionsProductionDefinitions = addedNonUnitDefinitionsProduction.getDefinitions();

      nonCyclicProduction.addDefinitions(addedNonUnitDefinitionsProductionDefinitions);
    }

    var nonCyclicProductionDefinitionsExist = nonCyclicProduction.doDefinitionsExist();

    if (nonCyclicProductionDefinitionsExist) {
      nonCyclicProductions.push(nonCyclicProduction);
    }
  });
}

function unitDefinitionProductionsFromComponent(component, productions) {
  var unitDefinitionsProductions = unitDefinitionsProductionsFromComponent(component, productions),
      unitDefinitionProductions = unitDefinitionProductionsFromUnitDefinitionsProductions(unitDefinitionsProductions);

  return unitDefinitionProductions;
}

function unitDefinitionsProductionsFromComponent(component, productions) {
  var unitDefinitionsProductions = component.mapVertices(function (vertex) {
    var vertexName = vertex.getName(),
        productionName = vertexName,
        ///
    production = parserUtil.findProduction(productionName, productions),
        unitDefinitionsProduction = UnitDefinitionsProduction.fromProduction(production);

    return unitDefinitionsProduction;
  });

  return unitDefinitionsProductions;
}

function fixedNonUnitDefinitionsProductionsFromProductions(productions) {
  var fixedNonUnitDefinitionsProductions = productions.map(function (production) {
    var nonUnitDefinitionsProduction = NonUnitDefinitionsProduction.fromProduction(production),
        fixedNonUnitDefinitionsProduction = nonUnitDefinitionsProduction; ///

    return fixedNonUnitDefinitionsProduction;
  });

  return fixedNonUnitDefinitionsProductions;
}

function unitDefinitionProductionsFromUnitDefinitionsProductions(unitDefinitionsProductions) {
  var unitDefinitionProductions = unitDefinitionsProductions.reduce(function (unitDefinitionProductions, unitDefinitionsProduction) {
    var unitDefinitionsProductionName = unitDefinitionsProduction.getName();

    unitDefinitionsProduction.forEachUnitDefinition(function (unitDefinition) {
      var name = unitDefinitionsProductionName,
          ///
      unitDefinitionProduction = UnitDefinitionProduction.fromNameAndUnitDefinition(name, unitDefinition);

      unitDefinitionProductions.push(unitDefinitionProduction);
    });

    return unitDefinitionProductions;
  }, []);

  return unitDefinitionProductions;
}

function findUnitDefinitionProduction(firstProductionName, secondProductionName, unitDefinitionProductions) {
  var foundUnitDefinitionProduction = null;

  unitDefinitionProductions.some(function (unitDefinitionProduction) {
    var unitDefinitionProductionFound = unitDefinitionProduction.isFoundByProductionNames(firstProductionName, secondProductionName);

    if (unitDefinitionProductionFound) {
      foundUnitDefinitionProduction = unitDefinitionProduction;

      return true;
    }
  });

  var unitDefinitionProduction = foundUnitDefinitionProduction; ///

  return unitDefinitionProduction;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9ncmFtbWFyL2N5Y2xlcy5qcyJdLCJuYW1lcyI6WyJ0YXJqYW4iLCJyZXF1aXJlIiwicGFyc2VyVXRpbCIsIlByb2R1Y3Rpb24iLCJOb25DeWNsaWNQcm9kdWN0aW9uIiwiVW5pdERlZmluaXRpb25Qcm9kdWN0aW9uIiwiVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbiIsIk5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24iLCJHcmFwaCIsImN5Y2xlcyIsInByb2R1Y3Rpb25zIiwiZ3JhcGgiLCJncmFwaEZyb21Qcm9kdWN0aW9ucyIsImNvbXBvbmVudHMiLCJnZW5lcmF0ZUNvbXBvbmVudHMiLCJub25DeWNsaWNQcm9kdWN0aW9ucyIsIm5vbkN5Y2xpY1Byb2R1Y3Rpb25zRnJvbUNvbXBvbmVudHMiLCJtYXAiLCJwcm9kdWN0aW9uIiwicHJvZHVjdGlvbk5hbWUiLCJnZXROYW1lIiwibm9uQ3ljbGljUHJvZHVjdGlvbk5hbWUiLCJhbHJlYWR5Tm9uQ3ljbGljUHJvZHVjdGlvbk5hbWUiLCJub25DeWNsaWNQcm9kdWN0aW9uIiwiZmluZFByb2R1Y3Rpb24iLCJhbHJlYWR5Tm9uQ3ljbGljUHJvZHVjdGlvbiIsIm1vZHVsZSIsImV4cG9ydHMiLCJ1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucyIsInVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25zRnJvbVByb2R1Y3Rpb25zIiwiZm9yRWFjaCIsInVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24iLCJwcm9kdWN0aW9uTmFtZXMiLCJnZXRQcm9kdWN0aW9uTmFtZXMiLCJ1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lcyIsInVuaXREZWZpbml0aW9uUHJvZHVjdGlvbk5hbWVzRnJvbVByb2R1Y3Rpb25OYW1lcyIsInZlcnRleE5hbWUiLCJkZXNjZW5kYW50VmVydGV4TmFtZXMiLCJhZGRWZXJ0ZXgiLCJyZWR1Y2UiLCJmcm9tUHJvZHVjdGlvbiIsInB1c2giLCJ1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zIiwidW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZSIsInVuaXREZWZpbml0aW9uUHJvZHVjdGlvbiIsImNvbXBvbmVudCIsImNvbXBvbmVudE5vbkN5Y2xpYyIsImlzTm9uQ3ljbGljIiwibm9uQ3ljbGljUHJvZHVjdGlvbkZyb21Db21wb25lbnQiLCJub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21Db21wb25lbnQiLCJmaXJzdFZlcnRleCIsImdldEZpcnN0VmVydGV4IiwiZmlyc3RWZXJ0ZXhOYW1lIiwidW5pdERlZmluaXRpb25Qcm9kdWN0aW9uc0Zyb21Db21wb25lbnQiLCJmaXhlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25zIiwiZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uc0Zyb21Qcm9kdWN0aW9ucyIsImFkZGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMiLCJyZW1vdmVkVW5pdERlZmluaXRpb25Qcm9kdWN0aW9ucyIsInVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnNMZW5ndGgiLCJsZW5ndGgiLCJzaGlmdCIsInJlbW92ZWRVbml0RGVmaW5pdGlvblByb2R1Y3Rpb24iLCJ1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25Vbml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lIiwiZ2V0VW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZSIsImZpeGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbk5hbWUiLCJmaXhlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24iLCJhZGRlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25OYW1lIiwiYWRkZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uIiwic2V0TmFtZSIsImZpeGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbkRlZmluaXRpb25zIiwiZ2V0RGVmaW5pdGlvbnMiLCJhZGREZWZpbml0aW9ucyIsImludGVybWVkaWF0ZVVuaXREZWZpbml0aW9uUHJvZHVjdGlvbk5hbWUiLCJpbnRlcm1lZGlhdGVVbml0RGVmaW5pdGlvblByb2R1Y3Rpb24iLCJpbnRlcm1lZGlhdGVVbml0RGVmaW5pdGlvblByb2R1Y3Rpb25Vbml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lIiwiZmlyc3RQcm9kdWN0aW9uTmFtZSIsInNlY29uZFByb2R1Y3Rpb25OYW1lIiwidW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTm9uQ3ljbGljIiwiZmluZFVuaXREZWZpbml0aW9uUHJvZHVjdGlvbiIsImZyb21Qcm9kdWN0aW9uTmFtZXMiLCJ1bnNoaWZ0Iiwibm9uQ3ljbGljUHJvZHVjdGlvbnNGcm9tRml4ZWRBbmRBZGRlZFByb2R1Y3Rpb25zIiwiYWRkZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uRGVmaW5pdGlvbnMiLCJub25DeWNsaWNQcm9kdWN0aW9uRGVmaW5pdGlvbnNFeGlzdCIsImRvRGVmaW5pdGlvbnNFeGlzdCIsInVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25zRnJvbUNvbXBvbmVudCIsInVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnNGcm9tVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMiLCJtYXBWZXJ0aWNlcyIsInZlcnRleCIsIm5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24iLCJ1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uTmFtZSIsImZvckVhY2hVbml0RGVmaW5pdGlvbiIsInVuaXREZWZpbml0aW9uIiwibmFtZSIsImZyb21OYW1lQW5kVW5pdERlZmluaXRpb24iLCJmb3VuZFVuaXREZWZpbml0aW9uUHJvZHVjdGlvbiIsInNvbWUiLCJ1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25Gb3VuZCIsImlzRm91bmRCeVByb2R1Y3Rpb25OYW1lcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBLElBQU1BLFNBQVNDLFFBQVEsY0FBUixDQUFmOztBQUVBLElBQU1DLGFBQWFELFFBQVEsZ0JBQVIsQ0FBbkI7QUFBQSxJQUNNRSxhQUFhRixRQUFRLG1CQUFSLENBRG5CO0FBQUEsSUFFTUcsc0JB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ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgdGFyamFuID0gcmVxdWlyZSgnb2NjYW0tdGFyamFuJyk7XG5cbmNvbnN0IHBhcnNlclV0aWwgPSByZXF1aXJlKCcuLi91dGlsL3BhcnNlcicpLFxuICAgICAgUHJvZHVjdGlvbiA9IHJlcXVpcmUoJy4uL2JuZi9wcm9kdWN0aW9uJyksXG4gICAgICBOb25DeWNsaWNQcm9kdWN0aW9uID0gcmVxdWlyZSgnLi9wcm9kdWN0aW9uL25vbkN5Y2xpYycpLFxuICAgICAgVW5pdERlZmluaXRpb25Qcm9kdWN0aW9uID0gcmVxdWlyZSgnLi9wcm9kdWN0aW9uL3VuaXREZWZpbml0aW9uJyksXG4gICAgICBVbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uID0gcmVxdWlyZSgnLi9wcm9kdWN0aW9uL3VuaXREZWZpbml0aW9ucycpLFxuICAgICAgTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbiA9IHJlcXVpcmUoJy4vcHJvZHVjdGlvbi9ub25Vbml0RGVmaW5pdGlvbnMnKTtcblxuY29uc3QgeyBHcmFwaCB9ID0gdGFyamFuO1xuXG5jbGFzcyBjeWNsZXMge1xuICBzdGF0aWMgZWxpbWluYXRlKHByb2R1Y3Rpb25zKSB7XG4gICAgY29uc3QgZ3JhcGggPSBncmFwaEZyb21Qcm9kdWN0aW9ucyhwcm9kdWN0aW9ucyksXG4gICAgICAgICAgY29tcG9uZW50cyA9IGdyYXBoLmdlbmVyYXRlQ29tcG9uZW50cygpLFxuICAgICAgICAgIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zID0gbm9uQ3ljbGljUHJvZHVjdGlvbnNGcm9tQ29tcG9uZW50cyhjb21wb25lbnRzLCBwcm9kdWN0aW9ucyk7XG5cbiAgICBwcm9kdWN0aW9ucyA9IHByb2R1Y3Rpb25zLm1hcChmdW5jdGlvbihwcm9kdWN0aW9uKSB7XG4gICAgICBjb25zdCBwcm9kdWN0aW9uTmFtZSA9IHByb2R1Y3Rpb24uZ2V0TmFtZSgpLFxuICAgICAgICAgICAgbm9uQ3ljbGljUHJvZHVjdGlvbk5hbWUgPSBwcm9kdWN0aW9uTmFtZSwgLy8vXG4gICAgICAgICAgICBhbHJlYWR5Tm9uQ3ljbGljUHJvZHVjdGlvbk5hbWUgPSBwcm9kdWN0aW9uTmFtZSwgIC8vL1xuICAgICAgICAgICAgbm9uQ3ljbGljUHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24obm9uQ3ljbGljUHJvZHVjdGlvbk5hbWUsIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zKSxcbiAgICAgICAgICAgIGFscmVhZHlOb25DeWNsaWNQcm9kdWN0aW9uID0gcGFyc2VyVXRpbC5maW5kUHJvZHVjdGlvbihhbHJlYWR5Tm9uQ3ljbGljUHJvZHVjdGlvbk5hbWUsIHByb2R1Y3Rpb25zKTsgIC8vL1xuXG4gICAgICBwcm9kdWN0aW9uID0gbm9uQ3ljbGljUHJvZHVjdGlvbiB8fCBhbHJlYWR5Tm9uQ3ljbGljUHJvZHVjdGlvbjsgLy8vXG5cbiAgICAgIHJldHVybiBwcm9kdWN0aW9uO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHByb2R1Y3Rpb25zO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gY3ljbGVzO1xuXG5mdW5jdGlvbiBncmFwaEZyb21Qcm9kdWN0aW9ucyhwcm9kdWN0aW9ucykge1xuICBjb25zdCBncmFwaCA9IG5ldyBHcmFwaCgpLFxuICAgICAgICB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucyA9IHVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25zRnJvbVByb2R1Y3Rpb25zKHByb2R1Y3Rpb25zKTtcblxuICB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24pIHtcbiAgICBjb25zdCBwcm9kdWN0aW9uTmFtZSA9IHVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24uZ2V0TmFtZSgpLFxuICAgICAgICAgIHByb2R1Y3Rpb25OYW1lcyA9IHVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24uZ2V0UHJvZHVjdGlvbk5hbWVzKCksXG4gICAgICAgICAgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZXMgPSB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lc0Zyb21Qcm9kdWN0aW9uTmFtZXMocHJvZHVjdGlvbk5hbWVzLCB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucyksXG4gICAgICAgICAgdmVydGV4TmFtZSA9IHByb2R1Y3Rpb25OYW1lLCAgLy8vXG4gICAgICAgICAgZGVzY2VuZGFudFZlcnRleE5hbWVzID0gdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZXM7IC8vL1xuXG4gICAgZ3JhcGguYWRkVmVydGV4KHZlcnRleE5hbWUsIGRlc2NlbmRhbnRWZXJ0ZXhOYW1lcyk7XG4gIH0pO1xuXG4gIHJldHVybiBncmFwaDtcbn1cblxuZnVuY3Rpb24gdW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnNGcm9tUHJvZHVjdGlvbnMocHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgdW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMgPSBwcm9kdWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24odW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMsIHByb2R1Y3Rpb24pIHtcbiAgICBjb25zdCB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uID0gVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbi5mcm9tUHJvZHVjdGlvbihwcm9kdWN0aW9uKTtcblxuICAgIGlmICh1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uICE9PSBudWxsKSB7XG4gICAgICB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucy5wdXNoKHVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24pO1xuICAgIH1cblxuICAgIHJldHVybiB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucztcbiAgfSwgW10pO1xuXG4gIHJldHVybiB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucztcbn1cblxuZnVuY3Rpb24gdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZXNGcm9tUHJvZHVjdGlvbk5hbWVzKHByb2R1Y3Rpb25OYW1lcywgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9ucykge1xuICBjb25zdCB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lcyA9IHByb2R1Y3Rpb25OYW1lcy5yZWR1Y2UoZnVuY3Rpb24odW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZXMsIHByb2R1Y3Rpb25OYW1lKSB7XG4gICAgY29uc3QgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZSA9IHByb2R1Y3Rpb25OYW1lLCAgLy8vXG4gICAgICAgICAgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uID0gcGFyc2VyVXRpbC5maW5kUHJvZHVjdGlvbih1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lLCB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zKTtcbiAgICBcbiAgICBpZiAodW5pdERlZmluaXRpb25Qcm9kdWN0aW9uICE9PSBudWxsKSB7XG4gICAgICBjb25zdCB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lID0gcHJvZHVjdGlvbk5hbWU7ICAvLy9cblxuICAgICAgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZXMucHVzaCh1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lKTtcbiAgICB9ICAgIFxuICAgIFxuICAgIHJldHVybiB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lcztcbiAgfSwgW10pO1xuXG4gIHJldHVybiB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lcztcbn1cblxuZnVuY3Rpb24gbm9uQ3ljbGljUHJvZHVjdGlvbnNGcm9tQ29tcG9uZW50cyhjb21wb25lbnRzLCBwcm9kdWN0aW9ucykge1xuICBjb25zdCBub25DeWNsaWNQcm9kdWN0aW9ucyA9IGNvbXBvbmVudHMucmVkdWNlKGZ1bmN0aW9uKG5vbkN5Y2xpY1Byb2R1Y3Rpb25zLCBjb21wb25lbnQpIHtcbiAgICAgICAgICBjb25zdCBjb21wb25lbnROb25DeWNsaWMgPSBjb21wb25lbnQuaXNOb25DeWNsaWMoKTtcblxuICAgICAgICAgIGlmIChjb21wb25lbnROb25DeWNsaWMpIHtcbiAgICAgICAgICAgIG5vbkN5Y2xpY1Byb2R1Y3Rpb25Gcm9tQ29tcG9uZW50KGNvbXBvbmVudCwgcHJvZHVjdGlvbnMsIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm9uQ3ljbGljUHJvZHVjdGlvbnNGcm9tQ29tcG9uZW50KGNvbXBvbmVudCwgcHJvZHVjdGlvbnMsIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gbm9uQ3ljbGljUHJvZHVjdGlvbnM7XG4gICAgICAgIH0sIFtdKTtcblxuICByZXR1cm4gbm9uQ3ljbGljUHJvZHVjdGlvbnM7XG59XG5cbmZ1bmN0aW9uIG5vbkN5Y2xpY1Byb2R1Y3Rpb25Gcm9tQ29tcG9uZW50KGNvbXBvbmVudCwgcHJvZHVjdGlvbnMsIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zKSB7XG4gIGNvbnN0IGZpcnN0VmVydGV4ID0gY29tcG9uZW50LmdldEZpcnN0VmVydGV4KCksXG4gICAgICAgIGZpcnN0VmVydGV4TmFtZSA9IGZpcnN0VmVydGV4LmdldE5hbWUoKSxcbiAgICAgICAgcHJvZHVjdGlvbk5hbWUgPSBmaXJzdFZlcnRleE5hbWUsICAvLy9cbiAgICAgICAgcHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24ocHJvZHVjdGlvbk5hbWUsIHByb2R1Y3Rpb25zKTtcblxuICBpZiAocHJvZHVjdGlvbiAhPT0gbnVsbCkge1xuICAgIGNvbnN0IG5vbkN5Y2xpY1Byb2R1Y3Rpb24gPSBOb25DeWNsaWNQcm9kdWN0aW9uLmZyb21Qcm9kdWN0aW9uKHByb2R1Y3Rpb24pO1xuXG4gICAgbm9uQ3ljbGljUHJvZHVjdGlvbnMucHVzaChub25DeWNsaWNQcm9kdWN0aW9uKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21Db21wb25lbnQoY29tcG9uZW50LCBwcm9kdWN0aW9ucywgbm9uQ3ljbGljUHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9ucyA9IHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnNGcm9tQ29tcG9uZW50KGNvbXBvbmVudCwgcHJvZHVjdGlvbnMpLFxuICAgICAgICBmaXhlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25zID0gZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uc0Zyb21Qcm9kdWN0aW9ucyhwcm9kdWN0aW9ucyksXG4gICAgICAgIGFkZGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMgPSBbXSxcbiAgICAgICAgcmVtb3ZlZFVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnMgPSBbXTtcblxuICBsZXQgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uc0xlbmd0aCA9IHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnMubGVuZ3RoO1xuXG4gIHdoaWxlICh1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zTGVuZ3RoID4gMCkge1xuICAgIGxldCB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb24gPSB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zLnNoaWZ0KCksXG4gICAgICAgIHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbk5hbWUgPSB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb24uZ2V0TmFtZSgpO1xuXG4gICAgY29uc3QgcmVtb3ZlZFVuaXREZWZpbml0aW9uUHJvZHVjdGlvbiA9IHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbjsgLy8vXG5cbiAgICByZW1vdmVkVW5pdERlZmluaXRpb25Qcm9kdWN0aW9ucy5wdXNoKHJlbW92ZWRVbml0RGVmaW5pdGlvblByb2R1Y3Rpb24pO1xuXG4gICAgY29uc3QgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uVW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZSA9IHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbi5nZXRVbml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lKCksXG4gICAgICAgICAgZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uTmFtZSA9IHVuaXREZWZpbml0aW9uUHJvZHVjdGlvblVuaXREZWZpbml0aW9uUHJvZHVjdGlvbk5hbWUsICAvLy9cbiAgICAgICAgICBmaXhlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24gPSBwYXJzZXJVdGlsLmZpbmRQcm9kdWN0aW9uKGZpeGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbk5hbWUsIGZpeGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMpLFxuICAgICAgICAgIGFkZGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbk5hbWUgPSB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lOyAgLy8vXG5cbiAgICBsZXQgYWRkZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uID0gcGFyc2VyVXRpbC5maW5kUHJvZHVjdGlvbihhZGRlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25OYW1lLCBhZGRlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25zKTtcblxuICAgIGlmIChhZGRlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24gPT09IG51bGwpIHtcbiAgICAgIGFkZGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbiA9IFByb2R1Y3Rpb24uZnJvbVByb2R1Y3Rpb24oZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uKTtcblxuICAgICAgYWRkZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uLnNldE5hbWUoYWRkZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uTmFtZSk7XG5cbiAgICAgIGFkZGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMucHVzaChhZGRlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBmaXhlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25EZWZpbml0aW9ucyA9IGZpeGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbi5nZXREZWZpbml0aW9ucygpO1xuXG4gICAgICBhZGRlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24uYWRkRGVmaW5pdGlvbnMoZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uRGVmaW5pdGlvbnMpO1xuICAgIH1cblxuICAgIGNvbnN0IGludGVybWVkaWF0ZVVuaXREZWZpbml0aW9uUHJvZHVjdGlvbk5hbWUgPSB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25Vbml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lLCAvLy9cbiAgICAgICAgICBpbnRlcm1lZGlhdGVVbml0RGVmaW5pdGlvblByb2R1Y3Rpb24gPSBwYXJzZXJVdGlsLmZpbmRQcm9kdWN0aW9uKGludGVybWVkaWF0ZVVuaXREZWZpbml0aW9uUHJvZHVjdGlvbk5hbWUsIHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnMpO1xuXG4gICAgaWYgKGludGVybWVkaWF0ZVVuaXREZWZpbml0aW9uUHJvZHVjdGlvbiAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgaW50ZXJtZWRpYXRlVW5pdERlZmluaXRpb25Qcm9kdWN0aW9uVW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZSA9IGludGVybWVkaWF0ZVVuaXREZWZpbml0aW9uUHJvZHVjdGlvbi5nZXRVbml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lKCksXG4gICAgICAgICAgICBmaXJzdFByb2R1Y3Rpb25OYW1lID0gdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTmFtZSwgIC8vL1xuICAgICAgICAgICAgc2Vjb25kUHJvZHVjdGlvbk5hbWUgPSBpbnRlcm1lZGlhdGVVbml0RGVmaW5pdGlvblByb2R1Y3Rpb25Vbml0RGVmaW5pdGlvblByb2R1Y3Rpb25OYW1lLCAgLy8vXG4gICAgICAgICAgICB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25Ob25DeWNsaWMgPSAoZmlyc3RQcm9kdWN0aW9uTmFtZSAhPT0gc2Vjb25kUHJvZHVjdGlvbk5hbWUpO1xuXG4gICAgICBpZiAodW5pdERlZmluaXRpb25Qcm9kdWN0aW9uTm9uQ3ljbGljKSB7XG4gICAgICAgIHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbiA9IGZpbmRVbml0RGVmaW5pdGlvblByb2R1Y3Rpb24oZmlyc3RQcm9kdWN0aW9uTmFtZSwgc2Vjb25kUHJvZHVjdGlvbk5hbWUsIHJlbW92ZWRVbml0RGVmaW5pdGlvblByb2R1Y3Rpb25zKTtcblxuICAgICAgICBpZiAodW5pdERlZmluaXRpb25Qcm9kdWN0aW9uID09PSBudWxsKSB7XG4gICAgICAgICAgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uID0gVW5pdERlZmluaXRpb25Qcm9kdWN0aW9uLmZyb21Qcm9kdWN0aW9uTmFtZXMoZmlyc3RQcm9kdWN0aW9uTmFtZSwgc2Vjb25kUHJvZHVjdGlvbk5hbWUpO1xuXG4gICAgICAgICAgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9ucy51bnNoaWZ0KHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zTGVuZ3RoID0gdW5pdERlZmluaXRpb25Qcm9kdWN0aW9ucy5sZW5ndGg7XG4gIH1cblxuICBub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21GaXhlZEFuZEFkZGVkUHJvZHVjdGlvbnMoZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucywgYWRkZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucywgbm9uQ3ljbGljUHJvZHVjdGlvbnMpO1xufVxuXG5mdW5jdGlvbiBub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21GaXhlZEFuZEFkZGVkUHJvZHVjdGlvbnMoZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucywgYWRkZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucywgbm9uQ3ljbGljUHJvZHVjdGlvbnMpIHtcbiAgZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGZpeGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbikge1xuICAgIGNvbnN0IG5vbkN5Y2xpY1Byb2R1Y3Rpb24gPSBmaXhlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24sIC8vL1xuICAgICAgICAgIG5vbkN5Y2xpY1Byb2R1Y3Rpb25OYW1lID0gbm9uQ3ljbGljUHJvZHVjdGlvbi5nZXROYW1lKCksXG4gICAgICAgICAgYWRkZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uTmFtZSA9IG5vbkN5Y2xpY1Byb2R1Y3Rpb25OYW1lLCAvLy9cbiAgICAgICAgICBhZGRlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24gPSBwYXJzZXJVdGlsLmZpbmRQcm9kdWN0aW9uKGFkZGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbk5hbWUsIGFkZGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMpO1xuXG4gICAgaWYgKGFkZGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbiAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgYWRkZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uRGVmaW5pdGlvbnMgPSBhZGRlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24uZ2V0RGVmaW5pdGlvbnMoKTtcblxuICAgICAgbm9uQ3ljbGljUHJvZHVjdGlvbi5hZGREZWZpbml0aW9ucyhhZGRlZE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25EZWZpbml0aW9ucyk7XG4gICAgfVxuXG4gICAgY29uc3Qgbm9uQ3ljbGljUHJvZHVjdGlvbkRlZmluaXRpb25zRXhpc3QgPSBub25DeWNsaWNQcm9kdWN0aW9uLmRvRGVmaW5pdGlvbnNFeGlzdCgpO1xuXG4gICAgaWYgKG5vbkN5Y2xpY1Byb2R1Y3Rpb25EZWZpbml0aW9uc0V4aXN0KSB7XG4gICAgICBub25DeWNsaWNQcm9kdWN0aW9ucy5wdXNoKG5vbkN5Y2xpY1Byb2R1Y3Rpb24pO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnNGcm9tQ29tcG9uZW50KGNvbXBvbmVudCwgcHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgdW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMgPSB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uc0Zyb21Db21wb25lbnQoY29tcG9uZW50LCBwcm9kdWN0aW9ucyksXG4gICAgICAgIHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnMgPSB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zRnJvbVVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25zKHVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb25zKTtcblxuICByZXR1cm4gdW5pdERlZmluaXRpb25Qcm9kdWN0aW9ucztcbn1cblxuZnVuY3Rpb24gdW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnNGcm9tQ29tcG9uZW50KGNvbXBvbmVudCwgcHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgdW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMgPSBjb21wb25lbnQubWFwVmVydGljZXMoZnVuY3Rpb24odmVydGV4KSB7XG4gICAgY29uc3QgdmVydGV4TmFtZSA9IHZlcnRleC5nZXROYW1lKCksXG4gICAgICAgICAgcHJvZHVjdGlvbk5hbWUgPSB2ZXJ0ZXhOYW1lLCAgLy8vXG4gICAgICAgICAgcHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24ocHJvZHVjdGlvbk5hbWUsIHByb2R1Y3Rpb25zKSxcbiAgICAgICAgICB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uID0gVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbi5mcm9tUHJvZHVjdGlvbihwcm9kdWN0aW9uKTtcblxuICAgIHJldHVybiB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uO1xuICB9KTtcblxuICByZXR1cm4gdW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnM7XG59XG5cbmZ1bmN0aW9uIGZpeGVkTm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnNGcm9tUHJvZHVjdGlvbnMocHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucyA9IHByb2R1Y3Rpb25zLm1hcChmdW5jdGlvbihwcm9kdWN0aW9uKSB7XG4gICAgY29uc3Qgbm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbiA9IE5vblVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24uZnJvbVByb2R1Y3Rpb24ocHJvZHVjdGlvbiksXG4gICAgICAgICAgZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uID0gbm9uVW5pdERlZmluaXRpb25zUHJvZHVjdGlvbjsgLy8vXG5cbiAgICByZXR1cm4gZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uO1xuICB9KTtcblxuICByZXR1cm4gZml4ZWROb25Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucztcbn1cblxuZnVuY3Rpb24gdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uc0Zyb21Vbml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucyh1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9ucykge1xuICBjb25zdCB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zID0gdW5pdERlZmluaXRpb25zUHJvZHVjdGlvbnMucmVkdWNlKGZ1bmN0aW9uKHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnMsIHVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24pIHtcbiAgICBjb25zdCB1bml0RGVmaW5pdGlvbnNQcm9kdWN0aW9uTmFtZSA9IHVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24uZ2V0TmFtZSgpO1xuICAgIFxuICAgIHVuaXREZWZpbml0aW9uc1Byb2R1Y3Rpb24uZm9yRWFjaFVuaXREZWZpbml0aW9uKGZ1bmN0aW9uKHVuaXREZWZpbml0aW9uKSB7XG4gICAgICBjb25zdCBuYW1lID0gdW5pdERlZmluaXRpb25zUHJvZHVjdGlvbk5hbWUsIC8vL1xuICAgICAgICAgICAgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uID0gVW5pdERlZmluaXRpb25Qcm9kdWN0aW9uLmZyb21OYW1lQW5kVW5pdERlZmluaXRpb24obmFtZSwgdW5pdERlZmluaXRpb24pO1xuXG4gICAgICB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zLnB1c2godW5pdERlZmluaXRpb25Qcm9kdWN0aW9uKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnM7XG59XG5cbmZ1bmN0aW9uIGZpbmRVbml0RGVmaW5pdGlvblByb2R1Y3Rpb24oZmlyc3RQcm9kdWN0aW9uTmFtZSwgc2Vjb25kUHJvZHVjdGlvbk5hbWUsIHVuaXREZWZpbml0aW9uUHJvZHVjdGlvbnMpIHtcbiAgbGV0IGZvdW5kVW5pdERlZmluaXRpb25Qcm9kdWN0aW9uID0gbnVsbDtcblxuICB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25zLnNvbWUoZnVuY3Rpb24odW5pdERlZmluaXRpb25Qcm9kdWN0aW9uKSB7XG4gICAgY29uc3QgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uRm91bmQgPSB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb24uaXNGb3VuZEJ5UHJvZHVjdGlvbk5hbWVzKGZpcnN0UHJvZHVjdGlvbk5hbWUsIHNlY29uZFByb2R1Y3Rpb25OYW1lKTtcblxuICAgIGlmICh1bml0RGVmaW5pdGlvblByb2R1Y3Rpb25Gb3VuZCkge1xuICAgICAgZm91bmRVbml0RGVmaW5pdGlvblByb2R1Y3Rpb24gPSB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb247XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgdW5pdERlZmluaXRpb25Qcm9kdWN0aW9uID0gZm91bmRVbml0RGVmaW5pdGlvblByb2R1Y3Rpb247IC8vL1xuXG4gIHJldHVybiB1bml0RGVmaW5pdGlvblByb2R1Y3Rpb247XG59XG4iXX0=