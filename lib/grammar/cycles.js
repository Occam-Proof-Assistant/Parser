'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Graph = require('./graph'),
    parserUtil = require('../util/parser'),
    Production = require('../common/production'),
    UnitRuleProduction = require('./production/unitRule'),
    UnitRulesProduction = require('./production/unitRules'),
    NonUnitRulesProduction = require('./production/nonUnitRules');

var cycles = function () {
  function cycles() {
    _classCallCheck(this, cycles);
  }

  _createClass(cycles, null, [{
    key: 'eliminate',
    value: function eliminate(productions) {
      var unitRulesProductions = unitRulesProductionsFromProductions(productions),
          graph = Graph.fromUnitRulesProductions(unitRulesProductions),
          components = graph.getComponents(),
          nonCyclicProductions = nonCyclicProductionsFromComponents(components, productions);

      productions = nonCyclicProductions; ///

      return productions;
    }
  }]);

  return cycles;
}();

module.exports = cycles;

function unitRulesProductionsFromProductions(productions) {
  var unitRulesProductions = productions.reduce(function (unitRulesProductions, production) {
    var unitRulesProduction = UnitRulesProduction.fromProduction(production);

    if (unitRulesProduction !== null) {
      unitRulesProductions.push(unitRulesProduction);
    }

    return unitRulesProductions;
  }, []);

  return unitRulesProductions;
}

function nonCyclicProductionsFromComponents(components, productions) {
  var nonCyclicProductions = components.reduce(function (nonCyclicProductions, component) {
    var componentNonCyclic = component.isNonCyclic();

    if (componentNonCyclic) {
      nonCyclicProductionFromComponent(component, productions, nonCyclicProductions);
    } else {
      nonCyclicProductionsFromComponent(component, productions, nonCyclicProductions);
    }

    return nonCyclicProductions;
  }, []);

  return nonCyclicProductions;
}

function nonCyclicProductionFromComponent(component, productions, nonCyclicProductions) {
  var firstVertex = component.getFirstVertex(),
      firstVertexName = firstVertex.getName(),
      nonCyclicProductionName = firstVertexName,
      ///
  nonCyclicProduction = parserUtil.findProduction(nonCyclicProductionName, productions);

  nonCyclicProductions.push(nonCyclicProduction);
}

function nonCyclicProductionsFromComponent(component, productions, nonCyclicProductions) {
  productions = productionsFromComponent(component, productions); ///

  var fixedProductions = fixedProductionsFromProductions(productions),
      unitRuleProductions = unitRuleProductionsFromProductions(productions),
      removedProductions = [],
      addedProductions = [];

  var unitRuleProductionsLength = unitRuleProductions.length;

  while (unitRuleProductionsLength > 0) {
    var unitRuleProduction = unitRuleProductions.shift(),
        unitRuleProductionName = unitRuleProduction.getName();

    var removedProduction = unitRuleProduction;

    removedProductions.push(removedProduction);

    var unitRuleProductionUnitRuleProductionName = unitRuleProduction.getUnitRuleProductionName(),
        fixedProductionName = unitRuleProductionUnitRuleProductionName,
        ///
    addedProductionName = unitRuleProductionName,
        ///
    fixedProduction = parserUtil.findProduction(fixedProductionName, fixedProductions);

    var addedProduction = parserUtil.findProduction(addedProductionName, addedProductions);

    if (addedProduction === null) {
      addedProduction = Production.fromProduction(fixedProduction);

      addedProduction.setName(addedProductionName);

      addedProductions.push(addedProduction);
    } else {
      var fixedProductionRules = fixedProduction.getRules();

      addedProduction.concatRules(fixedProductionRules);
    }

    var intermediateProductionName = unitRuleProductionUnitRuleProductionName,
        ///
    intermediateProduction = parserUtil.findProduction(intermediateProductionName, unitRuleProductions);

    if (intermediateProduction !== null) {
      var intermediateProductionUnitRuleProductionName = intermediateProduction.getUnitRuleProductionName(),
          _unitRuleProductionUnitRuleProductionName = intermediateProductionUnitRuleProductionName,
          ///
      unitRuleProductionNonCyclic = unitRuleProductionName !== _unitRuleProductionUnitRuleProductionName;

      if (unitRuleProductionNonCyclic) {
        unitRuleProduction = findUnitRuleProduction(unitRuleProductionName, _unitRuleProductionUnitRuleProductionName, removedProductions);

        if (unitRuleProduction === null) {
          unitRuleProduction = UnitRuleProduction.fromNameAndUnitRuleProductionName(unitRuleProductionName, _unitRuleProductionUnitRuleProductionName);

          unitRuleProductions.unshift(unitRuleProduction);
        }
      }
    }

    unitRuleProductionsLength = unitRuleProductions.length;
  }

  nonCyclicProductionsFromFixedAndAddedProductions(fixedProductions, addedProductions, nonCyclicProductions);
}

function nonCyclicProductionsFromFixedAndAddedProductions(fixedProductions, addedProductions, nonCyclicProductions) {
  fixedProductions.forEach(function (fixedProduction) {
    var nonCyclicProduction = fixedProduction,
        ///
    nonCyclicProductionName = nonCyclicProduction.getName(),
        addedProductionName = nonCyclicProductionName,
        ///
    addedProduction = parserUtil.findProduction(addedProductionName, addedProductions);

    if (addedProduction !== null) {
      var addedProductionRules = addedProduction.getRules();

      nonCyclicProduction.concatRules(addedProductionRules);
    }

    nonCyclicProductions.push(nonCyclicProduction);
  });
}

function productionsFromComponent(component, productions) {
  productions = component.mapVertices(function (vertex) {
    var vertexName = vertex.getName(),
        productionName = vertexName,
        ///
    production = parserUtil.findProduction(productionName, productions);

    return production;
  });

  return productions;
}

function unitRuleProductionsFromProductions(productions) {
  var unitRuleProductions = productions.reduce(function (unitRuleProductions, production) {
    var name = production.getName(),
        unitRulesProduction = UnitRulesProduction.fromProduction(production);

    unitRulesProduction.forEachUnitRule(function (unitRule) {
      var unitRuleProduction = UnitRuleProduction.fromNameAndUnitRule(name, unitRule);

      unitRuleProductions.push(unitRuleProduction);
    });

    return unitRuleProductions;
  }, []);

  return unitRuleProductions;
}

function fixedProductionsFromProductions(productions) {
  var fixedProductions = productions.map(function (production) {
    var nonUnitProduction = NonUnitRulesProduction.fromProduction(production),
        fixedProduction = nonUnitProduction; ///

    return fixedProduction;
  });

  return fixedProductions;
}

function findUnitRuleProduction(productionName, unitRuleProductionName, unitRuleProductions) {
  var firstProductionName = productionName,
      ///
  secondProductionName = unitRuleProductionName; ///

  var foundUnitRuleProduction = null;

  unitRuleProductions.some(function (unitRuleProduction) {
    var unitRuleProductionFound = unitRuleProduction.isFoundByProductionNames(firstProductionName, secondProductionName);

    if (unitRuleProductionFound) {
      foundUnitRuleProduction = unitRuleProduction;

      return true;
    }
  });

  var unitRuleProduction = foundUnitRuleProduction; ///

  return unitRuleProduction;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9ncmFtbWFyL2N5Y2xlcy5qcyJdLCJuYW1lcyI6WyJHcmFwaCIsInJlcXVpcmUiLCJwYXJzZXJVdGlsIiwiUHJvZHVjdGlvbiIsIlVuaXRSdWxlUHJvZHVjdGlvbiIsIlVuaXRSdWxlc1Byb2R1Y3Rpb24iLCJOb25Vbml0UnVsZXNQcm9kdWN0aW9uIiwiY3ljbGVzIiwicHJvZHVjdGlvbnMiLCJ1bml0UnVsZXNQcm9kdWN0aW9ucyIsInVuaXRSdWxlc1Byb2R1Y3Rpb25zRnJvbVByb2R1Y3Rpb25zIiwiZ3JhcGgiLCJmcm9tVW5pdFJ1bGVzUHJvZHVjdGlvbnMiLCJjb21wb25lbnRzIiwiZ2V0Q29tcG9uZW50cyIsIm5vbkN5Y2xpY1Byb2R1Y3Rpb25zIiwibm9uQ3ljbGljUHJvZHVjdGlvbnNGcm9tQ29tcG9uZW50cyIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZWR1Y2UiLCJwcm9kdWN0aW9uIiwidW5pdFJ1bGVzUHJvZHVjdGlvbiIsImZyb21Qcm9kdWN0aW9uIiwicHVzaCIsImNvbXBvbmVudCIsImNvbXBvbmVudE5vbkN5Y2xpYyIsImlzTm9uQ3ljbGljIiwibm9uQ3ljbGljUHJvZHVjdGlvbkZyb21Db21wb25lbnQiLCJub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21Db21wb25lbnQiLCJmaXJzdFZlcnRleCIsImdldEZpcnN0VmVydGV4IiwiZmlyc3RWZXJ0ZXhOYW1lIiwiZ2V0TmFtZSIsIm5vbkN5Y2xpY1Byb2R1Y3Rpb25OYW1lIiwibm9uQ3ljbGljUHJvZHVjdGlvbiIsImZpbmRQcm9kdWN0aW9uIiwicHJvZHVjdGlvbnNGcm9tQ29tcG9uZW50IiwiZml4ZWRQcm9kdWN0aW9ucyIsImZpeGVkUHJvZHVjdGlvbnNGcm9tUHJvZHVjdGlvbnMiLCJ1bml0UnVsZVByb2R1Y3Rpb25zIiwidW5pdFJ1bGVQcm9kdWN0aW9uc0Zyb21Qcm9kdWN0aW9ucyIsInJlbW92ZWRQcm9kdWN0aW9ucyIsImFkZGVkUHJvZHVjdGlvbnMiLCJ1bml0UnVsZVByb2R1Y3Rpb25zTGVuZ3RoIiwibGVuZ3RoIiwidW5pdFJ1bGVQcm9kdWN0aW9uIiwic2hpZnQiLCJ1bml0UnVsZVByb2R1Y3Rpb25OYW1lIiwicmVtb3ZlZFByb2R1Y3Rpb24iLCJ1bml0UnVsZVByb2R1Y3Rpb25Vbml0UnVsZVByb2R1Y3Rpb25OYW1lIiwiZ2V0VW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSIsImZpeGVkUHJvZHVjdGlvbk5hbWUiLCJhZGRlZFByb2R1Y3Rpb25OYW1lIiwiZml4ZWRQcm9kdWN0aW9uIiwiYWRkZWRQcm9kdWN0aW9uIiwic2V0TmFtZSIsImZpeGVkUHJvZHVjdGlvblJ1bGVzIiwiZ2V0UnVsZXMiLCJjb25jYXRSdWxlcyIsImludGVybWVkaWF0ZVByb2R1Y3Rpb25OYW1lIiwiaW50ZXJtZWRpYXRlUHJvZHVjdGlvbiIsImludGVybWVkaWF0ZVByb2R1Y3Rpb25Vbml0UnVsZVByb2R1Y3Rpb25OYW1lIiwidW5pdFJ1bGVQcm9kdWN0aW9uTm9uQ3ljbGljIiwiZmluZFVuaXRSdWxlUHJvZHVjdGlvbiIsImZyb21OYW1lQW5kVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSIsInVuc2hpZnQiLCJub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21GaXhlZEFuZEFkZGVkUHJvZHVjdGlvbnMiLCJmb3JFYWNoIiwiYWRkZWRQcm9kdWN0aW9uUnVsZXMiLCJtYXBWZXJ0aWNlcyIsInZlcnRleCIsInZlcnRleE5hbWUiLCJwcm9kdWN0aW9uTmFtZSIsIm5hbWUiLCJmb3JFYWNoVW5pdFJ1bGUiLCJ1bml0UnVsZSIsImZyb21OYW1lQW5kVW5pdFJ1bGUiLCJtYXAiLCJub25Vbml0UHJvZHVjdGlvbiIsImZpcnN0UHJvZHVjdGlvbk5hbWUiLCJzZWNvbmRQcm9kdWN0aW9uTmFtZSIsImZvdW5kVW5pdFJ1bGVQcm9kdWN0aW9uIiwic29tZSIsInVuaXRSdWxlUHJvZHVjdGlvbkZvdW5kIiwiaXNGb3VuZEJ5UHJvZHVjdGlvbk5hbWVzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUEsSUFBTUEs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dENRLHlCQUF1QmpDLHNCQUQ3QixDQUQyRixDQUVyQzs7QUFFdEQsTUFBSWtDLDBCQUEwQixJQUE5Qjs7QUFFQTFDLHNCQUFvQjJDLElBQXBCLENBQXlCLFVBQVNyQyxrQkFBVCxFQUE2QjtBQUNwRCxRQUFNc0MsMEJBQTBCdEMsbUJBQW1CdUMsd0JBQW5CLENBQTRDTCxtQkFBNUMsRUFBaUVDLG9CQUFqRSxDQUFoQzs7QUFFQSxRQUFJRyx1QkFBSixFQUE2QjtBQUMzQkYsZ0NBQTBCcEMsa0JBQTFCOztBQUVBLGFBQU8sSUFBUDtBQUNEO0FBQ0YsR0FSRDs7QUFVQSxNQUFNQSxxQkFBcUJvQyx1QkFBM0IsQ0FoQjJGLENBZ0J2Qzs7QUFFcEQsU0FBT3BDLGtCQUFQO0FBQ0QiLCJmaWxlIjoiY3ljbGVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBHcmFwaCA9IHJlcXVpcmUoJy4vZ3JhcGgnKSxcbiAgICAgIHBhcnNlclV0aWwgPSByZXF1aXJlKCcuLi91dGlsL3BhcnNlcicpLFxuICAgICAgUHJvZHVjdGlvbiA9IHJlcXVpcmUoJy4uL2NvbW1vbi9wcm9kdWN0aW9uJyksXG4gICAgICBVbml0UnVsZVByb2R1Y3Rpb24gPSByZXF1aXJlKCcuL3Byb2R1Y3Rpb24vdW5pdFJ1bGUnKSxcbiAgICAgIFVuaXRSdWxlc1Byb2R1Y3Rpb24gPSByZXF1aXJlKCcuL3Byb2R1Y3Rpb24vdW5pdFJ1bGVzJyksXG4gICAgICBOb25Vbml0UnVsZXNQcm9kdWN0aW9uID0gcmVxdWlyZSgnLi9wcm9kdWN0aW9uL25vblVuaXRSdWxlcycpO1xuXG5jbGFzcyBjeWNsZXMge1xuICBzdGF0aWMgZWxpbWluYXRlKHByb2R1Y3Rpb25zKSB7XG4gICAgY29uc3QgdW5pdFJ1bGVzUHJvZHVjdGlvbnMgPSB1bml0UnVsZXNQcm9kdWN0aW9uc0Zyb21Qcm9kdWN0aW9ucyhwcm9kdWN0aW9ucyksXG4gICAgICAgICAgZ3JhcGggPSBHcmFwaC5mcm9tVW5pdFJ1bGVzUHJvZHVjdGlvbnModW5pdFJ1bGVzUHJvZHVjdGlvbnMpLFxuICAgICAgICAgIGNvbXBvbmVudHMgPSBncmFwaC5nZXRDb21wb25lbnRzKCksXG4gICAgICAgICAgbm9uQ3ljbGljUHJvZHVjdGlvbnMgPSBub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21Db21wb25lbnRzKGNvbXBvbmVudHMsIHByb2R1Y3Rpb25zKTtcblxuICAgIHByb2R1Y3Rpb25zID0gbm9uQ3ljbGljUHJvZHVjdGlvbnM7IC8vL1xuXG4gICAgcmV0dXJuIHByb2R1Y3Rpb25zO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gY3ljbGVzO1xuXG5mdW5jdGlvbiB1bml0UnVsZXNQcm9kdWN0aW9uc0Zyb21Qcm9kdWN0aW9ucyhwcm9kdWN0aW9ucykge1xuICBjb25zdCB1bml0UnVsZXNQcm9kdWN0aW9ucyA9IHByb2R1Y3Rpb25zLnJlZHVjZShmdW5jdGlvbih1bml0UnVsZXNQcm9kdWN0aW9ucywgcHJvZHVjdGlvbikge1xuICAgIGNvbnN0IHVuaXRSdWxlc1Byb2R1Y3Rpb24gPSBVbml0UnVsZXNQcm9kdWN0aW9uLmZyb21Qcm9kdWN0aW9uKHByb2R1Y3Rpb24pO1xuXG4gICAgaWYgKHVuaXRSdWxlc1Byb2R1Y3Rpb24gIT09IG51bGwpIHtcbiAgICAgIHVuaXRSdWxlc1Byb2R1Y3Rpb25zLnB1c2godW5pdFJ1bGVzUHJvZHVjdGlvbik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHVuaXRSdWxlc1Byb2R1Y3Rpb25zO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIHVuaXRSdWxlc1Byb2R1Y3Rpb25zO1xufVxuXG5mdW5jdGlvbiBub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21Db21wb25lbnRzKGNvbXBvbmVudHMsIHByb2R1Y3Rpb25zKSB7XG4gIGNvbnN0IG5vbkN5Y2xpY1Byb2R1Y3Rpb25zID0gY29tcG9uZW50cy5yZWR1Y2UoZnVuY3Rpb24obm9uQ3ljbGljUHJvZHVjdGlvbnMsIGNvbXBvbmVudCkge1xuICAgICAgICAgIGNvbnN0IGNvbXBvbmVudE5vbkN5Y2xpYyA9IGNvbXBvbmVudC5pc05vbkN5Y2xpYygpO1xuXG4gICAgICAgICAgaWYgKGNvbXBvbmVudE5vbkN5Y2xpYykge1xuICAgICAgICAgICAgbm9uQ3ljbGljUHJvZHVjdGlvbkZyb21Db21wb25lbnQoY29tcG9uZW50LCBwcm9kdWN0aW9ucywgbm9uQ3ljbGljUHJvZHVjdGlvbnMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub25DeWNsaWNQcm9kdWN0aW9uc0Zyb21Db21wb25lbnQoY29tcG9uZW50LCBwcm9kdWN0aW9ucywgbm9uQ3ljbGljUHJvZHVjdGlvbnMpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBub25DeWNsaWNQcm9kdWN0aW9ucztcbiAgICAgICAgfSwgW10pO1xuXG4gIHJldHVybiBub25DeWNsaWNQcm9kdWN0aW9ucztcbn1cblxuZnVuY3Rpb24gbm9uQ3ljbGljUHJvZHVjdGlvbkZyb21Db21wb25lbnQoY29tcG9uZW50LCBwcm9kdWN0aW9ucywgbm9uQ3ljbGljUHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgZmlyc3RWZXJ0ZXggPSBjb21wb25lbnQuZ2V0Rmlyc3RWZXJ0ZXgoKSxcbiAgICAgICAgZmlyc3RWZXJ0ZXhOYW1lID0gZmlyc3RWZXJ0ZXguZ2V0TmFtZSgpLFxuICAgICAgICBub25DeWNsaWNQcm9kdWN0aW9uTmFtZSA9IGZpcnN0VmVydGV4TmFtZSwgIC8vL1xuICAgICAgICBub25DeWNsaWNQcm9kdWN0aW9uID0gcGFyc2VyVXRpbC5maW5kUHJvZHVjdGlvbihub25DeWNsaWNQcm9kdWN0aW9uTmFtZSwgcHJvZHVjdGlvbnMpO1xuXG4gIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zLnB1c2gobm9uQ3ljbGljUHJvZHVjdGlvbik7XG59XG5cbmZ1bmN0aW9uIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zRnJvbUNvbXBvbmVudChjb21wb25lbnQsIHByb2R1Y3Rpb25zLCBub25DeWNsaWNQcm9kdWN0aW9ucykge1xuICBwcm9kdWN0aW9ucyA9IHByb2R1Y3Rpb25zRnJvbUNvbXBvbmVudChjb21wb25lbnQsIHByb2R1Y3Rpb25zKTsgLy8vXG5cbiAgY29uc3QgZml4ZWRQcm9kdWN0aW9ucyA9IGZpeGVkUHJvZHVjdGlvbnNGcm9tUHJvZHVjdGlvbnMocHJvZHVjdGlvbnMpLFxuICAgICAgICB1bml0UnVsZVByb2R1Y3Rpb25zID0gdW5pdFJ1bGVQcm9kdWN0aW9uc0Zyb21Qcm9kdWN0aW9ucyhwcm9kdWN0aW9ucyksXG4gICAgICAgIHJlbW92ZWRQcm9kdWN0aW9ucyA9IFtdLFxuICAgICAgICBhZGRlZFByb2R1Y3Rpb25zID0gW107XG5cbiAgbGV0IHVuaXRSdWxlUHJvZHVjdGlvbnNMZW5ndGggPSB1bml0UnVsZVByb2R1Y3Rpb25zLmxlbmd0aDtcblxuICB3aGlsZSAodW5pdFJ1bGVQcm9kdWN0aW9uc0xlbmd0aCA+IDApIHtcbiAgICBsZXQgdW5pdFJ1bGVQcm9kdWN0aW9uID0gdW5pdFJ1bGVQcm9kdWN0aW9ucy5zaGlmdCgpLFxuICAgICAgICB1bml0UnVsZVByb2R1Y3Rpb25OYW1lID0gdW5pdFJ1bGVQcm9kdWN0aW9uLmdldE5hbWUoKTtcblxuICAgIGNvbnN0IHJlbW92ZWRQcm9kdWN0aW9uID0gdW5pdFJ1bGVQcm9kdWN0aW9uO1xuXG4gICAgcmVtb3ZlZFByb2R1Y3Rpb25zLnB1c2gocmVtb3ZlZFByb2R1Y3Rpb24pO1xuXG4gICAgY29uc3QgdW5pdFJ1bGVQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSA9IHVuaXRSdWxlUHJvZHVjdGlvbi5nZXRVbml0UnVsZVByb2R1Y3Rpb25OYW1lKCksXG4gICAgICAgICAgZml4ZWRQcm9kdWN0aW9uTmFtZSA9IHVuaXRSdWxlUHJvZHVjdGlvblVuaXRSdWxlUHJvZHVjdGlvbk5hbWUsICAvLy9cbiAgICAgICAgICBhZGRlZFByb2R1Y3Rpb25OYW1lID0gdW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgIC8vL1xuICAgICAgICAgIGZpeGVkUHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24oZml4ZWRQcm9kdWN0aW9uTmFtZSwgZml4ZWRQcm9kdWN0aW9ucyk7XG5cbiAgICBsZXQgYWRkZWRQcm9kdWN0aW9uID0gcGFyc2VyVXRpbC5maW5kUHJvZHVjdGlvbihhZGRlZFByb2R1Y3Rpb25OYW1lLCBhZGRlZFByb2R1Y3Rpb25zKTtcblxuICAgIGlmIChhZGRlZFByb2R1Y3Rpb24gPT09IG51bGwpIHtcbiAgICAgIGFkZGVkUHJvZHVjdGlvbiA9IFByb2R1Y3Rpb24uZnJvbVByb2R1Y3Rpb24oZml4ZWRQcm9kdWN0aW9uKTtcblxuICAgICAgYWRkZWRQcm9kdWN0aW9uLnNldE5hbWUoYWRkZWRQcm9kdWN0aW9uTmFtZSk7XG5cbiAgICAgIGFkZGVkUHJvZHVjdGlvbnMucHVzaChhZGRlZFByb2R1Y3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBmaXhlZFByb2R1Y3Rpb25SdWxlcyA9IGZpeGVkUHJvZHVjdGlvbi5nZXRSdWxlcygpO1xuXG4gICAgICBhZGRlZFByb2R1Y3Rpb24uY29uY2F0UnVsZXMoZml4ZWRQcm9kdWN0aW9uUnVsZXMpO1xuICAgIH1cblxuICAgIGNvbnN0IGludGVybWVkaWF0ZVByb2R1Y3Rpb25OYW1lID0gdW5pdFJ1bGVQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgLy8vXG4gICAgICAgICAgaW50ZXJtZWRpYXRlUHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24oaW50ZXJtZWRpYXRlUHJvZHVjdGlvbk5hbWUsIHVuaXRSdWxlUHJvZHVjdGlvbnMpO1xuXG4gICAgaWYgKGludGVybWVkaWF0ZVByb2R1Y3Rpb24gIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGludGVybWVkaWF0ZVByb2R1Y3Rpb25Vbml0UnVsZVByb2R1Y3Rpb25OYW1lID0gaW50ZXJtZWRpYXRlUHJvZHVjdGlvbi5nZXRVbml0UnVsZVByb2R1Y3Rpb25OYW1lKCksXG4gICAgICAgICAgICB1bml0UnVsZVByb2R1Y3Rpb25Vbml0UnVsZVByb2R1Y3Rpb25OYW1lID0gaW50ZXJtZWRpYXRlUHJvZHVjdGlvblVuaXRSdWxlUHJvZHVjdGlvbk5hbWUsICAvLy9cbiAgICAgICAgICAgIHVuaXRSdWxlUHJvZHVjdGlvbk5vbkN5Y2xpYyA9ICh1bml0UnVsZVByb2R1Y3Rpb25OYW1lICE9PSB1bml0UnVsZVByb2R1Y3Rpb25Vbml0UnVsZVByb2R1Y3Rpb25OYW1lKTtcblxuICAgICAgaWYgKHVuaXRSdWxlUHJvZHVjdGlvbk5vbkN5Y2xpYykge1xuICAgICAgICB1bml0UnVsZVByb2R1Y3Rpb24gPSBmaW5kVW5pdFJ1bGVQcm9kdWN0aW9uKHVuaXRSdWxlUHJvZHVjdGlvbk5hbWUsIHVuaXRSdWxlUHJvZHVjdGlvblVuaXRSdWxlUHJvZHVjdGlvbk5hbWUsIHJlbW92ZWRQcm9kdWN0aW9ucyk7XG5cbiAgICAgICAgaWYgKHVuaXRSdWxlUHJvZHVjdGlvbiA9PT0gbnVsbCkge1xuICAgICAgICAgIHVuaXRSdWxlUHJvZHVjdGlvbiA9IFVuaXRSdWxlUHJvZHVjdGlvbi5mcm9tTmFtZUFuZFVuaXRSdWxlUHJvZHVjdGlvbk5hbWUodW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgdW5pdFJ1bGVQcm9kdWN0aW9uVW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSk7XG5cbiAgICAgICAgICB1bml0UnVsZVByb2R1Y3Rpb25zLnVuc2hpZnQodW5pdFJ1bGVQcm9kdWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHVuaXRSdWxlUHJvZHVjdGlvbnNMZW5ndGggPSB1bml0UnVsZVByb2R1Y3Rpb25zLmxlbmd0aDtcbiAgfVxuXG4gIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zRnJvbUZpeGVkQW5kQWRkZWRQcm9kdWN0aW9ucyhmaXhlZFByb2R1Y3Rpb25zLCBhZGRlZFByb2R1Y3Rpb25zLCBub25DeWNsaWNQcm9kdWN0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIG5vbkN5Y2xpY1Byb2R1Y3Rpb25zRnJvbUZpeGVkQW5kQWRkZWRQcm9kdWN0aW9ucyhmaXhlZFByb2R1Y3Rpb25zLCBhZGRlZFByb2R1Y3Rpb25zLCBub25DeWNsaWNQcm9kdWN0aW9ucykge1xuICBmaXhlZFByb2R1Y3Rpb25zLmZvckVhY2goZnVuY3Rpb24oZml4ZWRQcm9kdWN0aW9uKSB7XG4gICAgY29uc3Qgbm9uQ3ljbGljUHJvZHVjdGlvbiA9IGZpeGVkUHJvZHVjdGlvbiwgLy8vXG4gICAgICAgICAgbm9uQ3ljbGljUHJvZHVjdGlvbk5hbWUgPSBub25DeWNsaWNQcm9kdWN0aW9uLmdldE5hbWUoKSxcbiAgICAgICAgICBhZGRlZFByb2R1Y3Rpb25OYW1lID0gbm9uQ3ljbGljUHJvZHVjdGlvbk5hbWUsIC8vL1xuICAgICAgICAgIGFkZGVkUHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24oYWRkZWRQcm9kdWN0aW9uTmFtZSwgYWRkZWRQcm9kdWN0aW9ucyk7XG5cbiAgICBpZiAoYWRkZWRQcm9kdWN0aW9uICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBhZGRlZFByb2R1Y3Rpb25SdWxlcyA9IGFkZGVkUHJvZHVjdGlvbi5nZXRSdWxlcygpO1xuXG4gICAgICBub25DeWNsaWNQcm9kdWN0aW9uLmNvbmNhdFJ1bGVzKGFkZGVkUHJvZHVjdGlvblJ1bGVzKTtcbiAgICB9XG5cbiAgICBub25DeWNsaWNQcm9kdWN0aW9ucy5wdXNoKG5vbkN5Y2xpY1Byb2R1Y3Rpb24pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcHJvZHVjdGlvbnNGcm9tQ29tcG9uZW50KGNvbXBvbmVudCwgcHJvZHVjdGlvbnMpIHtcbiAgcHJvZHVjdGlvbnMgPSBjb21wb25lbnQubWFwVmVydGljZXMoZnVuY3Rpb24odmVydGV4KSB7XG4gICAgY29uc3QgdmVydGV4TmFtZSA9IHZlcnRleC5nZXROYW1lKCksXG4gICAgICAgICAgcHJvZHVjdGlvbk5hbWUgPSB2ZXJ0ZXhOYW1lLCAgLy8vXG4gICAgICAgICAgcHJvZHVjdGlvbiA9IHBhcnNlclV0aWwuZmluZFByb2R1Y3Rpb24ocHJvZHVjdGlvbk5hbWUsIHByb2R1Y3Rpb25zKTtcblxuICAgIHJldHVybiBwcm9kdWN0aW9uO1xuICB9KTtcblxuICByZXR1cm4gcHJvZHVjdGlvbnM7XG59XG5cbmZ1bmN0aW9uIHVuaXRSdWxlUHJvZHVjdGlvbnNGcm9tUHJvZHVjdGlvbnMocHJvZHVjdGlvbnMpIHtcbiAgY29uc3QgdW5pdFJ1bGVQcm9kdWN0aW9ucyA9IHByb2R1Y3Rpb25zLnJlZHVjZShmdW5jdGlvbih1bml0UnVsZVByb2R1Y3Rpb25zLCBwcm9kdWN0aW9uKSB7XG4gICAgY29uc3QgbmFtZSA9IHByb2R1Y3Rpb24uZ2V0TmFtZSgpLFxuICAgICAgICAgIHVuaXRSdWxlc1Byb2R1Y3Rpb24gPSBVbml0UnVsZXNQcm9kdWN0aW9uLmZyb21Qcm9kdWN0aW9uKHByb2R1Y3Rpb24pO1xuXG4gICAgdW5pdFJ1bGVzUHJvZHVjdGlvbi5mb3JFYWNoVW5pdFJ1bGUoZnVuY3Rpb24odW5pdFJ1bGUpIHtcbiAgICAgIGNvbnN0IHVuaXRSdWxlUHJvZHVjdGlvbiA9IFVuaXRSdWxlUHJvZHVjdGlvbi5mcm9tTmFtZUFuZFVuaXRSdWxlKG5hbWUsIHVuaXRSdWxlKTtcblxuICAgICAgdW5pdFJ1bGVQcm9kdWN0aW9ucy5wdXNoKHVuaXRSdWxlUHJvZHVjdGlvbik7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdW5pdFJ1bGVQcm9kdWN0aW9ucztcbiAgfSwgW10pO1xuXG4gIHJldHVybiB1bml0UnVsZVByb2R1Y3Rpb25zO1xufVxuXG5mdW5jdGlvbiBmaXhlZFByb2R1Y3Rpb25zRnJvbVByb2R1Y3Rpb25zKHByb2R1Y3Rpb25zKSB7XG4gIGNvbnN0IGZpeGVkUHJvZHVjdGlvbnMgPSBwcm9kdWN0aW9ucy5tYXAoZnVuY3Rpb24ocHJvZHVjdGlvbikge1xuICAgIGNvbnN0IG5vblVuaXRQcm9kdWN0aW9uID0gTm9uVW5pdFJ1bGVzUHJvZHVjdGlvbi5mcm9tUHJvZHVjdGlvbihwcm9kdWN0aW9uKSxcbiAgICAgICAgICBmaXhlZFByb2R1Y3Rpb24gPSBub25Vbml0UHJvZHVjdGlvbjsgLy8vXG4gICAgXG4gICAgcmV0dXJuIGZpeGVkUHJvZHVjdGlvbjtcbiAgfSk7XG4gIFxuICByZXR1cm4gZml4ZWRQcm9kdWN0aW9ucztcbn1cblxuZnVuY3Rpb24gZmluZFVuaXRSdWxlUHJvZHVjdGlvbihwcm9kdWN0aW9uTmFtZSwgdW5pdFJ1bGVQcm9kdWN0aW9uTmFtZSwgdW5pdFJ1bGVQcm9kdWN0aW9ucykge1xuICBjb25zdCBmaXJzdFByb2R1Y3Rpb25OYW1lID0gcHJvZHVjdGlvbk5hbWUsIC8vL1xuICAgICAgICBzZWNvbmRQcm9kdWN0aW9uTmFtZSA9IHVuaXRSdWxlUHJvZHVjdGlvbk5hbWU7ICAvLy9cblxuICBsZXQgZm91bmRVbml0UnVsZVByb2R1Y3Rpb24gPSBudWxsO1xuXG4gIHVuaXRSdWxlUHJvZHVjdGlvbnMuc29tZShmdW5jdGlvbih1bml0UnVsZVByb2R1Y3Rpb24pIHtcbiAgICBjb25zdCB1bml0UnVsZVByb2R1Y3Rpb25Gb3VuZCA9IHVuaXRSdWxlUHJvZHVjdGlvbi5pc0ZvdW5kQnlQcm9kdWN0aW9uTmFtZXMoZmlyc3RQcm9kdWN0aW9uTmFtZSwgc2Vjb25kUHJvZHVjdGlvbk5hbWUpO1xuXG4gICAgaWYgKHVuaXRSdWxlUHJvZHVjdGlvbkZvdW5kKSB7XG4gICAgICBmb3VuZFVuaXRSdWxlUHJvZHVjdGlvbiA9IHVuaXRSdWxlUHJvZHVjdGlvbjtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCB1bml0UnVsZVByb2R1Y3Rpb24gPSBmb3VuZFVuaXRSdWxlUHJvZHVjdGlvbjsgLy8vXG5cbiAgcmV0dXJuIHVuaXRSdWxlUHJvZHVjdGlvbjtcbn1cbiJdfQ==