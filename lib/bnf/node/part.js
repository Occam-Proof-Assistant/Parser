'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var bnfUtilities = require('../../utilities/bnf'),
    arrayUtilities = require('../../utilities/array'),
    OptionalPartPart = require('../part/nonTerminal/optionalPart'),
    ZeroOrMorePartsPart = require('../part/nonTerminal/zeroOrMoreParts'),
    OneOrMorePartsPart = require('../part/nonTerminal/oneOrMoreParts'),
    GroupOfPartsPart = require('../part/nonTerminal/groupOfParts'),
    ChoiceOfPartsPart = require('../part/nonTerminal/choiceOfParts'),
    NonTerminalNode = require('../../common/node/nonTerminal');

var first = arrayUtilities.first,
    last = arrayUtilities.last,
    isNodeQuantifiersNode = bnfUtilities.isNodeQuantifiersNode,
    isNodeNoWhitespaceNode = bnfUtilities.isNodeNoWhitespaceNode,
    quantifiersFromQuantifiersNode = bnfUtilities.quantifiersFromQuantifiersNode;

var PartNode = function (_NonTerminalNode) {
  _inherits(PartNode, _NonTerminalNode);

  function PartNode() {
    _classCallCheck(this, PartNode);

    return _possibleConstructorReturn(this, (PartNode.__proto__ || Object.getPrototypeOf(PartNode)).apply(this, arguments));
  }

  _createClass(PartNode, [{
    key: 'generatePart',
    value: function generatePart(noWhitespace) {
      var part = null;

      var childNodes = this.getChildNodes(),
          nodes = childNodes.slice(),
          ///
      quantifiers = quantifiersFromNodes(nodes),
          firstNodeNoWhitespaceNode = isFirstNodeNoWhitespaceNode(nodes),
          lastNodeRightRecursivePartNode = isLastNodeRightRecursivePartNode(nodes);

      if (firstNodeNoWhitespaceNode) {
        nodes.shift();

        noWhitespace = true;
      }

      if (lastNodeRightRecursivePartNode) {
        nodes.pop();
      }

      var nodesLength = nodes.length;

      if (nodesLength === 1) {
        var firstNode = first(nodes),
            node = firstNode; ///

        part = partFromNode(node, noWhitespace);
      } else {
        part = partFromNodes(nodes);
      }

      part = partFromPartAndQuantifiers(part, quantifiers);

      return part;
    }
  }], [{
    key: 'fromNodesAndRuleName',
    value: function fromNodesAndRuleName(nodes, ruleName) {
      return NonTerminalNode.fromNodesAndRuleName(PartNode, nodes, ruleName);
    }
  }]);

  return PartNode;
}(NonTerminalNode);

module.exports = PartNode;

function quantifiersFromNodes(nodes) {
  var quantifiers = [];

  var lastNode = last(nodes),
      lastNodeQuantifiersNode = isNodeQuantifiersNode(lastNode);

  if (lastNodeQuantifiersNode) {
    var quantifiersNode = lastNode; ///

    quantifiers = quantifiersFromQuantifiersNode(quantifiersNode);
  }

  return quantifiers;
}

function isFirstNodeNoWhitespaceNode(nodes) {
  var firstNode = first(nodes),
      firstNodeNoWhitespaceNode = isNodeNoWhitespaceNode(firstNode);

  return firstNodeNoWhitespaceNode;
}

function isLastNodeRightRecursivePartNode(nodes) {
  var lastNodeRightRecursivePartNode = false;

  var lastNode = last(nodes),
      lastNodeTerminalNode = lastNode.isTerminalNode(),
      lastNodeNonTerminalNode = !lastNodeTerminalNode;

  if (lastNodeNonTerminalNode) {
    var nonTerminalNode = lastNode,
        ///
    nonTerminalNodeRuleName = nonTerminalNode.getRuleName();

    lastNodeRightRecursivePartNode = nonTerminalNodeRuleName === 'part~'; ///
  }

  return lastNodeRightRecursivePartNode;
}

function partFromNode(node, noWhitespace) {
  var part = node.generatePart(noWhitespace);

  return part;
}

function partFromNodes(nodes) {
  var part = null;

  var choiceOfPartsPart = ChoiceOfPartsPart.fromNodes(nodes);

  if (choiceOfPartsPart !== null) {
    part = choiceOfPartsPart; ///
  } else {
    var groupOfPartsPart = GroupOfPartsPart.fromNodes(nodes);

    if (groupOfPartsPart !== null) {
      part = groupOfPartsPart; ///
    }
  }

  return part;
}

function partFromPartAndQuantifiers(part, quantifiers) {
  var quantifiersLength = quantifiers.length;

  if (quantifiersLength > 0) {
    var quantifier = quantifiers.shift(),
        sequenceOfPartsPart = sequenceOfPartsPartFromPartAndQuantifier(part, quantifier);

    part = sequenceOfPartsPart; ///

    part = partFromPartAndQuantifiers(part, quantifiers);
  }

  return part;
}

function sequenceOfPartsPartFromPartAndQuantifier(part, quantifier) {
  var sequenceOfPartsPart = void 0;

  switch (quantifier) {
    case '?':
      var optionalPartPart = new OptionalPartPart(part);

      sequenceOfPartsPart = optionalPartPart; ///
      break;

    case '*':
      var zeroOrMorePartsPart = new ZeroOrMorePartsPart(part);

      sequenceOfPartsPart = zeroOrMorePartsPart; ///
      break;

    case '+':
      var oneOrMorePartsPart = new OneOrMorePartsPart(part);

      sequenceOfPartsPart = oneOrMorePartsPart; ///
      break;
  }

  return sequenceOfPartsPart;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VzNi9ibmYvbm9kZS9wYXJ0LmpzIl0sIm5hbWVzIjpbImJuZlV0aWxpdGllcyIsInJlcXVpcmUiLCJhcnJheVV0aWxpdGllcyIsIk9wdGlvbmFsUGFydFBhcnQiLCJaZXJvT3JNb3JlUGFydHNQYXJ0IiwiT25lT3JNb3JlUGFydHNQYXJ0IiwiR3JvdXBPZlBhcnRzUGFydCIsIkNob2ljZU9mUGFydHNQYXJ0IiwiTm9uVGVybWluYWxOb2RlIiwiZmlyc3QiLCJsYXN0IiwiaXNOb2RlUXVhbnRpZmllcnNOb2RlIiwiaXNOb2RlTm9XaGl0ZXNwYWNlTm9kZSIsInF1YW50aWZpZXJzRnJvbVF1YW50aWZpZXJzTm9kZSIsIlBhcnROb2RlIiwibm9XaGl0ZXNwYWNlIiwicGFydCIsImNoaWxkTm9kZXMiLCJnZXRDaGlsZE5vZGVzIiwibm9kZXMiLCJzbGljZSIsInF1YW50aWZpZXJzIiwicXVhbnRpZmllcnNGcm9tTm9kZXMiLCJmaXJzdE5vZGVOb1doaXRlc3BhY2VOb2RlIiwiaXNGaXJzdE5vZGVOb1doaXRlc3BhY2VOb2RlIiwibGFzdE5vZGVSaWdodFJlY3Vyc2l2ZVBhcnROb2RlIiwiaXNMYXN0Tm9kZVJpZ2h0UmVjdXJzaXZlUGFydE5vZGUiLCJzaGlmdCIsInBvcCIsIm5vZGVzTGVuZ3RoIiwibGVuZ3RoIiwiZmlyc3ROb2RlIiwibm9kZSIsInBhcnRGcm9tTm9kZSIsInBhcnRGcm9tTm9kZXMiLCJwYXJ0RnJvbVBhcnRBbmRRdWFudGlmaWVycyIsInJ1bGVOYW1lIiwiZnJvbU5vZGVzQW5kUnVsZU5hbWUiLCJtb2R1bGUiLCJleHBvcnRzIiwibGFzdE5vZGUiLCJsYXN0Tm9kZVF1YW50aWZpZXJzTm9kZSIsInF1YW50aWZpZXJzTm9kZSIsImxhc3ROb2RlVGVybWluYWxOb2RlIiwiaXNUZXJtaW5hbE5vZGUiLCJsYXN0Tm9kZU5vblRlcm1pbmFsTm9kZSIsIm5vblRlcm1pbmFsTm9kZSIsIm5vblRlcm1pbmFsTm9kZVJ1bGVOYW1lIiwiZ2V0UnVsZU5hbWUiLCJnZW5lcmF0ZVBhcnQiLCJjaG9pY2VPZlBhcnRzUGFydCIsImZyb21Ob2RlcyIsImdyb3VwT2ZQYXJ0c1BhcnQiLCJxdWFudGlmaWVyc0xlbmd0aCIsInF1YW50aWZpZXIiLCJzZXF1ZW5jZU9mUGFydHNQYXJ0Iiwic2VxdWVuY2VPZlBhcnRzUGFydEZyb21QYXJ0QW5kUXVhbnRpZmllciIsIm9wdGlvbmFsUGFydFBhcnQiLCJ6ZXJvT3JNb3JlUGFydHNQYXJ0Iiwib25lT3JNb3JlUGFydHNQYXJ0Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7OztBQUVBLElBQU1BLGVBQWVDLFFBQVEscUJBQVIsQ0FBckI7QUFBQSxJQUNNQyxpQkFBaUJELFFBQVEsdUJBQVIsQ0FEdkI7QUFBQSxJQUVNRSxtQkFBbUJGLFFBQVEsa0NBQVIsQ0FGekI7QUFBQSxJQUdNRyxzQkFBc0JILFFBQVEscUNBQVIsQ0FINUI7QUFBQSxJQUlNSSxxQkFBcUJKLFFBQVEsb0NBQVIsQ0FKM0I7QUFBQSxJQUtNSyxtQkFBbUJMLFFBQVEsa0NBQVIsQ0FMekI7QUFBQSxJQU1NTSxvQkFBb0JOLFFBQVEsbUNBQVIsQ0FOMUI7QUFBQSxJQU9NTyxrQkFBa0JQLFFBQVEsK0JBQVIsQ0FQeEI7O0lBU1FRLEssR0FBZ0JQLGMsQ0FBaEJPLEs7SUFBT0MsSSxHQUFTUixjLENBQVRRLEk7SUFDUEMscUIsR0FBa0ZYLFksQ0FBbEZXLHFCO0lBQXVCQyxzQixHQUEyRFosWSxDQUEzRFksc0I7SUFBd0JDLDhCLEdBQW1DYixZLENBQW5DYSw4Qjs7SUFFakRDLFE7Ozs7Ozs7Ozs7O2lDQUNTQyxZLEVBQWM7QUFDekIsVUFBSUMsT0FBTyxJQUFYOztBQUVBLFVBQU1DLGFBQWEsS0FBS0MsYUFBTCxFQUFuQjtBQUFBLFVBQ01DLFFBQVFGLFdBQVdHLEtBQVgsRUFEZDtBQUFBLFVBQ2tDO0FBQzVCQyxvQkFBY0MscUJBQXFCSCxLQUFyQixDQUZwQjtBQUFBLFVBR01JLDRCQUE0QkMsNEJBQTRCTCxLQUE1QixDQUhsQztBQUFB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O0FBRUQsU0FBU21CLDBCQUFULENBQW9DbkIsSUFBcEMsRUFBMENLLFdBQTFDLEVBQXVEO0FBQ3JELE1BQU1nQyxvQkFBb0JoQyxZQUFZUyxNQUF0Qzs7QUFFQSxNQUFJdUIsb0JBQW9CLENBQXhCLEVBQTJCO0FBQ3pCLFFBQU1DLGFBQWFqQyxZQUFZTSxLQUFaLEVBQW5CO0FBQUEsUUFDTTRCLHNCQUFzQkMseUNBQXlDeEMsSUFBekMsRUFBK0NzQyxVQUEvQyxDQUQ1Qjs7QUFHQXRDLFdBQU91QyxtQkFBUCxDQUp5QixDQUlHOztBQUU1QnZDLFdBQU9tQiwyQkFBMkJuQixJQUEzQixFQUFpQ0ssV0FBakMsQ0FBUDtBQUNEOztBQUVELFNBQU9MLElBQVA7QUFDRDs7QUFFRCxTQUFTd0Msd0NBQVQsQ0FBa0R4QyxJQUFsRCxFQUF3RHNDLFVBQXhELEVBQW9FO0FBQ2xFLE1BQUlDLDRCQUFKOztBQUVBLFVBQVFELFVBQVI7QUFDRSxTQUFLLEdBQUw7QUFDRSxVQUFNRyxtQkFBbUIsSUFBSXRELGdCQUFKLENBQXFCYSxJQUFyQixDQUF6Qjs7QUFFQXVDLDRCQUFzQkUsZ0JBQXRCLENBSEYsQ0FHMEM7QUFDeEM7O0FBRUYsU0FBSyxHQUFMO0FBQ0UsVUFBTUMsc0JBQXNCLElBQUl0RCxtQkFBSixDQUF3QlksSUFBeEIsQ0FBNUI7O0FBRUF1Qyw0QkFBc0JHLG1CQUF0QixDQUhGLENBRzhDO0FBQzVDOztBQUVGLFNBQUssR0FBTDtBQUNFLFVBQU1DLHFCQUFxQixJQUFJdEQsa0JBQUosQ0FBdUJXLElBQXZCLENBQTNCOztBQUVBdUMsNEJBQXNCSSxrQkFBdEIsQ0FIRixDQUc0QztBQUMxQztBQWpCSjs7QUFvQkEsU0FBT0osbUJBQVA7QUFDRCIsImZpbGUiOiJwYXJ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBibmZVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi8uLi91dGlsaXRpZXMvYm5mJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4uLy4uL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgT3B0aW9uYWxQYXJ0UGFydCA9IHJlcXVpcmUoJy4uL3BhcnQvbm9uVGVybWluYWwvb3B0aW9uYWxQYXJ0JyksXG4gICAgICBaZXJvT3JNb3JlUGFydHNQYXJ0ID0gcmVxdWlyZSgnLi4vcGFydC9ub25UZXJtaW5hbC96ZXJvT3JNb3JlUGFydHMnKSxcbiAgICAgIE9uZU9yTW9yZVBhcnRzUGFydCA9IHJlcXVpcmUoJy4uL3BhcnQvbm9uVGVybWluYWwvb25lT3JNb3JlUGFydHMnKSxcbiAgICAgIEdyb3VwT2ZQYXJ0c1BhcnQgPSByZXF1aXJlKCcuLi9wYXJ0L25vblRlcm1pbmFsL2dyb3VwT2ZQYXJ0cycpLFxuICAgICAgQ2hvaWNlT2ZQYXJ0c1BhcnQgPSByZXF1aXJlKCcuLi9wYXJ0L25vblRlcm1pbmFsL2Nob2ljZU9mUGFydHMnKSxcbiAgICAgIE5vblRlcm1pbmFsTm9kZSA9IHJlcXVpcmUoJy4uLy4uL2NvbW1vbi9ub2RlL25vblRlcm1pbmFsJyk7XG5cbmNvbnN0IHsgZmlyc3QsIGxhc3QgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBpc05vZGVRdWFudGlmaWVyc05vZGUsIGlzTm9kZU5vV2hpdGVzcGFjZU5vZGUsIHF1YW50aWZpZXJzRnJvbVF1YW50aWZpZXJzTm9kZSB9ID0gYm5mVXRpbGl0aWVzO1xuXG5jbGFzcyBQYXJ0Tm9kZSBleHRlbmRzIE5vblRlcm1pbmFsTm9kZSB7XG4gIGdlbmVyYXRlUGFydChub1doaXRlc3BhY2UpIHtcbiAgICBsZXQgcGFydCA9IG51bGw7XG5cbiAgICBjb25zdCBjaGlsZE5vZGVzID0gdGhpcy5nZXRDaGlsZE5vZGVzKCksXG4gICAgICAgICAgbm9kZXMgPSBjaGlsZE5vZGVzLnNsaWNlKCksIC8vL1xuICAgICAgICAgIHF1YW50aWZpZXJzID0gcXVhbnRpZmllcnNGcm9tTm9kZXMobm9kZXMpLFxuICAgICAgICAgIGZpcnN0Tm9kZU5vV2hpdGVzcGFjZU5vZGUgPSBpc0ZpcnN0Tm9kZU5vV2hpdGVzcGFjZU5vZGUobm9kZXMpLFxuICAgICAgICAgIGxhc3ROb2RlUmlnaHRSZWN1cnNpdmVQYXJ0Tm9kZSA9IGlzTGFzdE5vZGVSaWdodFJlY3Vyc2l2ZVBhcnROb2RlKG5vZGVzKTtcblxuICAgIGlmIChmaXJzdE5vZGVOb1doaXRlc3BhY2VOb2RlKSB7XG4gICAgICBub2Rlcy5zaGlmdCgpO1xuXG4gICAgICBub1doaXRlc3BhY2UgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChsYXN0Tm9kZVJpZ2h0UmVjdXJzaXZlUGFydE5vZGUpIHtcbiAgICAgIG5vZGVzLnBvcCgpO1xuICAgIH1cblxuICAgIGNvbnN0IG5vZGVzTGVuZ3RoID0gbm9kZXMubGVuZ3RoO1xuICAgIFxuICAgIGlmIChub2Rlc0xlbmd0aCA9PT0gMSkge1xuICAgICAgY29uc3QgZmlyc3ROb2RlID0gZmlyc3Qobm9kZXMpLFxuICAgICAgICAgICAgbm9kZSA9IGZpcnN0Tm9kZTsgIC8vL1xuXG4gICAgICBwYXJ0ID0gcGFydEZyb21Ob2RlKG5vZGUsIG5vV2hpdGVzcGFjZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcnQgPSBwYXJ0RnJvbU5vZGVzKG5vZGVzKTtcbiAgICB9XG4gICAgXG4gICAgcGFydCA9IHBhcnRGcm9tUGFydEFuZFF1YW50aWZpZXJzKHBhcnQsIHF1YW50aWZpZXJzKTtcblxuICAgIHJldHVybiBwYXJ0O1xuICB9XG4gIFxuICBzdGF0aWMgZnJvbU5vZGVzQW5kUnVsZU5hbWUobm9kZXMsIHJ1bGVOYW1lKSB7IHJldHVybiBOb25UZXJtaW5hbE5vZGUuZnJvbU5vZGVzQW5kUnVsZU5hbWUoUGFydE5vZGUsIG5vZGVzLCBydWxlTmFtZSk7IH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBQYXJ0Tm9kZTtcblxuZnVuY3Rpb24gcXVhbnRpZmllcnNGcm9tTm9kZXMobm9kZXMpIHtcbiAgbGV0ICBxdWFudGlmaWVycyA9IFtdO1xuXG4gIGNvbnN0IGxhc3ROb2RlID0gbGFzdChub2RlcyksXG4gICAgICAgIGxhc3ROb2RlUXVhbnRpZmllcnNOb2RlID0gaXNOb2RlUXVhbnRpZmllcnNOb2RlKGxhc3ROb2RlKTtcblxuICBpZiAobGFzdE5vZGVRdWFudGlmaWVyc05vZGUpIHtcbiAgICBjb25zdCBxdWFudGlmaWVyc05vZGUgPSBsYXN0Tm9kZTsgIC8vL1xuXG4gICAgcXVhbnRpZmllcnMgPSBxdWFudGlmaWVyc0Zyb21RdWFudGlmaWVyc05vZGUocXVhbnRpZmllcnNOb2RlKTtcbiAgfVxuXG4gIHJldHVybiBxdWFudGlmaWVycztcbn1cblxuZnVuY3Rpb24gaXNGaXJzdE5vZGVOb1doaXRlc3BhY2VOb2RlKG5vZGVzKSB7XG4gIGNvbnN0IGZpcnN0Tm9kZSA9IGZpcnN0KG5vZGVzKSxcbiAgICAgICAgZmlyc3ROb2RlTm9XaGl0ZXNwYWNlTm9kZSA9IGlzTm9kZU5vV2hpdGVzcGFjZU5vZGUoZmlyc3ROb2RlKTtcblxuICByZXR1cm4gZmlyc3ROb2RlTm9XaGl0ZXNwYWNlTm9kZTtcbn1cblxuZnVuY3Rpb24gaXNMYXN0Tm9kZVJpZ2h0UmVjdXJzaXZlUGFydE5vZGUobm9kZXMpIHtcbiAgbGV0IGxhc3ROb2RlUmlnaHRSZWN1cnNpdmVQYXJ0Tm9kZSA9IGZhbHNlO1xuXG4gIGNvbnN0IGxhc3ROb2RlID0gbGFzdChub2RlcyksXG4gICAgICAgIGxhc3ROb2RlVGVybWluYWxOb2RlID0gbGFzdE5vZGUuaXNUZXJtaW5hbE5vZGUoKSxcbiAgICAgICAgbGFzdE5vZGVOb25UZXJtaW5hbE5vZGUgPSAhbGFzdE5vZGVUZXJtaW5hbE5vZGU7XG5cbiAgaWYgKGxhc3ROb2RlTm9uVGVybWluYWxOb2RlKSB7XG4gICAgY29uc3Qgbm9uVGVybWluYWxOb2RlID0gbGFzdE5vZGUsIC8vL1xuICAgICAgICAgIG5vblRlcm1pbmFsTm9kZVJ1bGVOYW1lID0gbm9uVGVybWluYWxOb2RlLmdldFJ1bGVOYW1lKCk7XG5cbiAgICBsYXN0Tm9kZVJpZ2h0UmVjdXJzaXZlUGFydE5vZGUgPSAobm9uVGVybWluYWxOb2RlUnVsZU5hbWUgPT09ICdwYXJ0ficpOyAvLy9cbiAgfVxuXG4gIHJldHVybiBsYXN0Tm9kZVJpZ2h0UmVjdXJzaXZlUGFydE5vZGU7XG59XG5cbmZ1bmN0aW9uIHBhcnRGcm9tTm9kZShub2RlLCBub1doaXRlc3BhY2UpIHtcbiAgY29uc3QgcGFydCA9IG5vZGUuZ2VuZXJhdGVQYXJ0KG5vV2hpdGVzcGFjZSk7XG5cbiAgcmV0dXJuIHBhcnQ7XG59XG5cbmZ1bmN0aW9uIHBhcnRGcm9tTm9kZXMobm9kZXMpIHtcbiAgbGV0IHBhcnQgPSBudWxsO1xuXG4gIGNvbnN0IGNob2ljZU9mUGFydHNQYXJ0ID0gQ2hvaWNlT2ZQYXJ0c1BhcnQuZnJvbU5vZGVzKG5vZGVzKTtcblxuICBpZiAoY2hvaWNlT2ZQYXJ0c1BhcnQgIT09IG51bGwpIHtcbiAgICBwYXJ0ID0gY2hvaWNlT2ZQYXJ0c1BhcnQ7IC8vL1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGdyb3VwT2ZQYXJ0c1BhcnQgPSBHcm91cE9mUGFydHNQYXJ0LmZyb21Ob2Rlcyhub2Rlcyk7XG5cbiAgICBpZiAoZ3JvdXBPZlBhcnRzUGFydCAhPT0gbnVsbCkge1xuICAgICAgcGFydCA9IGdyb3VwT2ZQYXJ0c1BhcnQ7ICAvLy9cbiAgICB9XG4gIH1cblxuICByZXR1cm4gcGFydDtcbn1cblxuZnVuY3Rpb24gcGFydEZyb21QYXJ0QW5kUXVhbnRpZmllcnMocGFydCwgcXVhbnRpZmllcnMpIHtcbiAgY29uc3QgcXVhbnRpZmllcnNMZW5ndGggPSBxdWFudGlmaWVycy5sZW5ndGg7XG5cbiAgaWYgKHF1YW50aWZpZXJzTGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IHF1YW50aWZpZXIgPSBxdWFudGlmaWVycy5zaGlmdCgpLFxuICAgICAgICAgIHNlcXVlbmNlT2ZQYXJ0c1BhcnQgPSBzZXF1ZW5jZU9mUGFydHNQYXJ0RnJvbVBhcnRBbmRRdWFudGlmaWVyKHBhcnQsIHF1YW50aWZpZXIpO1xuXG4gICAgcGFydCA9IHNlcXVlbmNlT2ZQYXJ0c1BhcnQ7IC8vL1xuXG4gICAgcGFydCA9IHBhcnRGcm9tUGFydEFuZFF1YW50aWZpZXJzKHBhcnQsIHF1YW50aWZpZXJzKTtcbiAgfVxuXG4gIHJldHVybiBwYXJ0O1xufVxuXG5mdW5jdGlvbiBzZXF1ZW5jZU9mUGFydHNQYXJ0RnJvbVBhcnRBbmRRdWFudGlmaWVyKHBhcnQsIHF1YW50aWZpZXIpIHtcbiAgbGV0IHNlcXVlbmNlT2ZQYXJ0c1BhcnQ7XG5cbiAgc3dpdGNoIChxdWFudGlmaWVyKSB7XG4gICAgY2FzZSAnPyc6XG4gICAgICBjb25zdCBvcHRpb25hbFBhcnRQYXJ0ID0gbmV3IE9wdGlvbmFsUGFydFBhcnQocGFydCk7XG5cbiAgICAgIHNlcXVlbmNlT2ZQYXJ0c1BhcnQgPSBvcHRpb25hbFBhcnRQYXJ0OyAvLy9cbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnKic6XG4gICAgICBjb25zdCB6ZXJvT3JNb3JlUGFydHNQYXJ0ID0gbmV3IFplcm9Pck1vcmVQYXJ0c1BhcnQocGFydCk7XG5cbiAgICAgIHNlcXVlbmNlT2ZQYXJ0c1BhcnQgPSB6ZXJvT3JNb3JlUGFydHNQYXJ0OyAgLy8vXG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJysnOlxuICAgICAgY29uc3Qgb25lT3JNb3JlUGFydHNQYXJ0ID0gbmV3IE9uZU9yTW9yZVBhcnRzUGFydChwYXJ0KTtcblxuICAgICAgc2VxdWVuY2VPZlBhcnRzUGFydCA9IG9uZU9yTW9yZVBhcnRzUGFydDsgLy8vXG4gICAgICBicmVhaztcbiAgfVxuXG4gIHJldHVybiBzZXF1ZW5jZU9mUGFydHNQYXJ0O1xufVxuIl19