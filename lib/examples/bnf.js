'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var easy = require('easy'),
    lexers = require('occam-lexers');

var Example = require('../example'),
    grammar = require('../bnf/grammar'),
    BNFParser = require('../bnf/parser');

var Textarea = easy.Textarea,
    BNFLexer = lexers.BNFLexer;


var lexicalGrammarTextareaSelector = 'textarea#lexicalGrammar',
    adjustedBNFGrammarTextareaSelector = 'textarea#adjustedBNFGrammar',
    lexicalGrammar = BNFLexer.grammar;

var lexicalGrammarTextarea = void 0,
    adjustedBNFGrammarTextarea = void 0,
    bnfLexer = null,
    bnfParser = null;

var BNFExample = function () {
     function BNFExample() {
          _classCallCheck(this, BNFExample);
     }

     _createClass(BNFExample, null, [{
          key: 'run',
          value: function run() {
               lexicalGrammarTextarea = new Textarea(lexicalGrammarTextareaSelector);
               adjustedBNFGrammarTextarea = new Textarea(adjustedBNFGrammarTextareaSelector);

               var lexicalGrammarTextareaValue = JSON.stringify(lexicalGrammar, null, '  '),
                   ///
               bnfGrammarTextareaValue = grammar,
                   ///
               contentTextareaValue = '\n\n     document                                                      ::=   header? verticalSpace? body?\n\n\n\n     header                                                        ::=   includeDirective+\n\n     verticalSpace                                                 ::=   <END_OF_LINE>+\n\n     body                                                          ::=   part+\n\n\n\n     rule                                                          ::=   "Rule" labels? <END_OF_LINE> premiseOrPremises? conclusion proof?\n\n     axiom                                                         ::=   "Axiom" labels? <END_OF_LINE> standaloneStatement\n\n     lemma                                                         ::=   "Lemma" labels? <END_OF_LINE> standaloneStatement proof?\n\n     theorem                                                       ::=   "Theorem" labels? <END_OF_LINE> standaloneStatement proof?\n\n\n\n     typeDeclaration                                               ::=   "Type" type\n\n     typesDeclaration                                              ::=   "Types" types\n\n     dependentTypeDeclaration                                      ::=   "DependentType" dependentType\n\n     dependentTypesDeclaration                                     ::=   "DependentTypes" dependentTypes \n\n     constructorDeclaration                                        ::=   "Constructor" constructor\n\n     constructorsDeclaration                                       ::=   "Constructors" constructors\n\n     variableDeclaration                                           ::=   "Variable" variable\n\n     variablesDeclaration                                          ::=   "Variables" variables\n\n     metaVariableDeclaration                                       ::=   "MetaVariable" metaVariable\n\n     metaVariablesDeclaration                                      ::=   "MetaVariables" metaVariables\n\n     qualifiedMetaVariableDeclaration                              ::=   "QualifiedMetaVariable" qualifiedMetaVariable\n\n     qualifiedMetaVariablesDeclaration                             ::=   "QualifiedMetaVariables" qualifiedMetaVariables\n\n\n\n     part                                                          ::=   verticalSpace\n\n                                                                     |   rule\n                                                                \n                                                                     |   axiom\n                                                                \n                                                                     |   lemma\n                                                                \n                                                                     |   theorem\n                                                                \n                                                                     |   typeDeclaration\n                                                                \n                                                                     |   typesDeclaration\n                                                                \n                                                                     |   dependentTypeDeclaration\n                                                                \n                                                                     |   dependentTypesDeclaration\n                                                                \n                                                                     |   constructorDeclaration\n                                                                \n                                                                     |   constructorsDeclaration\n                                                                \n                                                                     |   variableDeclaration\n                                                                \n                                                                     |   variablesDeclaration\n                                                                \n                                                                     |   metavariableDeclaration\n                                                                \n                                                                     |   metavariablesDeclaration\n                                                                \n                                                                     |   qualifiedMetavariableDeclaration\n                                                                \n                                                                     |   qualifiedMetavariablesDeclaration\n                                                                     \n                                                                     \n                                                                     \n  includeDirective                                                 ::=   "include"<NO_WHITESPACE>"("<NO_WHITESPACE>[string]<NO_WHITESPACE>")" <END_OF_LINE>\n\n\n\n   premiseOrPremises                                               ::=   premise | premises\n\n\n\n   type                                                            ::=   typeName\n   \n   types                                                           ::=   type(<NO_WHITESPACE>","<NO_WHITESPACE>type)*\n\n   dependentType                                                   ::=   dependentTypeName<NO_WHITESPACE>"("<NO_WHITESPACE>typeName<NO_WHITESPACE>")"\n   \n   dependentTypes                                                  ::=   dependentType(<NO_WHITESPACE>","<NO_WHITESPACE>dependentType)*\n   \n   constructor                                                     ::=   constructorName<NO_WHITESPACE>"("<NO_WHITESPACE>types<NO_WHITESPACE>")"\n   \n   constructors                                                    ::=   constructor(<NO_WHITESPACE>","<NO_WHITESPACE>constructor)*\n   \n   variable                                                        ::=   variableName(<NO_WHITESPACE>":"type)?\n   \n   variables                                                       ::=   variable(<NO_WHITESPACE>","<NO_WHITESPACE>variable)*\n   \n   metaVariable                                                    ::=   metaVariableName\n\n   metaVariables                                                   ::=   metaVariable(<NO_WHITESPACE>","<NO_WHITESPACE>metaVariable)*\n   \n   qualifiedMetaVariable                                           ::=   qualifiedMetaVariableName\n   \n   qualifiedMetaVariables                                          ::=   qualifiedMetaVariable(<NO_WHITESPACE>","<NO_WHITESPACE>qualifiedMetaVariable)*\n   \n   \n   \n   label                                                           ::=   labelName(<NO_WHITESPACE>"("<NO_WHITESPACE>terms<NO_WHITESPACE>")")?\n\n\n\n   typeName                                                        ::=   name\n\n   dependentTypeName                                               ::=   name\n\n   constructorName                                                 ::=   name\n\n   variableName                                                    ::=   name\n\n   metaVariableName                                                ::=   name\n\n   qualifiedMetaVariableName                                       ::=   name\n   \n   labelName                                                       ::=   name\n\n   name                                                            ::=   /\\w+/\n   \n\n    \n'; ///

               /*
               
               
               
               
               
               
                   premise(s)                                                    ::=   premise | premises
                 premise                                                       ::=   "Premise" <END_OF_LINE> unjustifiedStatementOrUnknown
                 premises                                                      ::=   "Premises" <END_OF_LINE> unjustifiedStatementOrUnknown unjustifiedStatementOrUnknown+
                 conclusion                                                    ::=   "Conclusion" <END_OF_LINE> (un)justifiedStatementOrUnknown
                   proof                                                         ::=   "Proof" <END_OF_LINE> (abridged)ProofDerivation
                 (abridged)ProofDerivation                                     ::=   proofDerivation | abridgedProofDerivation
                 abridgedProofDerivation                                       ::=   (un)justifiedStatementOrUnknown
                 proofDerivation                                               ::=   derivation therefore
                 derivation                                                    ::=   subDerivation+
                 therefore                                                     ::=   "Therefore" <END_OF_LINE> (un)justifiedStatementOrUnknown
                 subDerivation                                                 ::=   subLemma | (un)justifiedStatementOrUnknown
                   subLemma                                                      ::=   suppose then? hence unjustifiedStatementOrUnknown? verticalSpace?
                 suppose                                                       ::=   "Suppose" <END_OF_LINE> unjustifiedStatementOrUnknown+
                 then                                                          ::=   "Then" <END_OF_LINE> derivation
                 hence                                                         ::=   "Hence" <END_OF_LINE> (un)justifiedStatementOrUnknown
                   (un)justifiedStatementOrUnknown                               ::=   justifiedStatement | unjustifiedStatement | unknown
                 unjustifiedStatementOrUnknown                                 ::=   unjustifiedStatement | unknown
                 unjustifiedStatement                                          ::=   statement <END_OF_LINE>
                 justifiedStatement                                            ::=   statement justification <END_OF_LINE>
                 justification                                                 ::=   byOrFrom reference
                 byOrFrom                                                      ::=   "by" | "from"
                 reference                                                     ::=   referenceName<NO_WHITESPACE>parenthesisedTermList?
                 referenceName                                                 ::=   name
                   statement                                                     ::=   proofAssertion | typeAssertion | equality | expression
                   proofAssertion                                                ::=   (qualified)Metavariable "::" (qualified)Metavariable
                 typeAssertion                                                 ::=   expression ":" type
                 equality                                                      ::=   expression "=" expression
                 expression                                                    ::=   term | (qualified)Metavariable
                   term                                                          ::=   compoundTerm | variableName
                 compoundTerm                                                  ::=   constructorName<NO_WHITESPACE>parenthesisedTermList?
                   parenthesisedTermList                                         ::=   "("<NO_WHITESPACE>termList<NO_WHITESPACE>")"
                 termList                                                      ::=   term<NO_WHITESPACE>commaThenTerm*
                 commaThenTerm                                                 ::=   ","<NO_WHITESPACE>term
                   name                                                          ::=   /\\w+/
                   unknown                                                       ::=   specialUnassignedOrMinorKeywords+ <END_OF_LINE>
                 specialUnassignedOrMinorKeywords                              ::=   [special] | [unassigned] | "by" | "from"
               
                error                                                         ::=   *
                 */

               lexicalGrammarTextarea.setValue(lexicalGrammarTextareaValue);

               Example.setBNFGrammarTextareaValue(bnfGrammarTextareaValue);

               Example.setContentTextareaValue(contentTextareaValue);

               Example.onBNFGrammarTextareaKeyUp(update);

               Example.onContentTextareaKeyUp(update);

               lexicalGrammarTextarea.onKeyUp(update);

               update();
          }
     }]);

     return BNFExample;
}();

function update() {
     updateBNFLexer();

     updateBNFParser();

     updateAdjustedBNFGrammar();

     if (bnfLexer !== null) {
          var production = null,
              node = Example.updateParseTreeTextarea(bnfLexer, bnfParser, production),
              productionsNode = node; ///

          BNFParser.generateProductions(productionsNode);
     } else {
          Example.clearParseTreeTextarea();
     }
}

module.exports = BNFExample;

function updateBNFLexer() {
     var lexicalGrammarTextareaValue = lexicalGrammarTextarea.getValue();

     var lexicalGrammar = null;

     try {
          lexicalGrammar = JSON.parse(lexicalGrammarTextareaValue);
     } catch (error) {}

     var lexicalGrammarValid = lexicalGrammar !== null;

     if (lexicalGrammarValid) {
          bnfLexer = BNFLexer.fromGrammar(lexicalGrammar);

          lexicalGrammarTextarea.removeClass('error');
     } else {
          lexicalGrammarTextarea.addClass('error');

          bnfLexer = null;
     }
}

function updateBNFParser() {
     bnfParser = BNFParser.fromNothing();
}

function updateAdjustedBNFGrammar() {
     var productions = bnfParser.getProductions(),
         maximumProductionNameLength = productions.reduce(function (maximumProductionNameLength, production) {
          var productionName = production.getName(),
              productionNameLength = productionName.length;

          maximumProductionNameLength = Math.max(maximumProductionNameLength, productionNameLength);

          return maximumProductionNameLength;
     }, 0),
         adjustedBNFGrammarTextareaValue = productions.reduce(function (adjustedBNFGrammarTextarea, production) {
          var productionString = production.toString(maximumProductionNameLength);

          adjustedBNFGrammarTextarea += productionString;

          return adjustedBNFGrammarTextarea;
     }, []);

     adjustedBNFGrammarTextarea.setValue(adjustedBNFGrammarTextareaValue);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi9leGFtcGxlcy9ibmYuanMiXSwibmFtZXMiOlsiZWFzeSIsInJlcXVpcmUiLCJsZXhlcnMiLCJFeGFtcGxlIiwiZ3JhbW1hciIsIkJORlBhcnNlciIsIlRleHRhcmVhIiwiQk5GTGV4ZXIiLCJsZXhpY2FsR3JhbW1hclRleHRhcmVhU2VsZWN0b3IiLCJhZGp1c3RlZEJORkdyYW1tYXJUZXh0YXJlYVNlbGVjdG9yIiwibGV4aWNhbEdyYW1tYXIiLCJsZXhpY2FsR3JhbW1hclRleHRhcmVhIiwiYWRqdXN0ZWRCTkZHcmFtbWFyVGV4dGFyZWEiLCJibmZMZXhlciIsImJuZlBhcnNlciIsIkJORkV4YW1wbGUiLCJsZXhpY2FsR3JhbW1hclRleHRhcmVhVmFsdWUiLCJKU09OIiwic3RyaW5naWZ5IiwiYm5mR3JhbW1hclRleHRhcmVhVmFsdWUiLCJjb250ZW50VGV4dGFyZWFWYWx1ZSIsInNldFZhbHVlIiwic2V0Qk5GR3JhbW1hclRleHRhcmVhVmFsdWUiLCJzZXRDb250ZW50VGV4dGFyZWFWYWx1ZSIsIm9uQk5GR3JhbW1hclRleHRhcmVhS2V5VXAiLCJ1cGRhdGUiLCJvbkNvbnRlbnRUZXh0YXJlYUtleVVwIiwib25LZXlVcCIsInVwZGF0ZUJORkxleGVyIiwidXBkYXRlQk5GUGFyc2VyIiwidXBkYXRlQWRqdXN0ZWRCTkZHcmFtbWFyIiwicHJvZHVjdGlvbiIsIm5vZGUiLCJ1cGRhdGVQYXJzZVRyZWVUZXh0YXJlYSIsInByb2R1Y3Rpb25zTm9kZSIsImdlbmVyYXRlUHJvZHVjdGlvbnMiLCJjbGVhclBhcnNlVHJlZVRleHRhcmVhIiwibW9kdWxlIiwiZXhwb3J0cyIsImdldFZhbHVlIiwicGFyc2UiLCJlcnJvciIsImxleGljYWxHcmFtbWFyVmFsaWQiLCJmcm9tR3JhbW1hciIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJmcm9tTm90aGluZyIsInByb2R1Y3Rpb25zIiwiZ2V0UHJvZHVjdGlvbnMiLCJtYXhpbXVtUHJvZHVjdGlvbk5hbWVMZW5ndGgiLCJyZWR1Y2UiLCJwcm9kdWN0aW9uTmFtZSIsImdldE5hbWUiLCJwcm9kdWN0aW9uTmFtZUxlbmd0aCIsImxlbmd0aCIsIk1hdGgiLCJtYXgiLCJhZGp1c3RlZEJORkdyYW1tYXJUZXh0YXJlYVZhbHVlIiwicHJvZHVjdGlvblN0cmluZyIsInRvU3RyaW5nIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUEsSUFBTUEsT0FBT0MsUUFBUSxNQUFSLENBQWI7QUFBQSxJQUNNQyxTQUFTRCxRQUFRLGNBQVIsQ0FEZjs7QUFHQSxJQUFNRSxVQUFVRixRQUFRLFlBQVIsQ0FBaEI7QUFBQSxJQUNNRyxVQUFVSCxRQUFRLGdCQUFSLENBRGhCO0FBQUEsSUFFTUksWUFBWUosUUFBUSxlQUFSLENBRmxCOztBQUlNLElBQUVLLFFBQUYsR0FBZU4sSUFBZixDQUFFTSxRQUFGO0FBQUEsSUFDRUMsUUFERixHQUNlTCxNQURmLENBQ0VLLFFBREY7OztBQUdOLElBQU1DLGlDQUFpQyx5QkFBdkM7QUFBQSxJQUNNQyxxQ0FBcUMsNkJBRDNDO0FBQUEsSUFFTUMsaUJBQWlCSCxTQUFTSCxPQUZoQzs7QUFJQSxJQUFJTywrQkFBSjtBQUFBLElBQ0lDLG1DQURKO0FBQUEsSUFFSUMsV0FBVyxJQUZmO0FBQUEsSUFHSUMsWUFBWSxJQUhoQjs7SUFLTUMsVTs7Ozs7OztnQ0FDUztBQUNYSix3Q0FBeUIsSUFBSUwsUUFBSixDQUFhRSw4QkFBYixDQUF6QjtBQUNBSSw0Q0FBNkIsSUFBSU4sUUFBSixDQUFhRyxrQ0FBYixDQUE3Qjs7QUFFQSxtQkFBTU8sOEJBQThCQyxLQUFLQyxTQUFMLENBQWVSLGNBQWYsRUFBK0IsSUFBL0IsRUFBcUMsSUFBckMsQ0FBcEM7QUFBQSxtQkFBZ0Y7QUFDMUVTLHlDQUEwQmYsT0FEaEM7QUFBQSxtQkFDeUM7QUFDbkNnQixpOU9BRk4sQ0FKVyxDQW9KWjs7QUFFQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvSUFULHNDQUF1QlUsUUFBdkIsQ0FBZ0NMLDJCQUFoQzs7QUFFQWIsdUJBQVFtQiwwQkFBUixDQUFtQ0gsdUJBQW5DOztBQUVBaEIsdUJBQVFvQix1QkFBUixDQUFnQ0gsb0JBQWhDOztBQUVBakIsdUJBQVFxQix5QkFBUixDQUFrQ0MsTUFBbEM7O0FBRUF0Qix1QkFBUXVCLHNCQUFSLENBQStCRCxNQUEvQjs7QUFFQWQsc0NBQXVCZ0IsT0FBdkIsQ0FBK0JGLE1BQS9COztBQUVBQTtBQUNEOzs7Ozs7QUFHSCxTQUFTQSxNQUFULEdBQWtCO0FBQ2hCRzs7QUFFQUM7O0FBRUFDOztBQUVBLFNBQUlqQixhQUFhLElBQWpCLEVBQXVCO0FBQ3JCLGNBQU1rQixhQUFhLElBQW5CO0FBQUEsY0FDTUMsT0FBTzdCLFFBQVE4Qix1QkFBUixDQUFnQ3BCLFFBQWhDLEVBQTBDQyxTQUExQyxFQUFxRGlCLFVBQXJELENBRGI7QUFBQSxjQUVNRyxrQkFBa0JGLElBRnhCLENBRHFCLENBR1M7O0FBRTlCM0Isb0JBQVU4QixtQkFBVixDQUE4QkQsZUFBOUI7QUFDRCxNQU5ELE1BTU87QUFDTC9CLGtCQUFRaUMsc0JBQVI7QUFDRDtBQUNGOztBQUVEQyxPQUFPQyxPQUFQLEdBQWlCdkIsVUFBakI7O0FBRUEsU0FBU2EsY0FBVCxHQUEwQjtBQUN4QixTQUFNWiw4QkFBOEJMLHVCQUF1QjRCLFFBQXZCLEVBQXBDOztBQUVBLFNBQUk3QixpQkFBaUIsSUFBckI7O0FBRUEsU0FBSTtBQUNGQSwyQkFBaUJPLEtBQUt1QixLQUFMLENBQVd4QiwyQkFBWCxDQUFqQjtBQUNELE1BRkQsQ0FFRSxPQUFPeUIsS0FBUCxFQUFjLENBQUU7O0FBRWxCLFNBQU1DLHNCQUF1QmhDLG1CQUFtQixJQUFoRDs7QUFFQSxTQUFJZ0MsbUJBQUosRUFBeUI7QUFDdkI3QixxQkFBV04sU0FBU29DLFdBQVQsQ0FBcUJqQyxjQUFyQixDQUFYOztBQUVBQyxpQ0FBdUJpQyxXQUF2QixDQUFtQyxPQUFuQztBQUNELE1BSkQsTUFJTztBQUNMakMsaUNBQXVCa0MsUUFBdkIsQ0FBZ0MsT0FBaEM7O0FBRUFoQyxxQkFBVyxJQUFYO0FBQ0Q7QUFDRjs7QUFFRCxTQUFTZ0IsZUFBVCxHQUEyQjtBQUN6QmYsaUJBQVlULFVBQVV5QyxXQUFWLEVBQVo7QUFDRDs7QUFFRCxTQUFTaEIsd0JBQVQsR0FBb0M7QUFDbEMsU0FBTWlCLGNBQWNqQyxVQUFVa0MsY0FBVixFQUFwQjtBQUFBLFNBQ01DLDhCQUE4QkYsWUFBWUcsTUFBWixDQUFtQixVQUFTRCwyQkFBVCxFQUFzQ2xCLFVBQXRDLEVBQWtEO0FBQ2pHLGNBQU1vQixpQkFBaUJwQixXQUFXcUIsT0FBWCxFQUF2QjtBQUFBLGNBQ01DLHVCQUF1QkYsZUFBZUcsTUFENUM7O0FBR0FMLHdDQUE4Qk0sS0FBS0MsR0FBTCxDQUFTUCwyQkFBVCxFQUFzQ0ksb0JBQXRDLENBQTlCOztBQUVBLGlCQUFPSiwyQkFBUDtBQUNELE1BUDZCLEVBTzNCLENBUDJCLENBRHBDO0FBQUEsU0FTTVEsa0NBQWtDVixZQUFZRyxNQUFaLENBQW1CLFVBQVN0QywwQkFBVCxFQUFxQ21CLFVBQXJDLEVBQWlEO0FBQ3BHLGNBQU0yQixtQkFBbUIzQixXQUFXNEIsUUFBWCxDQUFvQlYsMkJBQXBCLENBQXpCOztBQUVBckMsd0NBQThCOEMsZ0JBQTlCOztBQUVBLGlCQUFPOUMsMEJBQVA7QUFDRCxNQU5pQyxFQU0vQixFQU4rQixDQVR4Qzs7QUFpQkFBLGdDQUEyQlMsUUFBM0IsQ0FBb0NvQywrQkFBcEM7QUFDRCIsImZpbGUiOiJibmYuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IGVhc3kgPSByZXF1aXJlKCdlYXN5JyksXG4gICAgICBsZXhlcnMgPSByZXF1aXJlKCdvY2NhbS1sZXhlcnMnKTtcblxuY29uc3QgRXhhbXBsZSA9IHJlcXVpcmUoJy4uL2V4YW1wbGUnKSxcbiAgICAgIGdyYW1tYXIgPSByZXF1aXJlKCcuLi9ibmYvZ3JhbW1hcicpLFxuICAgICAgQk5GUGFyc2VyID0gcmVxdWlyZSgnLi4vYm5mL3BhcnNlcicpO1xuXG5jb25zdCB7IFRleHRhcmVhIH0gPSBlYXN5LFxuICAgICAgeyBCTkZMZXhlciB9ID0gbGV4ZXJzO1xuXG5jb25zdCBsZXhpY2FsR3JhbW1hclRleHRhcmVhU2VsZWN0b3IgPSAndGV4dGFyZWEjbGV4aWNhbEdyYW1tYXInLFxuICAgICAgYWRqdXN0ZWRCTkZHcmFtbWFyVGV4dGFyZWFTZWxlY3RvciA9ICd0ZXh0YXJlYSNhZGp1c3RlZEJORkdyYW1tYXInLFxuICAgICAgbGV4aWNhbEdyYW1tYXIgPSBCTkZMZXhlci5ncmFtbWFyO1xuXG5sZXQgbGV4aWNhbEdyYW1tYXJUZXh0YXJlYSxcbiAgICBhZGp1c3RlZEJORkdyYW1tYXJUZXh0YXJlYSxcbiAgICBibmZMZXhlciA9IG51bGwsXG4gICAgYm5mUGFyc2VyID0gbnVsbDtcblxuY2xhc3MgQk5GRXhhbXBsZSB7XG4gIHN0YXRpYyBydW4oKSB7XG4gICAgbGV4aWNhbEdyYW1tYXJUZXh0YXJlYSA9IG5ldyBUZXh0YXJlYShsZXhpY2FsR3JhbW1hclRleHRhcmVhU2VsZWN0b3IpO1xuICAgIGFkanVzdGVkQk5GR3JhbW1hclRleHRhcmVhID0gbmV3IFRleHRhcmVhKGFkanVzdGVkQk5GR3JhbW1hclRleHRhcmVhU2VsZWN0b3IpO1xuXG4gICAgY29uc3QgbGV4aWNhbEdyYW1tYXJUZXh0YXJlYVZhbHVlID0gSlNPTi5zdHJpbmdpZnkobGV4aWNhbEdyYW1tYXIsIG51bGwsICcgICcpLCAvLy9cbiAgICAgICAgICBibmZHcmFtbWFyVGV4dGFyZWFWYWx1ZSA9IGdyYW1tYXIsIC8vL1xuICAgICAgICAgIGNvbnRlbnRUZXh0YXJlYVZhbHVlID0gYFxuXG4gICAgIGRvY3VtZW50ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgaGVhZGVyPyB2ZXJ0aWNhbFNwYWNlPyBib2R5P1xuXG5cblxuICAgICBoZWFkZXIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIGluY2x1ZGVEaXJlY3RpdmUrXG5cbiAgICAgdmVydGljYWxTcGFjZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICA8RU5EX09GX0xJTkU+K1xuXG4gICAgIGJvZHkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgcGFydCtcblxuXG5cbiAgICAgcnVsZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBcIlJ1bGVcIiBsYWJlbHM/IDxFTkRfT0ZfTElORT4gcHJlbWlzZU9yUHJlbWlzZXM/IGNvbmNsdXNpb24gcHJvb2Y/XG5cbiAgICAgYXhpb20gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBcIkF4aW9tXCIgbGFiZWxzPyA8RU5EX09GX0xJTkU+IHN0YW5kYWxvbmVTdGF0ZW1lbnRcblxuICAgICBsZW1tYSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiTGVtbWFcIiBsYWJlbHM/IDxFTkRfT0ZfTElORT4gc3RhbmRhbG9uZVN0YXRlbWVudCBwcm9vZj9cblxuICAgICB0aGVvcmVtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiVGhlb3JlbVwiIGxhYmVscz8gPEVORF9PRl9MSU5FPiBzdGFuZGFsb25lU3RhdGVtZW50IHByb29mP1xuXG5cblxuICAgICB0eXBlRGVjbGFyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiVHlwZVwiIHR5cGVcblxuICAgICB0eXBlc0RlY2xhcmF0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiVHlwZXNcIiB0eXBlc1xuXG4gICAgIGRlcGVuZGVudFR5cGVEZWNsYXJhdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJEZXBlbmRlbnRUeXBlXCIgZGVwZW5kZW50VHlwZVxuXG4gICAgIGRlcGVuZGVudFR5cGVzRGVjbGFyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJEZXBlbmRlbnRUeXBlc1wiIGRlcGVuZGVudFR5cGVzIFxuXG4gICAgIGNvbnN0cnVjdG9yRGVjbGFyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJDb25zdHJ1Y3RvclwiIGNvbnN0cnVjdG9yXG5cbiAgICAgY29uc3RydWN0b3JzRGVjbGFyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBcIkNvbnN0cnVjdG9yc1wiIGNvbnN0cnVjdG9yc1xuXG4gICAgIHZhcmlhYmxlRGVjbGFyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJWYXJpYWJsZVwiIHZhcmlhYmxlXG5cbiAgICAgdmFyaWFibGVzRGVjbGFyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBcIlZhcmlhYmxlc1wiIHZhcmlhYmxlc1xuXG4gICAgIG1ldGFWYXJpYWJsZURlY2xhcmF0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJNZXRhVmFyaWFibGVcIiBtZXRhVmFyaWFibGVcblxuICAgICBtZXRhVmFyaWFibGVzRGVjbGFyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiTWV0YVZhcmlhYmxlc1wiIG1ldGFWYXJpYWJsZXNcblxuICAgICBxdWFsaWZpZWRNZXRhVmFyaWFibGVEZWNsYXJhdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiUXVhbGlmaWVkTWV0YVZhcmlhYmxlXCIgcXVhbGlmaWVkTWV0YVZhcmlhYmxlXG5cbiAgICAgcXVhbGlmaWVkTWV0YVZhcmlhYmxlc0RlY2xhcmF0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBcIlF1YWxpZmllZE1ldGFWYXJpYWJsZXNcIiBxdWFsaWZpZWRNZXRhVmFyaWFibGVzXG5cblxuXG4gICAgIHBhcnQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgdmVydGljYWxTcGFjZVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgcnVsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIGF4aW9tXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgbGVtbWFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICB0aGVvcmVtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgdHlwZURlY2xhcmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgdHlwZXNEZWNsYXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIGRlcGVuZGVudFR5cGVEZWNsYXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIGRlcGVuZGVudFR5cGVzRGVjbGFyYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICBjb25zdHJ1Y3RvckRlY2xhcmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgY29uc3RydWN0b3JzRGVjbGFyYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICB2YXJpYWJsZURlY2xhcmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgdmFyaWFibGVzRGVjbGFyYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICBtZXRhdmFyaWFibGVEZWNsYXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIG1ldGF2YXJpYWJsZXNEZWNsYXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIHF1YWxpZmllZE1ldGF2YXJpYWJsZURlY2xhcmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgcXVhbGlmaWVkTWV0YXZhcmlhYmxlc0RlY2xhcmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gIGluY2x1ZGVEaXJlY3RpdmUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJpbmNsdWRlXCI8Tk9fV0hJVEVTUEFDRT5cIihcIjxOT19XSElURVNQQUNFPltzdHJpbmddPE5PX1dISVRFU1BBQ0U+XCIpXCIgPEVORF9PRl9MSU5FPlxuXG5cblxuICAgcHJlbWlzZU9yUHJlbWlzZXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIHByZW1pc2UgfCBwcmVtaXNlc1xuXG5cblxuICAgdHlwZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIHR5cGVOYW1lXG4gICBcbiAgIHR5cGVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICB0eXBlKDxOT19XSElURVNQQUNFPlwiLFwiPE5PX1dISVRFU1BBQ0U+dHlwZSkqXG5cbiAgIGRlcGVuZGVudFR5cGUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBkZXBlbmRlbnRUeXBlTmFtZTxOT19XSElURVNQQUNFPlwiKFwiPE5PX1dISVRFU1BBQ0U+dHlwZU5hbWU8Tk9fV0hJVEVTUEFDRT5cIilcIlxuICAgXG4gICBkZXBlbmRlbnRUeXBlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgZGVwZW5kZW50VHlwZSg8Tk9fV0hJVEVTUEFDRT5cIixcIjxOT19XSElURVNQQUNFPmRlcGVuZGVudFR5cGUpKlxuICAgXG4gICBjb25zdHJ1Y3RvciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgY29uc3RydWN0b3JOYW1lPE5PX1dISVRFU1BBQ0U+XCIoXCI8Tk9fV0hJVEVTUEFDRT50eXBlczxOT19XSElURVNQQUNFPlwiKVwiXG4gICBcbiAgIGNvbnN0cnVjdG9ycyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBjb25zdHJ1Y3Rvcig8Tk9fV0hJVEVTUEFDRT5cIixcIjxOT19XSElURVNQQUNFPmNvbnN0cnVjdG9yKSpcbiAgIFxuICAgdmFyaWFibGUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIHZhcmlhYmxlTmFtZSg8Tk9fV0hJVEVTUEFDRT5cIjpcInR5cGUpP1xuICAgXG4gICB2YXJpYWJsZXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgdmFyaWFibGUoPE5PX1dISVRFU1BBQ0U+XCIsXCI8Tk9fV0hJVEVTUEFDRT52YXJpYWJsZSkqXG4gICBcbiAgIG1ldGFWYXJpYWJsZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBtZXRhVmFyaWFibGVOYW1lXG5cbiAgIG1ldGFWYXJpYWJsZXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBtZXRhVmFyaWFibGUoPE5PX1dISVRFU1BBQ0U+XCIsXCI8Tk9fV0hJVEVTUEFDRT5tZXRhVmFyaWFibGUpKlxuICAgXG4gICBxdWFsaWZpZWRNZXRhVmFyaWFibGUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgcXVhbGlmaWVkTWV0YVZhcmlhYmxlTmFtZVxuICAgXG4gICBxdWFsaWZpZWRNZXRhVmFyaWFibGVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgcXVhbGlmaWVkTWV0YVZhcmlhYmxlKDxOT19XSElURVNQQUNFPlwiLFwiPE5PX1dISVRFU1BBQ0U+cXVhbGlmaWVkTWV0YVZhcmlhYmxlKSpcbiAgIFxuICAgXG4gICBcbiAgIGxhYmVsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBsYWJlbE5hbWUoPE5PX1dISVRFU1BBQ0U+XCIoXCI8Tk9fV0hJVEVTUEFDRT50ZXJtczxOT19XSElURVNQQUNFPlwiKVwiKT9cblxuXG5cbiAgIHR5cGVOYW1lICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBuYW1lXG5cbiAgIGRlcGVuZGVudFR5cGVOYW1lICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBuYW1lXG5cbiAgIGNvbnN0cnVjdG9yTmFtZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBuYW1lXG5cbiAgIHZhcmlhYmxlTmFtZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBuYW1lXG5cbiAgIG1ldGFWYXJpYWJsZU5hbWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBuYW1lXG5cbiAgIHF1YWxpZmllZE1ldGFWYXJpYWJsZU5hbWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBuYW1lXG4gICBcbiAgIGxhYmVsTmFtZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBuYW1lXG5cbiAgIG5hbWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICAvXFxcXHcrL1xuICAgXG5cbiAgICBcbmA7IC8vL1xuXG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgcHJlbWlzZShzKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBwcmVtaXNlIHwgcHJlbWlzZXNcblxuICAgICBwcmVtaXNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiUHJlbWlzZVwiIDxFTkRfT0ZfTElORT4gdW5qdXN0aWZpZWRTdGF0ZW1lbnRPclVua25vd25cblxuICAgICBwcmVtaXNlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiUHJlbWlzZXNcIiA8RU5EX09GX0xJTkU+IHVuanVzdGlmaWVkU3RhdGVtZW50T3JVbmtub3duIHVuanVzdGlmaWVkU3RhdGVtZW50T3JVbmtub3duK1xuXG4gICAgIGNvbmNsdXNpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJDb25jbHVzaW9uXCIgPEVORF9PRl9MSU5FPiAodW4panVzdGlmaWVkU3RhdGVtZW50T3JVbmtub3duXG5cblxuXG4gICAgIHByb29mICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJQcm9vZlwiIDxFTkRfT0ZfTElORT4gKGFicmlkZ2VkKVByb29mRGVyaXZhdGlvblxuXG4gICAgIChhYnJpZGdlZClQcm9vZkRlcml2YXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgcHJvb2ZEZXJpdmF0aW9uIHwgYWJyaWRnZWRQcm9vZkRlcml2YXRpb25cblxuICAgICBhYnJpZGdlZFByb29mRGVyaXZhdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgICh1bilqdXN0aWZpZWRTdGF0ZW1lbnRPclVua25vd25cblxuICAgICBwcm9vZkRlcml2YXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIGRlcml2YXRpb24gdGhlcmVmb3JlXG5cbiAgICAgZGVyaXZhdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBzdWJEZXJpdmF0aW9uK1xuXG4gICAgIHRoZXJlZm9yZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJUaGVyZWZvcmVcIiA8RU5EX09GX0xJTkU+ICh1bilqdXN0aWZpZWRTdGF0ZW1lbnRPclVua25vd25cblxuICAgICBzdWJEZXJpdmF0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIHN1YkxlbW1hIHwgKHVuKWp1c3RpZmllZFN0YXRlbWVudE9yVW5rbm93blxuXG5cblxuICAgICBzdWJMZW1tYSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIHN1cHBvc2UgdGhlbj8gaGVuY2UgdW5qdXN0aWZpZWRTdGF0ZW1lbnRPclVua25vd24/IHZlcnRpY2FsU3BhY2U/XG5cbiAgICAgc3VwcG9zZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBcIlN1cHBvc2VcIiA8RU5EX09GX0xJTkU+IHVuanVzdGlmaWVkU3RhdGVtZW50T3JVbmtub3duK1xuXG4gICAgIHRoZW4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgXCJUaGVuXCIgPEVORF9PRl9MSU5FPiBkZXJpdmF0aW9uXG5cbiAgICAgaGVuY2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBcIkhlbmNlXCIgPEVORF9PRl9MSU5FPiAodW4panVzdGlmaWVkU3RhdGVtZW50T3JVbmtub3duXG5cblxuXG4gICAgICh1bilqdXN0aWZpZWRTdGF0ZW1lbnRPclVua25vd24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAganVzdGlmaWVkU3RhdGVtZW50IHwgdW5qdXN0aWZpZWRTdGF0ZW1lbnQgfCB1bmtub3duXG5cbiAgICAgdW5qdXN0aWZpZWRTdGF0ZW1lbnRPclVua25vd24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICB1bmp1c3RpZmllZFN0YXRlbWVudCB8IHVua25vd25cblxuICAgICB1bmp1c3RpZmllZFN0YXRlbWVudCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIHN0YXRlbWVudCA8RU5EX09GX0xJTkU+XG5cbiAgICAganVzdGlmaWVkU3RhdGVtZW50ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBzdGF0ZW1lbnQganVzdGlmaWNhdGlvbiA8RU5EX09GX0xJTkU+XG5cbiAgICAganVzdGlmaWNhdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBieU9yRnJvbSByZWZlcmVuY2VcblxuICAgICBieU9yRnJvbSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiYnlcIiB8IFwiZnJvbVwiXG5cbiAgICAgcmVmZXJlbmNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICByZWZlcmVuY2VOYW1lPE5PX1dISVRFU1BBQ0U+cGFyZW50aGVzaXNlZFRlcm1MaXN0P1xuXG4gICAgIHJlZmVyZW5jZU5hbWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgbmFtZVxuXG5cblxuICAgICBzdGF0ZW1lbnQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIHByb29mQXNzZXJ0aW9uIHwgdHlwZUFzc2VydGlvbiB8IGVxdWFsaXR5IHwgZXhwcmVzc2lvblxuXG5cblxuICAgICBwcm9vZkFzc2VydGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIChxdWFsaWZpZWQpTWV0YXZhcmlhYmxlIFwiOjpcIiAocXVhbGlmaWVkKU1ldGF2YXJpYWJsZVxuXG4gICAgIHR5cGVBc3NlcnRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgZXhwcmVzc2lvbiBcIjpcIiB0eXBlXG5cbiAgICAgZXF1YWxpdHkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBleHByZXNzaW9uIFwiPVwiIGV4cHJlc3Npb25cblxuICAgICBleHByZXNzaW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIHRlcm0gfCAocXVhbGlmaWVkKU1ldGF2YXJpYWJsZVxuXG5cblxuICAgICB0ZXJtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIGNvbXBvdW5kVGVybSB8IHZhcmlhYmxlTmFtZVxuXG4gICAgIGNvbXBvdW5kVGVybSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgY29uc3RydWN0b3JOYW1lPE5PX1dISVRFU1BBQ0U+cGFyZW50aGVzaXNlZFRlcm1MaXN0P1xuXG5cblxuICAgICBwYXJlbnRoZXNpc2VkVGVybUxpc3QgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIFwiKFwiPE5PX1dISVRFU1BBQ0U+dGVybUxpc3Q8Tk9fV0hJVEVTUEFDRT5cIilcIlxuXG4gICAgIHRlcm1MaXN0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOjo9ICAgdGVybTxOT19XSElURVNQQUNFPmNvbW1hVGhlblRlcm0qXG5cbiAgICAgY29tbWFUaGVuVGVybSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBcIixcIjxOT19XSElURVNQQUNFPnRlcm1cblxuXG5cbiAgICAgbmFtZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICAvXFxcXHcrL1xuXG5cblxuICAgICB1bmtub3duICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6PSAgIHNwZWNpYWxVbmFzc2lnbmVkT3JNaW5vcktleXdvcmRzKyA8RU5EX09GX0xJTkU+XG5cbiAgICAgc3BlY2lhbFVuYXNzaWduZWRPck1pbm9yS2V5d29yZHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICBbc3BlY2lhbF0gfCBbdW5hc3NpZ25lZF0gfCBcImJ5XCIgfCBcImZyb21cIlxuXG5cblxuXG5cbiAgICAgZXJyb3IgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6Oj0gICAqXG5cbiAgICAgKi9cblxuICAgIGxleGljYWxHcmFtbWFyVGV4dGFyZWEuc2V0VmFsdWUobGV4aWNhbEdyYW1tYXJUZXh0YXJlYVZhbHVlKTtcblxuICAgIEV4YW1wbGUuc2V0Qk5GR3JhbW1hclRleHRhcmVhVmFsdWUoYm5mR3JhbW1hclRleHRhcmVhVmFsdWUpO1xuXG4gICAgRXhhbXBsZS5zZXRDb250ZW50VGV4dGFyZWFWYWx1ZShjb250ZW50VGV4dGFyZWFWYWx1ZSk7XG5cbiAgICBFeGFtcGxlLm9uQk5GR3JhbW1hclRleHRhcmVhS2V5VXAodXBkYXRlKTtcblxuICAgIEV4YW1wbGUub25Db250ZW50VGV4dGFyZWFLZXlVcCh1cGRhdGUpO1xuXG4gICAgbGV4aWNhbEdyYW1tYXJUZXh0YXJlYS5vbktleVVwKHVwZGF0ZSk7XG5cbiAgICB1cGRhdGUoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gIHVwZGF0ZUJORkxleGVyKCk7XG5cbiAgdXBkYXRlQk5GUGFyc2VyKCk7XG5cbiAgdXBkYXRlQWRqdXN0ZWRCTkZHcmFtbWFyKCk7XG5cbiAgaWYgKGJuZkxleGVyICE9PSBudWxsKSB7XG4gICAgY29uc3QgcHJvZHVjdGlvbiA9IG51bGwsXG4gICAgICAgICAgbm9kZSA9IEV4YW1wbGUudXBkYXRlUGFyc2VUcmVlVGV4dGFyZWEoYm5mTGV4ZXIsIGJuZlBhcnNlciwgcHJvZHVjdGlvbiksXG4gICAgICAgICAgcHJvZHVjdGlvbnNOb2RlID0gbm9kZTsgLy8vXG5cbiAgICBCTkZQYXJzZXIuZ2VuZXJhdGVQcm9kdWN0aW9ucyhwcm9kdWN0aW9uc05vZGUpO1xuICB9IGVsc2Uge1xuICAgIEV4YW1wbGUuY2xlYXJQYXJzZVRyZWVUZXh0YXJlYSgpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQk5GRXhhbXBsZTtcblxuZnVuY3Rpb24gdXBkYXRlQk5GTGV4ZXIoKSB7XG4gIGNvbnN0IGxleGljYWxHcmFtbWFyVGV4dGFyZWFWYWx1ZSA9IGxleGljYWxHcmFtbWFyVGV4dGFyZWEuZ2V0VmFsdWUoKTtcblxuICBsZXQgbGV4aWNhbEdyYW1tYXIgPSBudWxsO1xuXG4gIHRyeSB7XG4gICAgbGV4aWNhbEdyYW1tYXIgPSBKU09OLnBhcnNlKGxleGljYWxHcmFtbWFyVGV4dGFyZWFWYWx1ZSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7fVxuXG4gIGNvbnN0IGxleGljYWxHcmFtbWFyVmFsaWQgPSAobGV4aWNhbEdyYW1tYXIgIT09IG51bGwpO1xuXG4gIGlmIChsZXhpY2FsR3JhbW1hclZhbGlkKSB7XG4gICAgYm5mTGV4ZXIgPSBCTkZMZXhlci5mcm9tR3JhbW1hcihsZXhpY2FsR3JhbW1hcik7XG5cbiAgICBsZXhpY2FsR3JhbW1hclRleHRhcmVhLnJlbW92ZUNsYXNzKCdlcnJvcicpO1xuICB9IGVsc2Uge1xuICAgIGxleGljYWxHcmFtbWFyVGV4dGFyZWEuYWRkQ2xhc3MoJ2Vycm9yJyk7XG5cbiAgICBibmZMZXhlciA9IG51bGw7XG4gIH1cbn1cblxuZnVuY3Rpb24gdXBkYXRlQk5GUGFyc2VyKCkge1xuICBibmZQYXJzZXIgPSBCTkZQYXJzZXIuZnJvbU5vdGhpbmcoKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlQWRqdXN0ZWRCTkZHcmFtbWFyKCkge1xuICBjb25zdCBwcm9kdWN0aW9ucyA9IGJuZlBhcnNlci5nZXRQcm9kdWN0aW9ucygpLFxuICAgICAgICBtYXhpbXVtUHJvZHVjdGlvbk5hbWVMZW5ndGggPSBwcm9kdWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24obWF4aW11bVByb2R1Y3Rpb25OYW1lTGVuZ3RoLCBwcm9kdWN0aW9uKSB7XG4gICAgICAgICAgY29uc3QgcHJvZHVjdGlvbk5hbWUgPSBwcm9kdWN0aW9uLmdldE5hbWUoKSxcbiAgICAgICAgICAgICAgICBwcm9kdWN0aW9uTmFtZUxlbmd0aCA9IHByb2R1Y3Rpb25OYW1lLmxlbmd0aDtcbiAgXG4gICAgICAgICAgbWF4aW11bVByb2R1Y3Rpb25OYW1lTGVuZ3RoID0gTWF0aC5tYXgobWF4aW11bVByb2R1Y3Rpb25OYW1lTGVuZ3RoLCBwcm9kdWN0aW9uTmFtZUxlbmd0aCk7XG4gIFxuICAgICAgICAgIHJldHVybiBtYXhpbXVtUHJvZHVjdGlvbk5hbWVMZW5ndGg7XG4gICAgICAgIH0sIDApLFxuICAgICAgICBhZGp1c3RlZEJORkdyYW1tYXJUZXh0YXJlYVZhbHVlID0gcHJvZHVjdGlvbnMucmVkdWNlKGZ1bmN0aW9uKGFkanVzdGVkQk5GR3JhbW1hclRleHRhcmVhLCBwcm9kdWN0aW9uKSB7XG4gICAgICAgICAgY29uc3QgcHJvZHVjdGlvblN0cmluZyA9IHByb2R1Y3Rpb24udG9TdHJpbmcobWF4aW11bVByb2R1Y3Rpb25OYW1lTGVuZ3RoKTtcbiAgXG4gICAgICAgICAgYWRqdXN0ZWRCTkZHcmFtbWFyVGV4dGFyZWEgKz0gcHJvZHVjdGlvblN0cmluZztcbiAgXG4gICAgICAgICAgcmV0dXJuIGFkanVzdGVkQk5GR3JhbW1hclRleHRhcmVhO1xuICAgICAgICB9LCBbXSk7XG5cbiAgYWRqdXN0ZWRCTkZHcmFtbWFyVGV4dGFyZWEuc2V0VmFsdWUoYWRqdXN0ZWRCTkZHcmFtbWFyVGV4dGFyZWFWYWx1ZSk7XG59XG4iXX0=